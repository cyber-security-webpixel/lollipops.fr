/*! For license information please see potions.js.LICENSE.txt */
(()=>{"use strict";var t={518:(t,e,n)=>{function isDebugBuild(){return"undefined"!=typeof __SENTRY_NO_DEBUG__&&!__SENTRY_BROWSER_BUNDLE__}function isBrowserBundle(){return"undefined"!=typeof __SENTRY_BROWSER_BUNDLE__&&!!__SENTRY_BROWSER_BUNDLE__}n.d(e,{c:()=>isDebugBuild,n:()=>isBrowserBundle})},991:(t,e,n)=>{n.d(e,{R:()=>getGlobalObject});var i=n(422),o={};function getGlobalObject(){return(0,i.KV)()?n.g:"undefined"!=typeof window?window:"undefined"!=typeof self?self:o}},422:(t,e,n)=>{n.d(e,{KV:()=>isNodeEnv,l$:()=>dynamicRequire});var i=n(518);function isNodeEnv(){return!(0,i.n)()&&"[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0)}function dynamicRequire(t,e){return t.require(e)}t=n.hmd(t)},170:(t,e,n)=>{n.d(e,{ph:()=>l,yW:()=>c});var i=n(991),o=n(422);t=n.hmd(t);var r={nowSeconds:function(){return Date.now()/1e3}};var s=(0,o.KV)()?function getNodePerformance(){try{return(0,o.l$)(t,"perf_hooks").performance}catch(t){return}}():function getBrowserPerformance(){var t=(0,i.R)().performance;if(t&&t.now)return{now:function(){return t.now()},timeOrigin:Date.now()-t.now()}}(),a=void 0===s?r:{nowSeconds:function(){return(s.timeOrigin+s.now())/1e3}},c=r.nowSeconds.bind(r),l=a.nowSeconds.bind(a);!function(){var t=(0,i.R)().performance;if(t&&t.now){var e=36e5,n=t.now(),o=Date.now(),r=t.timeOrigin?Math.abs(t.timeOrigin+n-o):e,s=r<e,a=t.timing&&t.timing.navigationStart,c="number"==typeof a?Math.abs(a+n-o):e;return s||c<e?r<=c?("timeOrigin",t.timeOrigin):("navigationStart",a):("dateNow",o)}"none"}()}},e={};function __webpack_require__(n){var i=e[n];if(void 0!==i)return i.exports;var o=e[n]={id:n,loaded:!1,exports:{}};return t[n](o,o.exports,__webpack_require__),o.loaded=!0,o.exports}__webpack_require__.d=(t,e)=>{for(var n in e)__webpack_require__.o(e,n)&&!__webpack_require__.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),__webpack_require__.hmd=t=>((t=Object.create(t)).children||(t.children=[]),Object.defineProperty(t,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+t.id)}}),t),__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),__webpack_require__.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t={};__webpack_require__.r(t),__webpack_require__.d(t,{getNode:()=>getNode,insertHTML:()=>insertHTML});var e={};__webpack_require__.r(e),__webpack_require__.d(e,{descendingInJson:()=>descendingInJson,formatDate:()=>formatDate,formatPrice:()=>formatPrice,getDomain:()=>getDomain,isPotionsProductObject:()=>isPotionsProductObject,parseQueryString:()=>parseQueryString,parseStringToNumber:()=>parseStringToNumber,stringifyQueryString:()=>stringifyQueryString,uuidv4:()=>uuidv4});var n={};__webpack_require__.r(n),__webpack_require__.d(n,{getAnalyticsInfos:()=>getAnalyticsInfos});var i={};__webpack_require__.r(i),__webpack_require__.d(i,{FunctionToString:()=>ht,InboundFilters:()=>mt});var o={};__webpack_require__.r(o),__webpack_require__.d(o,{Breadcrumbs:()=>dt,Dedupe:()=>xt,GlobalHandlers:()=>ft,LinkedErrors:()=>yt,TryCatch:()=>_t,UserAgent:()=>bt});class DBWrapper{constructor(t,e,n){this._db=null,this._version=e,this._name=t,this._objectStoreConfiguration=n}async open(){if(!this._db)try{this._db=await new Promise(((t,e)=>{const n=indexedDB.open(this._name,this._version);n.addEventListener("error",(()=>e(n.error))),n.onupgradeneeded=t=>{const e=t.target.result,n=t.target.transaction;this._objectStoreConfiguration.forEach((t=>{if(e.objectStoreNames.contains(t.name)){const e=n?.objectStore(t.name);t?.indexes?.forEach((t=>{e&&!e.indexNames.contains(t)&&e.createIndex(t,t,{unique:!1})}))}else{const n=e.createObjectStore(t.name,t.options);t?.indexes?.forEach((t=>{n.createIndex(t,t,{unique:!1})}))}}))},n.onsuccess=e=>{t(e.target.result)}}))}catch(t){window.potions.logger.captureError(t,!1)}}async getAll(t){return window.indexedDB?(await this.open(),this._db?new Promise(((e,n)=>{try{if(!this._db)return[];const n=this._db.transaction(t,"readonly"),i=n.objectStore(t).openCursor(),o=[];i.onsuccess=t=>{const n=t.target.result;n?(o.push(n.value),n.continue()):e(o)},i.addEventListener("error",(()=>{window.potions.logger.captureError(i.error,!1)}))}catch(t){window.potions.logger.captureError(t,!1),e([])}})):[]):[]}async getAllByIndex(t,e,n){return window.indexedDB?(await this.open(),this._db?new Promise(((i,o)=>{try{if(!this._db)return[];const o=this._db.transaction(t,"readonly").objectStore(t),r=o.index(e).getAll(n);r.onsuccess=()=>{i(r.result)}}catch(t){window.potions.logger.captureError(t,!1),i([])}})):[]):[]}async get(t,e){return window.indexedDB?(await this.open(),this._db?new Promise(((n,i)=>{try{if(!this._db)return{};const i=this._db.transaction(t,"readonly"),o=i.objectStore(t).get(e);o.onsuccess=()=>{n(o.result)}}catch(t){window.potions.logger.captureError(t,!1),n({})}})):{}):{}}async add(t,e){if(window.indexedDB)return await this.open(),this._db?new Promise(((n,i)=>{try{if(!this._db)return{};const i=this._db.transaction(t,"readwrite"),o=i.objectStore(t).add(e);o.onsuccess=()=>{n(o.result)}}catch(t){window.potions.logger.captureError(t,!1),n("")}})):{}}async update(t,e,n){return window.indexedDB?(await this.open(),this._db?new Promise(((i,o)=>{try{if(!this._db)return;const o=this._db.transaction(t,"readwrite"),r=o.objectStore(t).put(e,n);r.onsuccess=()=>{i(r.result)}}catch(t){window.potions.logger.captureError(t,!1),i("")}})):void 0):{}}async query(t,e,n){return window.indexedDB?(await this.open(),this._db?new Promise(((i,o)=>{try{const o=DBWrapper.createRange(e);if(!this._db)return[];const r=this._db.transaction(t,"readwrite").objectStore(t);let s=r.openCursor(o);if(n){const t=r.index(n);s=t.openCursor(o)}const a=[];s.onsuccess=()=>{const t=s.result;t?(a.push({index:t.key,value:t.value}),t.continue()):i(a)}}catch(t){window.potions.logger.captureError(t,!1),i([])}})):[]):[]}static createRange(t){return t.min&&t.max?IDBKeyRange.bound(t.min,t.max):t.min&&!t.max?IDBKeyRange.lowerBound(t.min):t.max&&!t.min?IDBKeyRange.upperBound(t.max):IDBKeyRange.only(t.equal)}async delete(t,e){return window.indexedDB?(await this.open(),this._db?new Promise(((n,i)=>{try{if(!this._db)return{};const i=this._db.transaction(t,"readwrite"),o=i.objectStore(t).delete(e);o.onsuccess=()=>{n(o.result)}}catch(t){window.potions.logger.captureError(t,!1),n("")}})):{}):""}async clear(t){return window.indexedDB?(await this.open(),this._db?new Promise(((e,n)=>{try{if(!this._db)return{};const n=this._db.transaction(t,"readwrite"),i=n.objectStore(t).clear();i.onsuccess=()=>{e(i.result)}}catch(t){window.potions.logger.captureError(t,!1),e("")}})):{}):""}close(){this._db&&(this._db.close(),this._db=null)}}class Resource{constructor(t){this._url=`https://client.get-potions.com${t}`,this._db=new DBWrapper("potions_resources",1,[{name:"resources",options:{keyPath:"name"},indexes:[]}]),this._resource={}}get url(){return this._url}async get(){return this.isUpdateNeeded(this._resource)&&await this.update(),this._resource}async getData(){return this.isUpdateNeeded(this._resource)&&await this.update(),this._resource.data}async fetchServer(){return new Promise((t=>{fetch(this._url).then((e=>{e.ok?t(e.clone().json().catch((()=>e.text()))):t({})})).catch((e=>{window.potions.logger.captureError(e,!1),t({})}))}))}async update(){const t=await(this._db?.get("resources",this._url));if(void 0===t||this.isUpdateNeeded(t)){const t=await this.fetchServer();this.set(t)}else this._resource=t}async set(t){this._resource={name:this._url,data:t,last_update:Date.now(),version:"12.13.0"},this._db?.update("resources",this._resource),window.dispatchEvent(new CustomEvent("potions_update_resource",{detail:this._resource}))}isUpdateNeeded(t){return!(!t||"12.13.0"===t.version)||(!t||!t.last_update||Date.now()-t.last_update>18e5)}}class Widget{constructor(t,e,n=[],i={}){this._resources={},this._potions=t,this._name=e,this._processes={},this._storage={},this._listeners={},this._actions={},this._elements=[],this.buildResources(i.resources??n),this.buildCustom(i)}get name(){return this._name}get resources(){return this._resources}get processes(){return this._processes}get listeners(){return this._listeners}get storage(){return this._storage}get actions(){return this._actions}get elements(){return this._elements}buildResources(t){t.forEach((t=>{const e=t.name;this._resources[e]=t.type.fromResource(new Resource(`/resources/lollipops/${this._name}/${t.file}`).getData(),e)}))}buildCustom(t){for(const[e,n]of Object.entries(t??{})){if("resources"===e)continue;"elements"===e&&(this._elements=n);const t=e.split(".");let i=this;for(const e of t)if(i=i[e],void 0===e)return;for(const[t,e]of Object.entries(n))i[t]=e}}}class EventObserver{constructor(t){this._executor=t}observe(t,e){window.addEventListener(e,(e=>{try{this._executor(e,t)}catch(t){window.potions.logger.captureError(t)}}))}disconnect(t){window.removeEventListener(t,this._executor,!1)}}class Process{constructor(t,e,n){this._executor=t,this._trigger=e,this._ruleResource=n}launch(t){"string"==typeof this._trigger?this.startObserver(t,this._trigger):this._trigger.forEach((e=>{this.startObserver(t,e,(()=>{if("string"!=typeof this._trigger){let e=!0;return this._trigger.forEach((n=>{e=e&&t[n]})),e}}))}))}async startObserver(t,e,n=(()=>!0)){this._ruleResource?this._observer=new EventObserver((async(t,e)=>{if(n(t)){const n=await(this._ruleResource?.rules);if(await(n[this._ruleResource?.rule_name]?.apply()))try{this._executor(t,e)}catch(t){window.potions.logger.captureError(t)}}})):this._observer=new EventObserver((e=>{if(n(e))try{this._executor(e,t)}catch(t){window.potions.logger.captureError(t)}})),this._observer.observe(t,e)}}class State{constructor(){this._domLoaded=!1,this._scrolled=!1,this._active=!1,this._pageId=0,this._sessionId=0,this._lastSessionId=0,this._urlsInSession=[],this._nbPageInSession=0,this._timeInSession=0,this._lastUrlView={},this._timeLastScroll=Date.now(),this._sessionSinceLastTransaction=0,this._geoLoc="",this._device="ontouchstart"in window||navigator.maxTouchPoints?"mobile":"desktop",window.addEventListener("scroll",(()=>{this._timeLastScroll=Date.now()}))}get device(){return this._device}get geoLoc(){return this._geoLoc}set geoLoc(t){t!==this._geoLoc&&(this._geoLoc=t,State.stateHasChanged("geoLoc",t))}get domLoaded(){return this._domLoaded}set domLoaded(t){t!==this._domLoaded&&(this._domLoaded=t,State.stateHasChanged("domLoaded",t))}get scrolled(){return this._scrolled}set scrolled(t){t!==this._scrolled&&(this._scrolled=t,State.stateHasChanged("scrolled",t))}get active(){return this._active}set active(t){t!==this._active&&(this._active=t,State.stateHasChanged("active",t))}get pageId(){return this._pageId}async setPageId(t,e){t!==this._pageId&&(this._pageId=t,await this.update(e),this.timer(),State.stateHasChanged("pageId",t))}get sessionId(){return this._sessionId}get lastSessionId(){return this._lastSessionId}setSessionId(t){t!==this._sessionId&&(this._sessionId=t,this._lastSessionId=t-1>0?t-1:1,State.stateHasChanged("sessionId",t))}get nbPageInSession(){return this._nbPageInSession}get timeInSession(){return this._timeInSession}get urlsInSession(){return this._urlsInSession}get lastUrlView(){return this._lastUrlView}get sessionSinceLastTransaction(){return this._sessionSinceLastTransaction}get timeWithoutScroll(){return Date.now()-this._timeLastScroll}static stateHasChanged(t,e){window.dispatchEvent(new CustomEvent(t,{detail:{value:e}}))}timer(){setInterval((()=>{this._timeInSession+=2e3,State.stateHasChanged("timer",this._timeInSession)}),2e3)}async update(t){try{await this.updateLastPageTime(t,this._pageId);const e=await t.widgets.navigation_recorder.storage.db.query("visited_urls",{equal:this._sessionId},"session_id");this._urlsInSession=e.map((t=>t.value.url)),this._nbPageInSession=e.length,this._timeInSession=e.map((t=>t.value.departure_timestamp?t.value.departure_timestamp-t.value.arrival_timestamp:Date.now()-t.value.arrival_timestamp)).reduce(((t,e)=>t+e),0);const n=await t.widgets.navigation_recorder.storage.db.getAll("sessions"),i=n.filter((t=>t.transaction))?.pop();this._sessionSinceLastTransaction=i?this._sessionId-i.id:this._sessionId,this._geoLoc=n.pop().geo_loc||""}catch(t){window.potions.logger.captureError(t)}}async updateLastPageTime(t,e){if(e-1>0){const n=await t.widgets.navigation_recorder.storage.db.get("visited_urls",e-1);if(Date.now()-n.arrival_timestamp>18e5){const e=await t.widgets.navigation_recorder.storage.db.query("visited_urls",{equal:this._sessionId-1},"session_id");n.departure_timestamp=e.map((t=>t.value.departure_timestamp-t.value.arrival_timestamp)).reduce(((t,e)=>t+e),0)/e.length}else n.departure_timestamp=Date.now();this._lastUrlView=n,await t.widgets.navigation_recorder.storage.db.update("visited_urls",n)}}}class Listener{constructor(t){this._options=t,this._potions=window.potions}get options(){return this._options}}class EventListener extends Listener{launch(t){this._method=async e=>{try{await this._options.executor(e,t)}catch(t){window.potions.logger.captureError(t)}},this._options.event_name&&window.addEventListener(this._options.event_name,this._method,!0)}disconnect(){this._options.event_name&&window.removeEventListener(this._options.event_name,this._method)}}class FunctionListener extends Listener{async launch(t){try{await this._options.executor(new CustomEvent(""),t)}catch(t){window.potions.logger.captureError(t)}}}const r={dom_loaded:new EventListener({event_name:"DOMContentLoaded",executor:(t,e)=>{e.domLoaded=!0}}),dom_already_loaded:new FunctionListener({executor:(t,e)=>{"interactive"!==document.readyState&&"complete"!==document.readyState||(e.domLoaded=!0)}}),scroll:new EventListener({event_name:"scroll",executor:(t,e)=>{0!==window.scrollY&&(e.scrolled=!0)}}),click:new EventListener({event_name:"click",executor:(t,e)=>{e.active=!0}}),keyup:new EventListener({event_name:"keyup",executor:t=>{window.dispatchEvent(new CustomEvent("potions_input_change",{detail:{type:"keyup",native_event:t}}))}}),change:new EventListener({event_name:"change",executor:t=>{window.dispatchEvent(new CustomEvent("potions_input_change",{detail:{type:"change",native_event:t}}))}}),mouse_out:new EventListener({event_name:"mouseout",executor:t=>{t&&null===t.relatedTarget&&(t.clientX<=0||t.clientX>=window.innerWidth||t.clientY<=0||t.clientY>=window.innerHeight)&&setTimeout((()=>{window.dispatchEvent(new CustomEvent("potions_leaving_page"))}),500)}}),close_page:new EventListener({event_name:"beforeunload",executor:t=>{window.dispatchEvent(new CustomEvent("potions_close_page",{detail:{type:"change",native_event:t}}))}})};function updateListenersPotions(t){[...document.querySelectorAll("potions_propulse")].forEach((t=>t.remove())),[...document.querySelectorAll("potions-flashback")].forEach((t=>t.remove())),window.dispatchEvent(new CustomEvent("potions_url_change",{detail:{url:t}})),function reloadPropulseListeners(){setTimeout((()=>{window.potions.widgets.propulse?.listeners&&Object.values(window.potions.widgets.propulse?.listeners).forEach((t=>{t.options.query_selector&&t.launch(window.potions.state)}))}),200)}()}const s={push_state:new FunctionListener({executor:()=>{const t=history.pushState;history.pushState=(e,n,i)=>{t.apply(history,[e,n,i]),window.dispatchEvent(new CustomEvent("potions_url_change",{detail:{url:i}}))}}}),replace_state:new FunctionListener({executor:()=>{const t=history.replaceState;history.replaceState=(e,n,i)=>{t.apply(history,[e,n,i]),window.dispatchEvent(new CustomEvent("potions_url_change",{detail:{url:i}}))}}}),new_script_loaded:new FunctionListener({executor:()=>{window.dispatchEvent(new CustomEvent("potions_url_change",{detail:{url:window.location.href}}))}})};({sentry:!0,analytics:[{type:"matomo"},{type:"ua",ua:"UA-38168347-1"}],multiply:{api:{token:"",site_id:"16"},configs:{add_to_cart:{location:{desktop:!0,mobile:!0},algorithm:{experience_id:"4a7778fe-7a61-4af5-af52-02ee1160876d",experience_id_preview:"72e249ff-c053-4cc0-91e0-5c1909b7196a",parameters:["product_ids"]}},product_page:{location:{desktop:!0,mobile:!0},algorithm:{experience_id:"4d75db7c-9a8e-4adf-9b12-ef918311f778",experience_id_preview:"bb1f1d5d-2889-4393-86ae-9ed3773d6628",parameters:["product_ids"]}}}}}).react&&(s.push_state=new FunctionListener({executor:()=>{const t=history.pushState;history.pushState=(e,n,i)=>{t.apply(history,[e,n,i]),updateListenersPotions(i)}}}),s.replace_state=new FunctionListener({executor:()=>{const t=history.replaceState;history.replaceState=(e,n,i)=>{t.apply(history,[e,n,i]),updateListenersPotions(i)}}}));const a={...r,...s};function insertHTML(t,e){const n=document.createElement("div");n.innerHTML=e;const i=document.querySelector(t);i&&i.parentNode?.insertBefore(n,i)}function getNode(t){return new Promise((e=>{const n=document.querySelector(t);if(n)e(n);else{const n=new MutationObserver((()=>{const i=document.querySelector(t);i&&(e(i),n.disconnect())}));n.observe(document.body,{childList:!0,subtree:!0})}}))}function uuidv4(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)))}function getDomain(){return location.hostname.replace(new RegExp("\\.","g"),"")}function parseQueryString(t=location.search){if(""===t)return{};const e={};return t.split("&").forEach((t=>{const[n,i]=t.split("=");e[n]=i})),e}function stringifyQueryString(t){return Object.entries(t).map((([t,e])=>`${t}=${e}`)).join("&")}function formatDate(t){let e=new Date;return t&&(e=new Date(t)),`${e.getFullYear()}-${e.toLocaleDateString("en",{month:"2-digit"})}-${e.toLocaleDateString("en",{day:"2-digit"})}`}function descendingInJson(t,e){let n=t;return e.split(".").forEach((t=>{n&&(n=n[t])})),n}function formatPrice(t){return t?parseFloat(t)?.toFixed(2).toString().replace(".",","):t}function parseStringToNumber(t){try{if(!t||"string"!=typeof t)return t;const e=t.replace(/[^0-9|,|.]/g,"").replace(",",".");return parseFloat(e)}catch(e){return window.potions.logger.captureError(e,!1),t}}function isPotionsProductObject(t){return t&&t.id&&t.link&&t.img_link}function getAnalyticsInfos(){return{}}const c={dom:{...t},utils:{...e},analytics:{...n}};class ObjectArray extends Array{push(t){if(!this[t.name])return this.createGetter(t),Array.prototype.push.apply(this,arguments)}createGetter(t){Object.defineProperty(this,t.name,{get:()=>t})}}const l=["InvalidStateError","SecurityError","Failed to fetch","NetworkError","The user denied permission to access the database","Error creating or migrating Records table in database","The operation failed for reasons unrelated to the database","NotFoundError: IDBDatabase.transaction","Internal error opening backing store for indexedDB.open","Unable to open database file on disk","QuotaExceededError","Failed to execute 'transaction' on 'IDBDatabase'","Error looking up record in object store by key range","'indexedDB' is not defined","AbortError: The operation was aborted.","UnknownError: Database deleted by request of the user","NotFoundError: The operation failed","La requête a expiré.","Body is disturbed or locked","double events","undefined is not an object (evaluating 'n.pop().geo_loc')","Cannot read properties of undefined (reading 'geo_loc')","Failed to execute 'clone' on 'Response': Response body is already used"];class Logger{constructor(t,e){if(this._env=t,"production"===t){this.SENTRY_INTEGRATIONS=[new e.Integrations.FunctionToString,new e.Integrations.InboundFilters,new e.Integrations.UserAgent,new e.Integrations.LinkedErrors,new e.Dedupe];const t={release:"12.13.0",tracesSampleRate:0,sampleRate:.2,dsn:"https://5dfed8f44a2d488db82aeb2308832f9d@o435032.ingest.sentry.io/5392808",integrations:this.SENTRY_INTEGRATIONS,defaultIntegrations:!1,allowUrls:[new RegExp("https:\\/\\/.*?/(potions|potions).js")],beforeSend:(t,e)=>{const n=e.originalException;return"string"==typeof n&&l.filter((t=>-1!==n.indexOf(t))).length>0||n&&n.message&&l.filter((t=>-1!==n.message.indexOf(t))).length>0||t&&t.message&&l.filter((e=>-1!==t.message.indexOf(e))).length>0?null:t}},n=new e.BrowserClient(t);this.sentry=e.getCurrentHub(),this.sentry.bindClient(n)}this.errors=[],this.logs=[]}captureError(t,e=!0){"production"===this._env?e&&this.sentry.captureException(t):console.error(t),this.errors.push(t)}captureLog(t){"production"!==this._env&&console.log(...t),this.logs.push(t)}}class Analytics{constructor(t){this.global=t}sendEvent(t){try{const{attributes:e,options:n}=this.build(t);e&&this.send(e,n)}catch(t){window.potions.logger.captureError(t)}}build(t){return{attributes:{},options:{}}}async send(t,e){}}function GAAnalytics(t){return class extends t{sendGa(t,e={non_interactive:!1,custom_dimension:!1},n=0){if(("function"!=typeof window.ga.getAll||0===window.ga.getAll().length)&&n<10)setTimeout((()=>{this.sendGa(t,e,n+1)}),500);else{const n=window.ga.getAll().find((t=>(t.model.data.ea?.[":trackingId"]||t.model.data.ia?.[":trackingId"])===this.global.ua));n?(e.custom_dimension&&this.global.custom_dimension&&n.set(this.global.custom_dimension,t.event_label),n.send("event",t.event_category,t.event_action,t.event_label,1,{nonInteraction:e.non_interactive?1:0}),window.potions.logger.captureLog(["ANALYTICS - send with ga",t.event_category,"\n",t.event_action,"\n",t.event_label.replace("|","\n").replace(new RegExp(",","g"),"\n")])):window.potions.logger.captureError("ANALYTICS - NO UA SET",!1)}if(n>10)throw new Error("Analytics blocks")}sendGtag(t,e=!1){try{window.gtag("event",t.value,{...t.data,non_interaction:e}),window.potions.logger.captureLog(["GA - send with gtag","\n",t.value,"\n",t.data])}catch(t){window.potions.logger.captureError(t,!1)}}}}class GA4nalytics extends(GAAnalytics(Analytics)){constructor(t){super(t),"potions_gtag"===this.global.sender&&this.addGtagTag()}getExperienceIdFromNameAndPlacement(t,e){return console.log(t,e),{sentry:!0,analytics:[{type:"matomo"},{type:"ua",ua:"UA-38168347-1"}],multiply:{api:{token:"",site_id:"16"},configs:{add_to_cart:{location:{desktop:!0,mobile:!0},algorithm:{experience_id:"4a7778fe-7a61-4af5-af52-02ee1160876d",experience_id_preview:"72e249ff-c053-4cc0-91e0-5c1909b7196a",parameters:["product_ids"]}},product_page:{location:{desktop:!0,mobile:!0},algorithm:{experience_id:"4d75db7c-9a8e-4adf-9b12-ef918311f778",experience_id_preview:"bb1f1d5d-2889-4393-86ae-9ed3773d6628",parameters:["product_ids"]}}}}}[t][e]?.experience_id??{sentry:!0,analytics:[{type:"matomo"},{type:"ua",ua:"UA-38168347-1"}],multiply:{api:{token:"",site_id:"16"},configs:{add_to_cart:{location:{desktop:!0,mobile:!0},algorithm:{experience_id:"4a7778fe-7a61-4af5-af52-02ee1160876d",experience_id_preview:"72e249ff-c053-4cc0-91e0-5c1909b7196a",parameters:["product_ids"]}},product_page:{location:{desktop:!0,mobile:!0},algorithm:{experience_id:"4d75db7c-9a8e-4adf-9b12-ef918311f778",experience_id_preview:"bb1f1d5d-2889-4393-86ae-9ed3773d6628",parameters:["product_ids"]}}}}}[t]?.configs?.[e]?.algorithm?.experience_id}build(t){let e="",n=null;if(t.widget.match("(ab_experiment)"))e="potions",n={event_type:"ab",experience_type:`${t.widget}_${t.id}`,experience_name:t.options?.label,action_type:t.action};else if(t.widget.match("(multiply|flashback)"))switch(n={item_list_id:`potions_${this.getExperienceIdFromNameAndPlacement(t.widget,t.options.label)}`,item_list_name:`potions_${t.widget}_${t.options?.label}`},n.items=t.options?.items?.map(((t,e)=>({...this.transformProduct(t),index:e}))),console.log(),t.action){case"show":e="view_item_list";break;case"convert":"add"===t.id?(e=this.global?.events?.convert?.add??"add_to_cart",n.currency="EUR",n.value=t.options?.items[0].price):e="select_item";break;default:e="close_item_list"}else if(t.widget.match("(propulse)"))switch(n={item_list_id:`potions_${this.getExperienceIdFromNameAndPlacement(t.widget,t.options.label)}`,item_list_name:`potions_${t.widget}_${t.options?.label}`},t.action){case"show":case"interact":e="view_content";break;case"convert":e="select_content";break;default:e="close_content"}else switch(n={item_list_id:`potions_${this.getExperienceIdFromNameAndPlacement(t.widget,t.options.label)}`,item_list_name:`potions_${t.widget}_${t.options?.label}`},t.action){case"show":e="view_content";break;case"convert":e="select_content";break;default:e="close_content"}return{attributes:{value:e,data:n}}}transformProduct(t){return{item_id:t.id,item_name:t.title,price:t.price?.toString()}}addGtagTag(){const t=document.createElement("script");t.setAttribute("async","true"),t.setAttribute("src",`https://www.googletagmanager.com/gtag/js?id=${this.global.id}`);const e=document.createElement("script");e.innerHTML=`\n      window.dataLayer = window.dataLayer || [];\n      function gtag(){dataLayer.push(arguments);}\n      gtag('js', new Date());\n      gtag("config", "${this.global.id}");\n      `,document.head.append(t),document.head.append(e)}async send(t){"tag_manager"===this.global.sender?(window.dataLayer.push({event:t.value,ecommerce:t.data}),window.potions.logger.captureLog(["GA4 - push in dataLayer","\n",t.value,"\n",t.data])):this.sendGtag(t)}}const d={propulse:{show:{button:{description:"Déclenchement de l'affichage du propulse (dans layer)"}},interact:{expand:{description:"Ouvrir le player (chatbot)"},click_powered:{description:"Cliquer sur le bouton powered by potions"}},convert:{redirect:{description:"Cliquer sur le bouton de redirection"}},end:{fold:{description:"Réduire le player (chatbot)"},cross:{description:"Fermer le bouton (button - bandeau)"}}},multiply:{show:{banner:{description:"Afficher popin de recommandation"}},interact:{continue_shopping:{description:"Fermer product en cliquant sur continuer les achats"},go_to_cart:{description:"Cliquer pour être redirigé sur le panier"},scroll_right:{description:"Cliquer sur la flèche de droite du carouselle"},scroll_left:{description:"Cliquer sur la flèche de gauche du carouselle"}},convert:{go_to_page:{description:"Cliquer sur un produit recommandé"},add:{description:"Ajouter un produit recommandé au panier"}},end:{close:{description:"Fermer product"}},stats:{not_available:{description:"Ajouter un produit recommandé non disponible au panier"}}},connect:{convert:{login:{description:"L'utilisateur a été loggué par potions"}},stats:{user_already_connected:{description:"L'utilisateur est déjà connecté."},not_supported:{description:"Le navigateur ne supporte pas auto login (autre que Chrome)"},no_password_saved_or_refused:{description:"Aucunes crédentials ne sont sauvegardées"}}},switch:{show:{banner:{description:"Le coupon est affiché à l'écran"}},convert:{activation:{description:"Cliquer sur le bouton pour activer le coupon"},fill_cart:{description:"Le coupon est rempli dans la page panier"},go_to_page:{description:"Cliquer sur un lien de redirection"}},end:{close:{description:"Le coupon est fermé"}},interact:{go_to_cart:{description:"Cliquer pour être redirigé sur le panier"},continue_shopping:{description:"Fermer switch en cliquant sur continuer les achats"}}},flashback:{show:{banner:{description:"Le flashback est affiché à l'écran"}},interact:{delete_product:{description:"Supprimer un produit du flashback"},pin_product:{description:""},remove_pin_product:{description:""},add_to_compare:{description:""}},convert:{go_to_page:{description:"Cliquer sur un produit du flashback"},add:{description:"Ajouter un produit au panier"}},end:{close:{description:"Le flashback est fermé"}}},wishlist:{show:{banner:{description:"La wishlist est affiché à l'écran"}},interact:{add:{description:"Ajouter un produit à la wishlist"},remove:{description:"Supprimer un produit de la wishlist"}},convert:{go_to_page:{description:"Cliquer sur un produit de la wishlist"},add:{description:"Ajouter un produit au panier"}},end:{close:{description:"La wishlist est fermée"}}},cart_recorder:{convert:{restore:{description:"Reconstruction du panier"}},interact:{no_availability:{description:"Pas de dispo"}}}};function buildEventsObject(t,e=!1,n=!1){try{const i=`${t.p}_${t.t}`,o=t.l?`${t.a}_${t.id}_${t.l}`:`${t.a}_${t.id}`,r=function reduce(t){const e=Object.entries(t.attributes).filter((([t,e])=>void 0!==e)).map((([t,e])=>("string"!=typeof e&&Array.isArray(e)&&(e=e.join(";")),[t,e]))).map((([t,e])=>`${t}=${e}`)).join(",");return`${t.key}|${e}`}({key:`${t.p}_${t.a}_${t.id}`,attributes:{...t,d:(new Date).toISOString()}});return{attributes:{event_category:i,event_action:o,event_label:r},options:{non_interactive:e,custom_dimension:n}}}catch(t){return window.potions.logger.captureError(t,!1),{}}}class GAUAAnalytics extends(GAAnalytics(Analytics)){build(t){let e;if("ab_experiment"===t.widget)e="ab";else if(e="op",!d[t.widget]?.[t.action]?.[t.id])throw new Error("Analytics event doesn't exist");return buildEventsObject({p:t.widget,t:e,a:t.action,id:t.id,l:t.options?.label||void 0,sku:t.options?.sku||void 0,price:t.options?.price||void 0,r:t.options?.items?.map((t=>t.id))||void 0},t.non_interactive??!1,"ab"===e?t.customDimension:void 0)}async send(t,e,n=0){try{if("ga"===this.global.sender&&window.ga||window.ga&&!this.global.sender?this.sendGa(t,e):"gtag"===this.global.sender&&window.gtag||window.gtag&&!this.global.sender?this.sendGtag({value:t.event_action,data:{event_category:t.event_category,event_label:t.event_label}},e.non_interactive):n<10&&setTimeout((()=>{this.send(t,e,n+1)}),500),n>10)throw new Error("Analytics blocks")}catch(t){window.potions.logger.captureError(t,!1)}}}const p={ua:GAUAAnalytics,ga4:GA4nalytics,at_internet:class AtInternetAnalytics extends Analytics{build(t){switch(t.action){case"show":return{attributes:{value:"self_promotion.display",data:{onsitead_type:`potions_${t.widget}`,onsitead_creation:t.widget,onsitead_general_placement:`potions_${t.widget}_${t.options?.label}`,onsitead_advertiser:"potions",...window.potions.actions.analytics.getAnalyticsInfos()}}};case"convert":return{attributes:{value:"self_promotion.click",data:{onsitead_type:`potions_${t.widget}`,onsitead_creation:t.widget,onsitead_general_placement:`potions_${t.widget}_${t.options?.label}`,onsitead_advertiser:"potions",click:`potions_${t.widget}_${t.options?.label}_${t.id}`,product:{placement:`potions_${t.widget}_${t.options?.label}`,...this.transformProduct(t.options?.items?.[0])},...window.potions.actions.analytics.getAnalyticsInfos()}}};default:return{attributes:{value:"click.exit",data:{click:`potions_${t.widget}_${t.options?.label}_${t.id}`,...window.potions.actions.analytics.getAnalyticsInfos()}}}}return{}}transformProduct(t){try{return t?{id:`${t.id}`,name:`${t.title}`,price:parseStringToNumber(t.price.toString())}:{}}catch(t){return window.potions.logger.captureError(t,!1),{}}}async send(t,e,n=0){try{let i=window.ATTag;if(this.global.sender&&(i=window[this.global.sender]),i?.events?.send?this.sendATInternet(t):n<10&&setTimeout((()=>{this.send(t,e,n+1)}),500),n>=10)throw new Error("Analytics blocks")}catch(t){window.potions.logger.captureError(t,!1)}}async sendATInternet(t){window.ATTag.events.send(t.value,t.data),window.potions.logger.captureLog(["AT INTERNET - send event",t.value,t.data])}},matomo:class MatomoAnalytics extends Analytics{build(t){let e;if("ab_experiment"===t.widget)e="ab";else if(e="op",!d[t.widget]?.[t.action]?.[t.id])throw new Error("Analytics event doesn't exist");return buildEventsObject({p:t.widget,t:e,a:t.action,id:t.id,l:t.options?.label||void 0,sku:t.options?.sku||void 0,price:t.options?.price||void 0})}async send(t,e,n=0){try{let e=window._paq;if(this.global.sender&&(e=window[this.global.sender]),e&&(e.push(["trackEvent",t.event_category,t.event_action,t.event_label]),window.potions.logger.captureLog(["MATOMO - send event","\n",t.event_category,"\n",t.event_action,"\n",t.event_label.replaceAll("|","\n").replaceAll(",","\n")])),n>10)throw new Error("Analytics blocks")}catch(t){window.potions.logger.captureError(t,!1)}}},content_square:class ContentSquareAnalytics extends Analytics{build(t){return"show"===t.action?{attributes:{key:`PO_DISPLAY_${t.widget}`,value:t.options.label}}:"ab_experiment"===t.widget?"execute"===t.action?{attributes:{key:`PO_AB_EXECUTE_${t.id}`,value:t.options.label}}:{attributes:{key:`PO_AB_SET_BUCKET_${t.id}`,value:t.options.label}}:{}}async send(t,e,n=0){try{let i=window._uxa;if(this.global.sender&&(i=window[this.global.sender]),i?.push?(i.push(["trackDynamicVariable",{key:t.key,value:t.value}]),window.potions.logger.captureLog(["CONTENT SQUARE - send event",t.key,t.value])):n<10&&setTimeout((()=>{this.send(t,e,n+1)}),500),n>=10)throw new Error("Analytics content square blocks")}catch(t){window.potions.logger.captureError(t,!1)}}},piwik:class PiwikAnalytics extends Analytics{build(t){let e;if("ab_experiment"===t.widget)e="ab";else if(e="op",!d[t.widget]?.[t.action]?.[t.id])throw new Error("Analytics event doesn't exist");return buildEventsObject({p:t.widget,t:e,a:t.action,id:t.id,l:t.options?.label||void 0,sku:t.options?.sku||void 0,price:t.options?.price||void 0})}async send(t,e,n=0){try{let e=window._paq;if(this.global.sender&&(e=window[this.global.sender]),e&&(e.push(["trackEvent",t.event_category,t.event_action,t.event_label]),window.potions.logger.captureLog(["PIWIK - send event","\n",t.event_category,"\n",t.event_action,"\n",t.event_label.replaceAll("|","\n").replaceAll(",","\n")])),n>10)throw new Error("Analytics blocks")}catch(t){window.potions.logger.captureError(t,!1)}}}},u=[{type:"matomo"},{type:"ua",ua:"UA-38168347-1"}]?.map((t=>new(0,p[t.type])(t)));class analytics_Analytics{sendEvent(t){u.forEach((e=>e.sendEvent(t)))}}const h={add_geo_loc:new Process((async(t,e)=>{if(1===e.nbPageInSession){const t=await fetch("https://geoip.get-potions.com/"),n=await t.json(),i=await window.potions.widgets.navigation_recorder.storage.db.get("sessions",e.sessionId);window.potions.widgets.navigation_recorder.storage.db.update("sessions",{...i,geo_loc:n}),e.geoLoc=n}}),"pageId")},g={};({sentry:!0,analytics:[{type:"matomo"},{type:"ua",ua:"UA-38168347-1"}],multiply:{api:{token:"",site_id:"16"},configs:{add_to_cart:{location:{desktop:!0,mobile:!0},algorithm:{experience_id:"4a7778fe-7a61-4af5-af52-02ee1160876d",experience_id_preview:"72e249ff-c053-4cc0-91e0-5c1909b7196a",parameters:["product_ids"]}},product_page:{location:{desktop:!0,mobile:!0},algorithm:{experience_id:"4d75db7c-9a8e-4adf-9b12-ef918311f778",experience_id_preview:"bb1f1d5d-2889-4393-86ae-9ed3773d6628",parameters:["product_ids"]}}}}}).processes&&[...{sentry:!0,analytics:[{type:"matomo"},{type:"ua",ua:"UA-38168347-1"}],multiply:{api:{token:"",site_id:"16"},configs:{add_to_cart:{location:{desktop:!0,mobile:!0},algorithm:{experience_id:"4a7778fe-7a61-4af5-af52-02ee1160876d",experience_id_preview:"72e249ff-c053-4cc0-91e0-5c1909b7196a",parameters:["product_ids"]}},product_page:{location:{desktop:!0,mobile:!0},algorithm:{experience_id:"4d75db7c-9a8e-4adf-9b12-ef918311f778",experience_id_preview:"bb1f1d5d-2889-4393-86ae-9ed3773d6628",parameters:["product_ids"]}}}}}.processes].forEach((t=>{h[t]&&(g[t]=h[t])}));class Potions{constructor({env:t},e){this.version="12.13.0",this.state=new State,this.actions=c,this.listeners=a,this.initializers={},this.widgets=new ObjectArray,this.analytics=new analytics_Analytics,this.data={},this.temp={rules:{}},this.logger=new Logger(t,e)}async launch(){try{await this.launchInitializers(),this.launchElements(),this.launchProcesses(),this.launchListeners()}catch(t){this.logger.captureError(t)}}async launchInitializers(){for(const t of Object.values(this.initializers))await t.launch(this.state)}launchElements(){let t=[];this.widgets.forEach((e=>{t=[...new Set([...t,...e.elements])]})),t.forEach((t=>{t.define()}))}launchProcesses(){this.widgets.forEach((t=>{Object.values(t.processes).forEach((t=>{t.launch(this.state)}))})),Object.values(g).forEach((t=>{t.launch(this.state)}))}launchListeners(){this.widgets.forEach((t=>{Object.values(t.listeners).forEach((t=>{t.launch(this.state)}))})),Object.values(this.listeners).forEach((t=>{t.launch(this.state)}))}}class Initializer{constructor(t,e){this._executor=t,this._rule=e}async launch(t){if(this._rule){await this._rule.apply()&&await this._executor(t)}else await this._executor(t)}}class Json{static async fromResource(t){return t}}var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},extendStatics(t,e)};function __extends(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}var tslib_es6_assign=function(){return tslib_es6_assign=Object.assign||function __assign(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},tslib_es6_assign.apply(this,arguments)};function __values(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,o,r=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(t){o={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function tslib_es6_spread(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(__read(arguments[e]));return t}var m="6.17.5",f=Object.prototype.toString;function isError(t){switch(f.call(t)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return isInstanceOf(t,Error)}}function isBuiltin(t,e){return f.call(t)==="[object "+e+"]"}function isErrorEvent(t){return isBuiltin(t,"ErrorEvent")}function isDOMError(t){return isBuiltin(t,"DOMError")}function isString(t){return isBuiltin(t,"String")}function is_isPrimitive(t){return null===t||"object"!=typeof t&&"function"!=typeof t}function isPlainObject(t){return isBuiltin(t,"Object")}function isEvent(t){return"undefined"!=typeof Event&&isInstanceOf(t,Event)}function isElement(t){return"undefined"!=typeof Element&&isInstanceOf(t,Element)}function isThenable(t){return Boolean(t&&t.then&&"function"==typeof t.then)}function isInstanceOf(t,e){try{return t instanceof e}catch(t){return!1}}var v=__webpack_require__(170);function resolvedSyncPromise(t){return new _((function(e){e(t)}))}function rejectedSyncPromise(t){return new _((function(e,n){n(t)}))}var _=function(){function SyncPromise(t){var e=this;this._state=0,this._handlers=[],this._resolve=function(t){e._setResult(1,t)},this._reject=function(t){e._setResult(2,t)},this._setResult=function(t,n){0===e._state&&(isThenable(n)?n.then(e._resolve,e._reject):(e._state=t,e._value=n,e._executeHandlers()))},this._executeHandlers=function(){if(0!==e._state){var t=e._handlers.slice();e._handlers=[],t.forEach((function(t){t[0]||(1===e._state&&t[1](e._value),2===e._state&&t[2](e._value),t[0]=!0)}))}};try{t(this._resolve,this._reject)}catch(t){this._reject(t)}}return SyncPromise.prototype.then=function(t,e){var n=this;return new SyncPromise((function(i,o){n._handlers.push([!1,function(e){if(t)try{i(t(e))}catch(t){o(t)}else i(e)},function(t){if(e)try{i(e(t))}catch(t){o(t)}else o(t)}]),n._executeHandlers()}))},SyncPromise.prototype.catch=function(t){return this.then((function(t){return t}),t)},SyncPromise.prototype.finally=function(t){var e=this;return new SyncPromise((function(n,i){var o,r;return e.then((function(e){r=!1,o=e,t&&t()}),(function(e){r=!0,o=e,t&&t()})).then((function(){r?i(o):n(o)}))}))},SyncPromise}(),y=__webpack_require__(991),w=function(){function Scope(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._user={},this._tags={},this._extra={},this._contexts={},this._sdkProcessingMetadata={}}return Scope.clone=function(t){var e=new Scope;return t&&(e._breadcrumbs=tslib_es6_spread(t._breadcrumbs),e._tags=tslib_es6_assign({},t._tags),e._extra=tslib_es6_assign({},t._extra),e._contexts=tslib_es6_assign({},t._contexts),e._user=t._user,e._level=t._level,e._span=t._span,e._session=t._session,e._transactionName=t._transactionName,e._fingerprint=t._fingerprint,e._eventProcessors=tslib_es6_spread(t._eventProcessors),e._requestSession=t._requestSession),e},Scope.prototype.addScopeListener=function(t){this._scopeListeners.push(t)},Scope.prototype.addEventProcessor=function(t){return this._eventProcessors.push(t),this},Scope.prototype.setUser=function(t){return this._user=t||{},this._session&&this._session.update({user:t}),this._notifyScopeListeners(),this},Scope.prototype.getUser=function(){return this._user},Scope.prototype.getRequestSession=function(){return this._requestSession},Scope.prototype.setRequestSession=function(t){return this._requestSession=t,this},Scope.prototype.setTags=function(t){return this._tags=tslib_es6_assign(tslib_es6_assign({},this._tags),t),this._notifyScopeListeners(),this},Scope.prototype.setTag=function(t,e){var n;return this._tags=tslib_es6_assign(tslib_es6_assign({},this._tags),((n={})[t]=e,n)),this._notifyScopeListeners(),this},Scope.prototype.setExtras=function(t){return this._extra=tslib_es6_assign(tslib_es6_assign({},this._extra),t),this._notifyScopeListeners(),this},Scope.prototype.setExtra=function(t,e){var n;return this._extra=tslib_es6_assign(tslib_es6_assign({},this._extra),((n={})[t]=e,n)),this._notifyScopeListeners(),this},Scope.prototype.setFingerprint=function(t){return this._fingerprint=t,this._notifyScopeListeners(),this},Scope.prototype.setLevel=function(t){return this._level=t,this._notifyScopeListeners(),this},Scope.prototype.setTransactionName=function(t){return this._transactionName=t,this._notifyScopeListeners(),this},Scope.prototype.setTransaction=function(t){return this.setTransactionName(t)},Scope.prototype.setContext=function(t,e){var n;return null===e?delete this._contexts[t]:this._contexts=tslib_es6_assign(tslib_es6_assign({},this._contexts),((n={})[t]=e,n)),this._notifyScopeListeners(),this},Scope.prototype.setSpan=function(t){return this._span=t,this._notifyScopeListeners(),this},Scope.prototype.getSpan=function(){return this._span},Scope.prototype.getTransaction=function(){var t=this.getSpan();return t&&t.transaction},Scope.prototype.setSession=function(t){return t?this._session=t:delete this._session,this._notifyScopeListeners(),this},Scope.prototype.getSession=function(){return this._session},Scope.prototype.update=function(t){if(!t)return this;if("function"==typeof t){var e=t(this);return e instanceof Scope?e:this}return t instanceof Scope?(this._tags=tslib_es6_assign(tslib_es6_assign({},this._tags),t._tags),this._extra=tslib_es6_assign(tslib_es6_assign({},this._extra),t._extra),this._contexts=tslib_es6_assign(tslib_es6_assign({},this._contexts),t._contexts),t._user&&Object.keys(t._user).length&&(this._user=t._user),t._level&&(this._level=t._level),t._fingerprint&&(this._fingerprint=t._fingerprint),t._requestSession&&(this._requestSession=t._requestSession)):isPlainObject(t)&&(this._tags=tslib_es6_assign(tslib_es6_assign({},this._tags),t.tags),this._extra=tslib_es6_assign(tslib_es6_assign({},this._extra),t.extra),this._contexts=tslib_es6_assign(tslib_es6_assign({},this._contexts),t.contexts),t.user&&(this._user=t.user),t.level&&(this._level=t.level),t.fingerprint&&(this._fingerprint=t.fingerprint),t.requestSession&&(this._requestSession=t.requestSession)),this},Scope.prototype.clear=function(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._requestSession=void 0,this._span=void 0,this._session=void 0,this._notifyScopeListeners(),this},Scope.prototype.addBreadcrumb=function(t,e){var n="number"==typeof e?Math.min(e,100):100;if(n<=0)return this;var i=tslib_es6_assign({timestamp:(0,v.yW)()},t);return this._breadcrumbs=tslib_es6_spread(this._breadcrumbs,[i]).slice(-n),this._notifyScopeListeners(),this},Scope.prototype.clearBreadcrumbs=function(){return this._breadcrumbs=[],this._notifyScopeListeners(),this},Scope.prototype.applyToEvent=function(t,e){if(this._extra&&Object.keys(this._extra).length&&(t.extra=tslib_es6_assign(tslib_es6_assign({},this._extra),t.extra)),this._tags&&Object.keys(this._tags).length&&(t.tags=tslib_es6_assign(tslib_es6_assign({},this._tags),t.tags)),this._user&&Object.keys(this._user).length&&(t.user=tslib_es6_assign(tslib_es6_assign({},this._user),t.user)),this._contexts&&Object.keys(this._contexts).length&&(t.contexts=tslib_es6_assign(tslib_es6_assign({},this._contexts),t.contexts)),this._level&&(t.level=this._level),this._transactionName&&(t.transaction=this._transactionName),this._span){t.contexts=tslib_es6_assign({trace:this._span.getTraceContext()},t.contexts);var n=this._span.transaction&&this._span.transaction.name;n&&(t.tags=tslib_es6_assign({transaction:n},t.tags))}return this._applyFingerprint(t),t.breadcrumbs=tslib_es6_spread(t.breadcrumbs||[],this._breadcrumbs),t.breadcrumbs=t.breadcrumbs.length>0?t.breadcrumbs:void 0,t.sdkProcessingMetadata=this._sdkProcessingMetadata,this._notifyEventProcessors(tslib_es6_spread(getGlobalEventProcessors(),this._eventProcessors),t,e)},Scope.prototype.setSDKProcessingMetadata=function(t){return this._sdkProcessingMetadata=tslib_es6_assign(tslib_es6_assign({},this._sdkProcessingMetadata),t),this},Scope.prototype._notifyEventProcessors=function(t,e,n,i){var o=this;return void 0===i&&(i=0),new _((function(r,s){var a=t[i];if(null===e||"function"!=typeof a)r(e);else{var c=a(tslib_es6_assign({},e),n);isThenable(c)?c.then((function(e){return o._notifyEventProcessors(t,e,n,i+1).then(r)})).then(null,s):o._notifyEventProcessors(t,c,n,i+1).then(r).then(null,s)}}))},Scope.prototype._notifyScopeListeners=function(){var t=this;this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach((function(e){e(t)})),this._notifyingListeners=!1)},Scope.prototype._applyFingerprint=function(t){t.fingerprint=t.fingerprint?Array.isArray(t.fingerprint)?t.fingerprint:[t.fingerprint]:[],this._fingerprint&&(t.fingerprint=t.fingerprint.concat(this._fingerprint)),t.fingerprint&&!t.fingerprint.length&&delete t.fingerprint},Scope}();function getGlobalEventProcessors(){var t=(0,y.R)();return t.__SENTRY__=t.__SENTRY__||{},t.__SENTRY__.globalEventProcessors=t.__SENTRY__.globalEventProcessors||[],t.__SENTRY__.globalEventProcessors}function addGlobalEventProcessor(t){getGlobalEventProcessors().push(t)}var b=__webpack_require__(518),x=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function setProtoOf(t,e){return t.__proto__=e,t}:function mixinProperties(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(t,n)||(t[n]=e[n]);return t});var k=function(t){function SentryError(e){var n=this.constructor,i=t.call(this,e)||this;return i.message=e,i.name=n.prototype.constructor.name,x(i,n.prototype),i}return __extends(SentryError,t),SentryError}(Error),S=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+))?@)([\w.-]+)(?::(\d+))?\/(.+)/;function dsnToString(t,e){void 0===e&&(e=!1);var n=t.host,i=t.path,o=t.pass,r=t.port,s=t.projectId;return t.protocol+"://"+t.publicKey+(e&&o?":"+o:"")+"@"+n+(r?":"+r:"")+"/"+(i?i+"/":i)+s}function dsnFromComponents(t){return"user"in t&&!("publicKey"in t)&&(t.publicKey=t.user),{user:t.publicKey||"",protocol:t.protocol,publicKey:t.publicKey||"",pass:t.pass||"",host:t.host,port:t.port||"",path:t.path||"",projectId:t.projectId}}function makeDsn(t){var e="string"==typeof t?function dsnFromString(t){var e=S.exec(t);if(!e)throw new k("Invalid Sentry Dsn: "+t);var n=__read(e.slice(1),6),i=n[0],o=n[1],r=n[2],s=void 0===r?"":r,a=n[3],c=n[4],l=void 0===c?"":c,d="",p=n[5],u=p.split("/");if(u.length>1&&(d=u.slice(0,-1).join("/"),p=u.pop()),p){var h=p.match(/^\d+/);h&&(p=h[0])}return dsnFromComponents({host:a,pass:s,path:d,projectId:p,port:l,protocol:i,publicKey:o})}(t):dsnFromComponents(t);return function validateDsn(t){if((0,b.c)()){var e=t.port,n=t.projectId,i=t.protocol;if(["protocol","publicKey","host","projectId"].forEach((function(e){if(!t[e])throw new k("Invalid Sentry Dsn: "+e+" missing")})),!n.match(/^\d+$/))throw new k("Invalid Sentry Dsn: Invalid projectId "+n);if(!function isValidProtocol(t){return"http"===t||"https"===t}(i))throw new k("Invalid Sentry Dsn: Invalid protocol "+i);if(e&&isNaN(parseInt(e,10)))throw new k("Invalid Sentry Dsn: Invalid port "+e);return!0}}(e),e}function htmlTreeAsString(t,e){try{for(var n=t,i=[],o=0,r=0,s=" > ".length,a=void 0;n&&o++<5&&!("html"===(a=_htmlElementAsString(n,e))||o>1&&r+i.length*s+a.length>=80);)i.push(a),r+=a.length,n=n.parentNode;return i.reverse().join(" > ")}catch(t){return"<unknown>"}}function _htmlElementAsString(t,e){var n,i,o,r,s,a=t,c=[];if(!a||!a.tagName)return"";c.push(a.tagName.toLowerCase());var l=e&&e.length?e.filter((function(t){return a.getAttribute(t)})).map((function(t){return[t,a.getAttribute(t)]})):null;if(l&&l.length)l.forEach((function(t){c.push("["+t[0]+'="'+t[1]+'"]')}));else if(a.id&&c.push("#"+a.id),(n=a.className)&&isString(n))for(i=n.split(/\s+/),s=0;s<i.length;s++)c.push("."+i[s]);var d=["type","name","title","alt"];for(s=0;s<d.length;s++)o=d[s],(r=a.getAttribute(o))&&c.push("["+o+'="'+r+'"]');return c.join("")}var E="<anonymous>";function getFunctionName(t){try{return t&&"function"==typeof t&&t.name||E}catch(t){return E}}function truncate(t,e){return void 0===e&&(e=0),"string"!=typeof t||0===e||t.length<=e?t:t.substr(0,e)+"..."}function safeJoin(t,e){if(!Array.isArray(t))return"";for(var n=[],i=0;i<t.length;i++){var o=t[i];try{n.push(String(o))}catch(t){n.push("[value cannot be serialized]")}}return n.join(e)}function isMatchingPattern(t,e){return!!isString(t)&&(function isRegExp(t){return isBuiltin(t,"RegExp")}(e)?e.test(t):"string"==typeof e&&-1!==t.indexOf(e))}function fill(t,e,n){if(e in t){var i=t[e],o=n(i);if("function"==typeof o)try{markFunctionWrapped(o,i)}catch(t){}t[e]=o}}function addNonEnumerableProperty(t,e,n){Object.defineProperty(t,e,{value:n})}function markFunctionWrapped(t,e){var n=e.prototype||{};t.prototype=e.prototype=n,addNonEnumerableProperty(t,"__sentry_original__",e)}function getOriginalFunction(t){return t.__sentry_original__}function getWalkSource(t){if(isError(t)){var e=t,n={message:e.message,name:e.name,stack:e.stack};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}if(isEvent(t)){var o=t,r={};r.type=o.type;try{r.target=isElement(o.target)?htmlTreeAsString(o.target):Object.prototype.toString.call(o.target)}catch(t){r.target="<unknown>"}try{r.currentTarget=isElement(o.currentTarget)?htmlTreeAsString(o.currentTarget):Object.prototype.toString.call(o.currentTarget)}catch(t){r.currentTarget="<unknown>"}for(var s in"undefined"!=typeof CustomEvent&&isInstanceOf(t,CustomEvent)&&(r.detail=o.detail),o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s]);return r}return t}function jsonSize(t){return function utf8Length(t){return~-encodeURI(t).split(/%..|./).length}(JSON.stringify(t))}function normalizeToSize(t,e,n){void 0===e&&(e=3),void 0===n&&(n=102400);var i=normalize(t,e);return jsonSize(i)>n?normalizeToSize(t,e-1,n):i}function normalizeValue(t,e){return"domain"===e&&t&&"object"==typeof t&&t._events?"[Domain]":"domainEmitter"===e?"[DomainEmitter]":void 0!==__webpack_require__.g&&t===__webpack_require__.g?"[Global]":"undefined"!=typeof window&&t===window?"[Window]":"undefined"!=typeof document&&t===document?"[Document]":function isSyntheticEvent(t){return isPlainObject(t)&&"nativeEvent"in t&&"preventDefault"in t&&"stopPropagation"in t}(t)?"[SyntheticEvent]":"number"==typeof t&&t!=t?"[NaN]":void 0===t?"[undefined]":"function"==typeof t?"[Function: "+getFunctionName(t)+"]":"symbol"==typeof t?"["+String(t)+"]":"bigint"==typeof t?"[BigInt: "+String(t)+"]":t}function walk(t,e,n,i){if(void 0===n&&(n=1/0),void 0===i&&(i=function memoBuilder(){var t="function"==typeof WeakSet,e=t?new WeakSet:[];return[function memoize(n){if(t)return!!e.has(n)||(e.add(n),!1);for(var i=0;i<e.length;i++)if(e[i]===n)return!0;return e.push(n),!1},function unmemoize(n){if(t)e.delete(n);else for(var i=0;i<e.length;i++)if(e[i]===n){e.splice(i,1);break}}]}()),0===n)return function serializeValue(t){if("string"==typeof t)return t;var e=Object.prototype.toString.call(t);if("[object Object]"===e)return"[Object]";if("[object Array]"===e)return"[Array]";var n=normalizeValue(t);return is_isPrimitive(n)?n:e}(e);if(null!=e&&"function"==typeof e.toJSON)return e.toJSON();var o=normalizeValue(e,t);if(is_isPrimitive(o))return o;var r=getWalkSource(e),s=Array.isArray(e)?[]:{};if(i[0](e))return"[Circular ~]";for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(s[a]=walk(a,r[a],n-1,i));return i[1](e),s}function normalize(t,e){try{return JSON.parse(JSON.stringify(t,(function(t,n){return walk(t,n,e)})))}catch(t){return"**non-serializable**"}}function extractExceptionKeysForMessage(t,e){void 0===e&&(e=40);var n=Object.keys(getWalkSource(t));if(n.sort(),!n.length)return"[object has no keys]";if(n[0].length>=e)return truncate(n[0],e);for(var i=n.length;i>0;i--){var o=n.slice(0,i).join(", ");if(!(o.length>e))return i===n.length?o:truncate(o,e)}return""}function dropUndefinedKeys(t){var e,n;if(isPlainObject(t)){var i=t,o={};try{for(var r=__values(Object.keys(i)),s=r.next();!s.done;s=r.next()){var a=s.value;void 0!==i[a]&&(o[a]=dropUndefinedKeys(i[a]))}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return o}return Array.isArray(t)?t.map(dropUndefinedKeys):t}function uuid4(){var t=(0,y.R)(),e=t.crypto||t.msCrypto;if(void 0!==e&&e.getRandomValues){var n=new Uint16Array(8);e.getRandomValues(n),n[3]=4095&n[3]|16384,n[4]=16383&n[4]|32768;var pad=function(t){for(var e=t.toString(16);e.length<4;)e="0"+e;return e};return pad(n[0])+pad(n[1])+pad(n[2])+pad(n[3])+pad(n[4])+pad(n[5])+pad(n[6])+pad(n[7])}return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))}function parseUrl(t){if(!t)return{};var e=t.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!e)return{};var n=e[6]||"",i=e[8]||"";return{host:e[4],path:e[5],protocol:e[2],relative:e[5]+n+i}}function getFirstException(t){return t.exception&&t.exception.values?t.exception.values[0]:void 0}function getEventDescription(t){var e=t.message,n=t.event_id;if(e)return e;var i=getFirstException(t);return i?i.type&&i.value?i.type+": "+i.value:i.type||i.value||n||"<unknown>":n||"<unknown>"}function addExceptionTypeValue(t,e,n){var i=t.exception=t.exception||{},o=i.values=i.values||[],r=o[0]=o[0]||{};r.value||(r.value=e||""),r.type||(r.type=n||"Error")}function addExceptionMechanism(t,e){var n=getFirstException(t);if(n){var i=n.mechanism;if(n.mechanism=tslib_es6_assign(tslib_es6_assign(tslib_es6_assign({},{type:"generic",handled:!0}),i),e),e&&"data"in e){var o=tslib_es6_assign(tslib_es6_assign({},i&&i.data),e.data);n.mechanism.data=o}}}function checkOrSetAlreadyCaught(t){if(t&&t.__sentry_captured__)return!0;try{addNonEnumerableProperty(t,"__sentry_captured__",!0)}catch(t){}return!1}var P=(0,y.R)(),L="Sentry Logger ";function consoleSandbox(t){var e=(0,y.R)();if(!("console"in e))return t();var n=e.console,i={};["debug","info","warn","error","log","assert"].forEach((function(t){t in e.console&&n[t].__sentry_original__&&(i[t]=n[t],n[t]=n[t].__sentry_original__)}));var o=t();return Object.keys(i).forEach((function(t){n[t]=i[t]})),o}var C=function(){function Logger(){this._enabled=!1}return Logger.prototype.disable=function(){this._enabled=!1},Logger.prototype.enable=function(){this._enabled=!0},Logger.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._enabled&&consoleSandbox((function(){P.console.log(L+"[Log]: "+t.join(" "))}))},Logger.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._enabled&&consoleSandbox((function(){P.console.warn(L+"[Warn]: "+t.join(" "))}))},Logger.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._enabled&&consoleSandbox((function(){P.console.error(L+"[Error]: "+t.join(" "))}))},Logger}();P.__SENTRY__=P.__SENTRY__||{};var A=P.__SENTRY__.logger||(P.__SENTRY__.logger=new C),I=__webpack_require__(422),T=function(){function Session(t){this.errors=0,this.sid=uuid4(),this.duration=0,this.status="ok",this.init=!0,this.ignoreDuration=!1;var e=(0,v.ph)();this.timestamp=e,this.started=e,t&&this.update(t)}return Session.prototype.update=function(t){if(void 0===t&&(t={}),t.user&&(!this.ipAddress&&t.user.ip_address&&(this.ipAddress=t.user.ip_address),this.did||t.did||(this.did=t.user.id||t.user.email||t.user.username)),this.timestamp=t.timestamp||(0,v.ph)(),t.ignoreDuration&&(this.ignoreDuration=t.ignoreDuration),t.sid&&(this.sid=32===t.sid.length?t.sid:uuid4()),void 0!==t.init&&(this.init=t.init),!this.did&&t.did&&(this.did=""+t.did),"number"==typeof t.started&&(this.started=t.started),this.ignoreDuration)this.duration=void 0;else if("number"==typeof t.duration)this.duration=t.duration;else{var e=this.timestamp-this.started;this.duration=e>=0?e:0}t.release&&(this.release=t.release),t.environment&&(this.environment=t.environment),!this.ipAddress&&t.ipAddress&&(this.ipAddress=t.ipAddress),!this.userAgent&&t.userAgent&&(this.userAgent=t.userAgent),"number"==typeof t.errors&&(this.errors=t.errors),t.status&&(this.status=t.status)},Session.prototype.close=function(t){t?this.update({status:t}):"ok"===this.status?this.update({status:"exited"}):this.update()},Session.prototype.toJSON=function(){return dropUndefinedKeys({sid:""+this.sid,init:this.init,started:new Date(1e3*this.started).toISOString(),timestamp:new Date(1e3*this.timestamp).toISOString(),status:this.status,errors:this.errors,did:"number"==typeof this.did||"string"==typeof this.did?""+this.did:void 0,duration:this.duration,attrs:{release:this.release,environment:this.environment,ip_address:this.ipAddress,user_agent:this.userAgent}})},Session}(),R=function(){function Hub(t,e,n){void 0===e&&(e=new w),void 0===n&&(n=4),this._version=n,this._stack=[{}],this.getStackTop().scope=e,t&&this.bindClient(t)}return Hub.prototype.isOlderThan=function(t){return this._version<t},Hub.prototype.bindClient=function(t){this.getStackTop().client=t,t&&t.setupIntegrations&&t.setupIntegrations()},Hub.prototype.pushScope=function(){var t=w.clone(this.getScope());return this.getStack().push({client:this.getClient(),scope:t}),t},Hub.prototype.popScope=function(){return!(this.getStack().length<=1)&&!!this.getStack().pop()},Hub.prototype.withScope=function(t){var e=this.pushScope();try{t(e)}finally{this.popScope()}},Hub.prototype.getClient=function(){return this.getStackTop().client},Hub.prototype.getScope=function(){return this.getStackTop().scope},Hub.prototype.getStack=function(){return this._stack},Hub.prototype.getStackTop=function(){return this._stack[this._stack.length-1]},Hub.prototype.captureException=function(t,e){var n=this._lastEventId=uuid4(),i=e;if(!e){var o=void 0;try{throw new Error("Sentry syntheticException")}catch(t){o=t}i={originalException:t,syntheticException:o}}return this._invokeClient("captureException",t,tslib_es6_assign(tslib_es6_assign({},i),{event_id:n})),n},Hub.prototype.captureMessage=function(t,e,n){var i=this._lastEventId=uuid4(),o=n;if(!n){var r=void 0;try{throw new Error(t)}catch(t){r=t}o={originalException:t,syntheticException:r}}return this._invokeClient("captureMessage",t,e,tslib_es6_assign(tslib_es6_assign({},o),{event_id:i})),i},Hub.prototype.captureEvent=function(t,e){var n=uuid4();return"transaction"!==t.type&&(this._lastEventId=n),this._invokeClient("captureEvent",t,tslib_es6_assign(tslib_es6_assign({},e),{event_id:n})),n},Hub.prototype.lastEventId=function(){return this._lastEventId},Hub.prototype.addBreadcrumb=function(t,e){var n=this.getStackTop(),i=n.scope,o=n.client;if(i&&o){var r=o.getOptions&&o.getOptions()||{},s=r.beforeBreadcrumb,a=void 0===s?null:s,c=r.maxBreadcrumbs,l=void 0===c?100:c;if(!(l<=0)){var d=(0,v.yW)(),p=tslib_es6_assign({timestamp:d},t),u=a?consoleSandbox((function(){return a(p,e)})):p;null!==u&&i.addBreadcrumb(u,l)}}},Hub.prototype.setUser=function(t){var e=this.getScope();e&&e.setUser(t)},Hub.prototype.setTags=function(t){var e=this.getScope();e&&e.setTags(t)},Hub.prototype.setExtras=function(t){var e=this.getScope();e&&e.setExtras(t)},Hub.prototype.setTag=function(t,e){var n=this.getScope();n&&n.setTag(t,e)},Hub.prototype.setExtra=function(t,e){var n=this.getScope();n&&n.setExtra(t,e)},Hub.prototype.setContext=function(t,e){var n=this.getScope();n&&n.setContext(t,e)},Hub.prototype.configureScope=function(t){var e=this.getStackTop(),n=e.scope,i=e.client;n&&i&&t(n)},Hub.prototype.run=function(t){var e=makeMain(this);try{t(this)}finally{makeMain(e)}},Hub.prototype.getIntegration=function(t){var e=this.getClient();if(!e)return null;try{return e.getIntegration(t)}catch(e){return A.warn("Cannot retrieve integration "+t.id+" from the current Hub"),null}},Hub.prototype.startSpan=function(t){return this._callExtensionMethod("startSpan",t)},Hub.prototype.startTransaction=function(t,e){return this._callExtensionMethod("startTransaction",t,e)},Hub.prototype.traceHeaders=function(){return this._callExtensionMethod("traceHeaders")},Hub.prototype.captureSession=function(t){if(void 0===t&&(t=!1),t)return this.endSession();this._sendSessionUpdate()},Hub.prototype.endSession=function(){var t=this.getStackTop(),e=t&&t.scope,n=e&&e.getSession();n&&n.close(),this._sendSessionUpdate(),e&&e.setSession()},Hub.prototype.startSession=function(t){var e=this.getStackTop(),n=e.scope,i=e.client,o=i&&i.getOptions()||{},r=o.release,s=o.environment,a=((0,y.R)().navigator||{}).userAgent,c=new T(tslib_es6_assign(tslib_es6_assign(tslib_es6_assign({release:r,environment:s},n&&{user:n.getUser()}),a&&{userAgent:a}),t));if(n){var l=n.getSession&&n.getSession();l&&"ok"===l.status&&l.update({status:"exited"}),this.endSession(),n.setSession(c)}return c},Hub.prototype._sendSessionUpdate=function(){var t=this.getStackTop(),e=t.scope,n=t.client;if(e){var i=e.getSession&&e.getSession();i&&n&&n.captureSession&&n.captureSession(i)}},Hub.prototype._invokeClient=function(t){for(var e,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var o=this.getStackTop(),r=o.scope,s=o.client;s&&s[t]&&(e=s)[t].apply(e,tslib_es6_spread(n,[r]))},Hub.prototype._callExtensionMethod=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var i=getMainCarrier(),o=i.__SENTRY__;if(o&&o.extensions&&"function"==typeof o.extensions[t])return o.extensions[t].apply(this,e);A.warn("Extension method "+t+" couldn't be found, doing nothing.")},Hub}();function getMainCarrier(){var t=(0,y.R)();return t.__SENTRY__=t.__SENTRY__||{extensions:{},hub:void 0},t}function makeMain(t){var e=getMainCarrier(),n=getHubFromCarrier(e);return setHubOnCarrier(e,t),n}function getCurrentHub(){var t=getMainCarrier();return hasHubOnCarrier(t)&&!getHubFromCarrier(t).isOlderThan(4)||setHubOnCarrier(t,new R),(0,I.KV)()?function getHubFromActiveDomain(t){try{var e=getMainCarrier().__SENTRY__,n=e&&e.extensions&&e.extensions.domain&&e.extensions.domain.active;if(!n)return getHubFromCarrier(t);if(!hasHubOnCarrier(n)||getHubFromCarrier(n).isOlderThan(4)){var i=getHubFromCarrier(t).getStackTop();setHubOnCarrier(n,new R(i.client,w.clone(i.scope)))}return getHubFromCarrier(n)}catch(e){return getHubFromCarrier(t)}}(t):getHubFromCarrier(t)}function hasHubOnCarrier(t){return!!(t&&t.__SENTRY__&&t.__SENTRY__.hub)}function getHubFromCarrier(t){return t&&t.__SENTRY__&&t.__SENTRY__.hub||(t.__SENTRY__=t.__SENTRY__||{},t.__SENTRY__.hub=new R),t.__SENTRY__.hub}function setHubOnCarrier(t,e){return!!t&&(t.__SENTRY__=t.__SENTRY__||{},t.__SENTRY__.hub=e,!0)}var O=[];function filterDuplicates(t){return t.reduce((function(t,e){return t.every((function(t){return e.name!==t.name}))&&t.push(e),t}),[])}function setupIntegrations(t){var e={};return function getIntegrationsToSetup(t){var e=t.defaultIntegrations&&tslib_es6_spread(t.defaultIntegrations)||[],n=t.integrations,i=tslib_es6_spread(filterDuplicates(e));Array.isArray(n)?i=tslib_es6_spread(i.filter((function(t){return n.every((function(e){return e.name!==t.name}))})),filterDuplicates(n)):"function"==typeof n&&(i=n(i),i=Array.isArray(i)?i:[i]);var o=i.map((function(t){return t.name})),r="Debug";return-1!==o.indexOf(r)&&i.push.apply(i,tslib_es6_spread(i.splice(o.indexOf(r),1))),i}(t).forEach((function(t){e[t.name]=t,function setupIntegration(t){-1===O.indexOf(t.name)&&(t.setupOnce(addGlobalEventProcessor,getCurrentHub),O.push(t.name),A.log("Integration installed: "+t.name))}(t)})),addNonEnumerableProperty(e,"initialized",!0),e}var F="Not capturing exception because it's already been captured.",j=function(){function BaseClient(t,e){this._integrations={},this._numProcessing=0,this._backend=new t(e),this._options=e,e.dsn&&(this._dsn=makeDsn(e.dsn))}return BaseClient.prototype.captureException=function(t,e,n){var i=this;if(!checkOrSetAlreadyCaught(t)){var o=e&&e.event_id;return this._process(this._getBackend().eventFromException(t,e).then((function(t){return i._captureEvent(t,e,n)})).then((function(t){o=t}))),o}A.log(F)},BaseClient.prototype.captureMessage=function(t,e,n,i){var o=this,r=n&&n.event_id,s=is_isPrimitive(t)?this._getBackend().eventFromMessage(String(t),e,n):this._getBackend().eventFromException(t,n);return this._process(s.then((function(t){return o._captureEvent(t,n,i)})).then((function(t){r=t}))),r},BaseClient.prototype.captureEvent=function(t,e,n){if(!(e&&e.originalException&&checkOrSetAlreadyCaught(e.originalException))){var i=e&&e.event_id;return this._process(this._captureEvent(t,e,n).then((function(t){i=t}))),i}A.log(F)},BaseClient.prototype.captureSession=function(t){this._isEnabled()?"string"!=typeof t.release?(0,b.c)()&&A.warn("Discarded session because of missing or non-string release"):(this._sendSession(t),t.update({init:!1})):(0,b.c)()&&A.warn("SDK not enabled, will not capture session.")},BaseClient.prototype.getDsn=function(){return this._dsn},BaseClient.prototype.getOptions=function(){return this._options},BaseClient.prototype.getTransport=function(){return this._getBackend().getTransport()},BaseClient.prototype.flush=function(t){var e=this;return this._isClientDoneProcessing(t).then((function(n){return e.getTransport().close(t).then((function(t){return n&&t}))}))},BaseClient.prototype.close=function(t){var e=this;return this.flush(t).then((function(t){return e.getOptions().enabled=!1,t}))},BaseClient.prototype.setupIntegrations=function(){this._isEnabled()&&!this._integrations.initialized&&(this._integrations=setupIntegrations(this._options))},BaseClient.prototype.getIntegration=function(t){try{return this._integrations[t.id]||null}catch(e){return A.warn("Cannot retrieve integration "+t.id+" from the current Client"),null}},BaseClient.prototype._updateSessionFromEvent=function(t,e){var n,i,o=!1,r=!1,s=e.exception&&e.exception.values;if(s){r=!0;try{for(var a=__values(s),c=a.next();!c.done;c=a.next()){var l=c.value.mechanism;if(l&&!1===l.handled){o=!0;break}}}catch(t){n={error:t}}finally{try{c&&!c.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}}var d="ok"===t.status;(d&&0===t.errors||d&&o)&&(t.update(tslib_es6_assign(tslib_es6_assign({},o&&{status:"crashed"}),{errors:t.errors||Number(r||o)})),this.captureSession(t))},BaseClient.prototype._sendSession=function(t){this._getBackend().sendSession(t)},BaseClient.prototype._isClientDoneProcessing=function(t){var e=this;return new _((function(n){var i=0,o=setInterval((function(){0==e._numProcessing?(clearInterval(o),n(!0)):(i+=1,t&&i>=t&&(clearInterval(o),n(!1)))}),1)}))},BaseClient.prototype._getBackend=function(){return this._backend},BaseClient.prototype._isEnabled=function(){return!1!==this.getOptions().enabled&&void 0!==this._dsn},BaseClient.prototype._prepareEvent=function(t,e,n){var i=this,o=this.getOptions().normalizeDepth,r=void 0===o?3:o,s=tslib_es6_assign(tslib_es6_assign({},t),{event_id:t.event_id||(n&&n.event_id?n.event_id:uuid4()),timestamp:t.timestamp||(0,v.yW)()});this._applyClientOptions(s),this._applyIntegrationsMetadata(s);var a=e;n&&n.captureContext&&(a=w.clone(a).update(n.captureContext));var c=resolvedSyncPromise(s);return a&&(c=a.applyToEvent(s,n)),c.then((function(t){return"number"==typeof r&&r>0?i._normalizeEvent(t,r):t}))},BaseClient.prototype._normalizeEvent=function(t,e){if(!t)return null;var n=tslib_es6_assign(tslib_es6_assign(tslib_es6_assign(tslib_es6_assign(tslib_es6_assign({},t),t.breadcrumbs&&{breadcrumbs:t.breadcrumbs.map((function(t){return tslib_es6_assign(tslib_es6_assign({},t),t.data&&{data:normalize(t.data,e)})}))}),t.user&&{user:normalize(t.user,e)}),t.contexts&&{contexts:normalize(t.contexts,e)}),t.extra&&{extra:normalize(t.extra,e)});return t.contexts&&t.contexts.trace&&(n.contexts.trace=t.contexts.trace),t.sdkProcessingMetadata=tslib_es6_assign(tslib_es6_assign({},t.sdkProcessingMetadata),{baseClientNormalized:!0}),n},BaseClient.prototype._applyClientOptions=function(t){var e=this.getOptions(),n=e.environment,i=e.release,o=e.dist,r=e.maxValueLength,s=void 0===r?250:r;"environment"in t||(t.environment="environment"in e?n:"production"),void 0===t.release&&void 0!==i&&(t.release=i),void 0===t.dist&&void 0!==o&&(t.dist=o),t.message&&(t.message=truncate(t.message,s));var a=t.exception&&t.exception.values&&t.exception.values[0];a&&a.value&&(a.value=truncate(a.value,s));var c=t.request;c&&c.url&&(c.url=truncate(c.url,s))},BaseClient.prototype._applyIntegrationsMetadata=function(t){var e=Object.keys(this._integrations);e.length>0&&(t.sdk=t.sdk||{},t.sdk.integrations=tslib_es6_spread(t.sdk.integrations||[],e))},BaseClient.prototype._sendEvent=function(t){this._getBackend().sendEvent(t)},BaseClient.prototype._captureEvent=function(t,e,n){return this._processEvent(t,e,n).then((function(t){return t.event_id}),(function(t){A.error(t)}))},BaseClient.prototype._processEvent=function(t,e,n){var i=this,o=this.getOptions(),r=o.beforeSend,s=o.sampleRate,a=this.getTransport();function recordLostEvent(t,e){a.recordLostEvent&&a.recordLostEvent(t,e)}if(!this._isEnabled())return rejectedSyncPromise(new k("SDK not enabled, will not capture event."));var c="transaction"===t.type;return!c&&"number"==typeof s&&Math.random()>s?(recordLostEvent("sample_rate","event"),rejectedSyncPromise(new k("Discarding event because it's not included in the random sample (sampling rate = "+s+")"))):this._prepareEvent(t,n,e).then((function(n){if(null===n)throw recordLostEvent("event_processor",t.type||"event"),new k("An event processor returned null, will not send event.");return e&&e.data&&!0===e.data.__sentry__||c||!r?n:function _ensureBeforeSendRv(t){var e="`beforeSend` method has to return `null` or a valid event.";if(isThenable(t))return t.then((function(t){if(!isPlainObject(t)&&null!==t)throw new k(e);return t}),(function(t){throw new k("beforeSend rejected with "+t)}));if(!isPlainObject(t)&&null!==t)throw new k(e);return t}(r(n,e))})).then((function(e){if(null===e)throw recordLostEvent("before_send",t.type||"event"),new k("`beforeSend` returned `null`, will not send event.");var o=n&&n.getSession&&n.getSession();return!c&&o&&i._updateSessionFromEvent(o,e),i._sendEvent(e),e})).then(null,(function(t){if(t instanceof k)throw t;throw i.captureException(t,{data:{__sentry__:!0},originalException:t}),new k("Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.\nReason: "+t)}))},BaseClient.prototype._process=function(t){var e=this;this._numProcessing+=1,t.then((function(t){return e._numProcessing-=1,t}),(function(t){return e._numProcessing-=1,t}))},BaseClient}();var B,D=function(){function NoopTransport(){}return NoopTransport.prototype.sendEvent=function(t){return resolvedSyncPromise({reason:"NoopTransport: Event has been skipped because no Dsn is configured.",status:"skipped"})},NoopTransport.prototype.close=function(t){return resolvedSyncPromise(!0)},NoopTransport}(),$=function(){function BaseBackend(t){this._options=t,this._options.dsn||A.warn("No DSN provided, backend will not do anything."),this._transport=this._setupTransport()}return BaseBackend.prototype.eventFromException=function(t,e){throw new k("Backend has to implement `eventFromException` method")},BaseBackend.prototype.eventFromMessage=function(t,e,n){throw new k("Backend has to implement `eventFromMessage` method")},BaseBackend.prototype.sendEvent=function(t){this._transport.sendEvent(t).then(null,(function(t){(0,b.c)()&&A.error("Error while sending event: "+t)}))},BaseBackend.prototype.sendSession=function(t){this._transport.sendSession?this._transport.sendSession(t).then(null,(function(t){(0,b.c)()&&A.error("Error while sending session: "+t)})):(0,b.c)()&&A.warn("Dropping session because custom transport doesn't implement sendSession")},BaseBackend.prototype.getTransport=function(){return this._transport},BaseBackend.prototype._setupTransport=function(){return new D},BaseBackend}();!function(t){t.Fatal="fatal",t.Error="error",t.Warning="warning",t.Log="log",t.Info="info",t.Debug="debug",t.Critical="critical"}(B||(B={}));function supportsFetch(){if(!("fetch"in(0,y.R)()))return!1;try{return new Headers,new Request(""),new Response,!0}catch(t){return!1}}function isNativeFetch(t){return t&&/^function fetch\(\)\s+\{\s+\[native code\]\s+\}$/.test(t.toString())}function supportsReferrerPolicy(){if(!supportsFetch())return!1;try{return new Request("_",{referrerPolicy:"origin"}),!0}catch(t){return!1}}var M="?",q=/^\s*at (?:(.*?) ?\()?((?:file|https?|blob|chrome-extension|address|native|eval|webpack|<anonymous>|[-a-z]+:|.*bundle|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,N=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:file|https?|blob|chrome|webpack|resource|moz-extension|capacitor).*?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,H=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,U=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,z=/\((\S*)(?::(\d+))(?::(\d+))\)/,W=/Minified React error #\d+;/i;function computeStackTrace(t){var e=null,n=0;t&&("number"==typeof t.framesToPop?n=t.framesToPop:W.test(t.message)&&(n=1));try{if(e=function computeStackTraceFromStacktraceProp(t){if(!t||!t.stacktrace)return null;for(var e,n=t.stacktrace,i=/ line (\d+).*script (?:in )?(\S+)(?:: in function (\S+))?$/i,o=/ line (\d+), column (\d+)\s*(?:in (?:<anonymous function: ([^>]+)>|([^)]+))\((.*)\))? in (.*):\s*$/i,r=n.split("\n"),s=[],a=0;a<r.length;a+=2){var c=null;(e=i.exec(r[a]))?c={url:e[2],func:e[3],args:[],line:+e[1],column:null}:(e=o.exec(r[a]))&&(c={url:e[6],func:e[3]||e[4],args:e[5]?e[5].split(","):[],line:+e[1],column:+e[2]}),c&&(!c.func&&c.line&&(c.func=M),s.push(c))}if(!s.length)return null;return{message:extractMessage(t),name:t.name,stack:s}}(t),e)return popFrames(e,n)}catch(t){}try{if(e=function computeStackTraceFromStackProp(t){var e,n;if(!t||!t.stack)return null;for(var i,o,r,s=[],a=t.stack.split("\n"),c=0;c<a.length;++c){if(o=q.exec(a[c])){var l=o[2]&&0===o[2].indexOf("native");o[2]&&0===o[2].indexOf("eval")&&(i=z.exec(o[2]))&&(o[2]=i[1],o[3]=i[2],o[4]=i[3]);var d=o[2]&&0===o[2].indexOf("address at ")?o[2].substr("address at ".length):o[2],p=o[1]||M;p=(e=__read(extractSafariExtensionDetails(p,d),2))[0],r={url:d=e[1],func:p,args:l?[o[2]]:[],line:o[3]?+o[3]:null,column:o[4]?+o[4]:null}}else if(o=H.exec(a[c]))r={url:o[2],func:o[1]||M,args:[],line:+o[3],column:o[4]?+o[4]:null};else{if(!(o=N.exec(a[c])))continue;o[3]&&o[3].indexOf(" > eval")>-1&&(i=U.exec(o[3]))?(o[1]=o[1]||"eval",o[3]=i[1],o[4]=i[2],o[5]=""):0!==c||o[5]||void 0===t.columnNumber||(s[0].column=t.columnNumber+1);d=o[3],p=o[1]||M;p=(n=__read(extractSafariExtensionDetails(p,d),2))[0],r={url:d=n[1],func:p,args:o[2]?o[2].split(","):[],line:o[4]?+o[4]:null,column:o[5]?+o[5]:null}}!r.func&&r.line&&(r.func=M),s.push(r)}if(!s.length)return null;return{message:extractMessage(t),name:t.name,stack:s}}(t),e)return popFrames(e,n)}catch(t){}return{message:extractMessage(t),name:t&&t.name,stack:[],failed:!0}}var extractSafariExtensionDetails=function(t,e){var n=-1!==t.indexOf("safari-extension"),i=-1!==t.indexOf("safari-web-extension");return n||i?[-1!==t.indexOf("@")?t.split("@")[0]:M,n?"safari-extension:"+e:"safari-web-extension:"+e]:[t,e]};function popFrames(t,e){try{return tslib_es6_assign(tslib_es6_assign({},t),{stack:t.stack.slice(e)})}catch(e){return t}}function extractMessage(t){var e=t&&t.message;return e?e.error&&"string"==typeof e.error.message?e.error.message:e:"No error message"}function exceptionFromStacktrace(t){var e=prepareFramesForEvent(t.stack),n={type:t.name,value:t.message};return e&&e.length&&(n.stacktrace={frames:e}),void 0===n.type&&""===n.value&&(n.value="Unrecoverable error caught"),n}function eventFromStacktrace(t){return{exception:{values:[exceptionFromStacktrace(t)]}}}function prepareFramesForEvent(t){if(!t||!t.length)return[];var e=t,n=e[0].func||"",i=e[e.length-1].func||"";return-1===n.indexOf("captureMessage")&&-1===n.indexOf("captureException")||(e=e.slice(1)),-1!==i.indexOf("sentryWrapped")&&(e=e.slice(0,-1)),e.slice(0,50).map((function(t){return{colno:null===t.column?void 0:t.column,filename:t.url||e[0].url,function:t.func||"?",in_app:!0,lineno:null===t.line?void 0:t.line}})).reverse()}function eventFromUnknownInput(t,e,n){var i;if(void 0===n&&(n={}),isErrorEvent(t)&&t.error)return i=eventFromStacktrace(computeStackTrace(t=t.error));if(isDOMError(t)||function isDOMException(t){return isBuiltin(t,"DOMException")}(t)){var o=t;if("stack"in t)i=eventFromStacktrace(computeStackTrace(t));else{var r=o.name||(isDOMError(o)?"DOMError":"DOMException"),s=o.message?r+": "+o.message:r;addExceptionTypeValue(i=eventFromString(s,e,n),s)}return"code"in o&&(i.tags=tslib_es6_assign(tslib_es6_assign({},i.tags),{"DOMException.code":""+o.code})),i}return isError(t)?i=eventFromStacktrace(computeStackTrace(t)):isPlainObject(t)||isEvent(t)?(i=function eventFromPlainObject(t,e,n){var i={exception:{values:[{type:isEvent(t)?t.constructor.name:n?"UnhandledRejection":"Error",value:"Non-Error "+(n?"promise rejection":"exception")+" captured with keys: "+extractExceptionKeysForMessage(t)}]},extra:{__serialized__:normalizeToSize(t)}};if(e){var o=prepareFramesForEvent(computeStackTrace(e).stack);i.stacktrace={frames:o}}return i}(t,e,n.isRejection),addExceptionMechanism(i,{synthetic:!0}),i):(addExceptionTypeValue(i=eventFromString(t,e,n),""+t,void 0),addExceptionMechanism(i,{synthetic:!0}),i)}function eventFromString(t,e,n){void 0===n&&(n={});var i={message:t};if(n.attachStacktrace&&e){var o=prepareFramesForEvent(computeStackTrace(e).stack);i.stacktrace={frames:o}}return i}!function(){function API(t,e,n){void 0===e&&(e={}),this.dsn=t,this._dsnObject=makeDsn(t),this.metadata=e,this._tunnel=n}API.prototype.getDsn=function(){return this._dsnObject},API.prototype.forceEnvelope=function(){return!!this._tunnel},API.prototype.getBaseApiEndpoint=function(){return getBaseApiEndpoint(this._dsnObject)},API.prototype.getStoreEndpoint=function(){return getStoreEndpoint(this._dsnObject)},API.prototype.getStoreEndpointWithUrlEncodedAuth=function(){return getStoreEndpointWithUrlEncodedAuth(this._dsnObject)},API.prototype.getEnvelopeEndpointWithUrlEncodedAuth=function(){return getEnvelopeEndpointWithUrlEncodedAuth(this._dsnObject,this._tunnel)}}();function getBaseApiEndpoint(t){var e=t.protocol?t.protocol+":":"",n=t.port?":"+t.port:"";return e+"//"+t.host+n+(t.path?"/"+t.path:"")+"/api/"}function _getIngestEndpoint(t,e){return""+getBaseApiEndpoint(t)+t.projectId+"/"+e+"/"}function _encodedAuth(t){return function urlEncode(t){return Object.keys(t).map((function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])})).join("&")}({sentry_key:t.publicKey,sentry_version:"7"})}function getStoreEndpoint(t){return _getIngestEndpoint(t,"store")}function getStoreEndpointWithUrlEncodedAuth(t){return getStoreEndpoint(t)+"?"+_encodedAuth(t)}function getEnvelopeEndpointWithUrlEncodedAuth(t,e){return e||function _getEnvelopeEndpoint(t){return _getIngestEndpoint(t,"envelope")}(t)+"?"+_encodedAuth(t)}function getSdkMetadataForEnvelopeHeader(t){if(t.metadata&&t.metadata.sdk){var e=t.metadata.sdk;return{name:e.name,version:e.version}}}function eventToSentryRequest(t,e){var n,i=getSdkMetadataForEnvelopeHeader(e),o=t.type||"event",r="transaction"===o||!!e.tunnel,s=(t.sdkProcessingMetadata||{}).transactionSampling||{},a=s.method,c=s.rate;!function enhanceEventWithSdkInfo(t,e){return e?(t.sdk=t.sdk||{},t.sdk.name=t.sdk.name||e.name,t.sdk.version=t.sdk.version||e.version,t.sdk.integrations=tslib_es6_spread(t.sdk.integrations||[],e.integrations||[]),t.sdk.packages=tslib_es6_spread(t.sdk.packages||[],e.packages||[]),t):t}(t,e.metadata.sdk),t.tags=t.tags||{},t.extra=t.extra||{},t.sdkProcessingMetadata&&t.sdkProcessingMetadata.baseClientNormalized||(t.tags.skippedNormalization=!0),delete t.sdkProcessingMetadata;try{n=JSON.stringify(t)}catch(e){t.tags.JSONStringifyError=!0,t.extra.JSONStringifyError=e;try{n=JSON.stringify(normalize(t))}catch(t){var l=t;n=JSON.stringify({message:"JSON.stringify error after renormalization",extra:{message:l.message,stack:l.stack}})}}var d={body:n,type:o,url:r?getEnvelopeEndpointWithUrlEncodedAuth(e.dsn,e.tunnel):getStoreEndpointWithUrlEncodedAuth(e.dsn)};if(r){var p=JSON.stringify(tslib_es6_assign(tslib_es6_assign({event_id:t.event_id,sent_at:(new Date).toISOString()},i&&{sdk:i}),!!e.tunnel&&{dsn:dsnToString(e.dsn)}))+"\n"+JSON.stringify({type:o,sample_rates:[{id:a,rate:c}]})+"\n"+d.body;d.body=p}return d}function makePromiseBuffer(t){var e=[];function remove(t){return e.splice(e.indexOf(t),1)[0]}return{$:e,add:function add(n){if(!function isReady(){return void 0===t||e.length<t}())return rejectedSyncPromise(new k("Not adding Promise due to buffer limit reached."));var i=n();return-1===e.indexOf(i)&&e.push(i),i.then((function(){return remove(i)})).then(null,(function(){return remove(i).then(null,(function(){}))})),i},drain:function drain(t){return new _((function(n,i){var o=e.length;if(!o)return n(!0);var r=setTimeout((function(){t&&t>0&&n(!1)}),t);e.forEach((function(t){resolvedSyncPromise(t).then((function(){--o||(clearTimeout(r),n(!0))}),i)}))}))}}}var V,G=(0,y.R)();function getNativeFetchImplementation(){if(V)return V;if(isNativeFetch(G.fetch))return V=G.fetch.bind(G);var t=G.document,e=G.fetch;if(t&&"function"==typeof t.createElement)try{var n=t.createElement("iframe");n.hidden=!0,t.head.appendChild(n);var i=n.contentWindow;i&&i.fetch&&(e=i.fetch),t.head.removeChild(n)}catch(t){(0,b.c)()&&A.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",t)}return V=e.bind(G)}function sendReport(t,e){return"[object Navigator]"===Object.prototype.toString.call(G&&G.navigator)&&"function"==typeof G.navigator.sendBeacon?G.navigator.sendBeacon.bind(G.navigator)(t,e):supportsFetch()?function forget(t){t.then(null,(function(t){console.error(t)}))}(getNativeFetchImplementation()(t,{body:e,method:"POST",credentials:"omit",keepalive:!0})):void 0}function requestTypeToCategory(t){return"event"===t?"error":t}var K=(0,y.R)(),Y=function(){function BaseTransport(t){var e=this;this.options=t,this._buffer=makePromiseBuffer(30),this._rateLimits={},this._outcomes={},this._api=function initAPIDetails(t,e,n){return{initDsn:t,metadata:e||{},dsn:makeDsn(t),tunnel:n}}(t.dsn,t._metadata,t.tunnel),this.url=getStoreEndpointWithUrlEncodedAuth(this._api.dsn),this.options.sendClientReports&&K.document&&K.document.addEventListener("visibilitychange",(function(){"hidden"===K.document.visibilityState&&e._flushOutcomes()}))}return BaseTransport.prototype.sendEvent=function(t){return this._sendRequest(eventToSentryRequest(t,this._api),t)},BaseTransport.prototype.sendSession=function(t){return this._sendRequest(function sessionToSentryRequest(t,e){var n=getSdkMetadataForEnvelopeHeader(e),i="aggregates"in t?"sessions":"session";return{body:JSON.stringify(tslib_es6_assign(tslib_es6_assign({sent_at:(new Date).toISOString()},n&&{sdk:n}),!!e.tunnel&&{dsn:dsnToString(e.dsn)}))+"\n"+JSON.stringify({type:i})+"\n"+JSON.stringify(t),type:i,url:getEnvelopeEndpointWithUrlEncodedAuth(e.dsn,e.tunnel)}}(t,this._api),t)},BaseTransport.prototype.close=function(t){return this._buffer.drain(t)},BaseTransport.prototype.recordLostEvent=function(t,e){var n;if(this.options.sendClientReports){var i=requestTypeToCategory(e)+":"+t;A.log("Adding outcome: "+i),this._outcomes[i]=(null!=(n=this._outcomes[i])?n:0)+1}},BaseTransport.prototype._flushOutcomes=function(){if(this.options.sendClientReports){var t=this._outcomes;if(this._outcomes={},Object.keys(t).length){A.log("Flushing outcomes:\n"+JSON.stringify(t,null,2));var e=getEnvelopeEndpointWithUrlEncodedAuth(this._api.dsn,this._api.tunnel),n=JSON.stringify(tslib_es6_assign({},this._api.tunnel&&{dsn:dsnToString(this._api.dsn)}))+"\n"+JSON.stringify({type:"client_report"})+"\n"+JSON.stringify({timestamp:(0,v.yW)(),discarded_events:Object.keys(t).map((function(e){var n=__read(e.split(":"),2),i=n[0];return{reason:n[1],category:i,quantity:t[e]}}))});try{sendReport(e,n)}catch(t){A.error(t)}}else A.log("No outcomes to flush")}},BaseTransport.prototype._handleResponse=function(t){var e=t.requestType,n=t.response,i=t.headers,o=t.resolve,r=t.reject,s=function eventStatusFromHttpCode(t){return t>=200&&t<300?"success":429===t?"rate_limit":t>=400&&t<500?"invalid":t>=500?"failed":"unknown"}(n.status);this._handleRateLimit(i)&&(0,b.c)()&&A.warn("Too many "+e+" requests, backing off until: "+this._disabledUntil(e)),"success"!==s?r(n):o({status:s})},BaseTransport.prototype._disabledUntil=function(t){var e=requestTypeToCategory(t);return this._rateLimits[e]||this._rateLimits.all},BaseTransport.prototype._isRateLimited=function(t){return this._disabledUntil(t)>new Date(Date.now())},BaseTransport.prototype._handleRateLimit=function(t){var e,n,i,o,r=Date.now(),s=t["x-sentry-rate-limits"],a=t["retry-after"];if(s){try{for(var c=__values(s.trim().split(",")),l=c.next();!l.done;l=c.next()){var d=l.value.split(":",2),p=parseInt(d[0],10),u=1e3*(isNaN(p)?60:p);try{for(var h=(i=void 0,__values(d[1].split(";"))),g=h.next();!g.done;g=h.next()){var m=g.value;this._rateLimits[m||"all"]=new Date(r+u)}}catch(t){i={error:t}}finally{try{g&&!g.done&&(o=h.return)&&o.call(h)}finally{if(i)throw i.error}}}}catch(t){e={error:t}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(e)throw e.error}}return!0}return!!a&&(this._rateLimits.all=new Date(r+function parseRetryAfterHeader(t,e){if(!e)return 6e4;var n=parseInt(""+e,10);if(!isNaN(n))return 1e3*n;var i=Date.parse(""+e);return isNaN(i)?6e4:i-t}(r,a)),!0)},BaseTransport}(),J=function(t){function FetchTransport(e,n){void 0===n&&(n=getNativeFetchImplementation());var i=t.call(this,e)||this;return i._fetch=n,i}return __extends(FetchTransport,t),FetchTransport.prototype._sendRequest=function(t,e){var n=this;if(this._isRateLimited(t.type))return this.recordLostEvent("ratelimit_backoff",t.type),Promise.reject({event:e,type:t.type,reason:"Transport for "+t.type+" requests locked till "+this._disabledUntil(t.type)+" due to too many requests.",status:429});var i={body:t.body,method:"POST",referrerPolicy:supportsReferrerPolicy()?"origin":""};return void 0!==this.options.fetchParameters&&Object.assign(i,this.options.fetchParameters),void 0!==this.options.headers&&(i.headers=this.options.headers),this._buffer.add((function(){return new _((function(e,o){n._fetch(t.url,i).then((function(i){var r={"x-sentry-rate-limits":i.headers.get("X-Sentry-Rate-Limits"),"retry-after":i.headers.get("Retry-After")};n._handleResponse({requestType:t.type,response:i,headers:r,resolve:e,reject:o})})).catch(o)}))})).then(void 0,(function(e){throw e instanceof k?n.recordLostEvent("queue_overflow",t.type):n.recordLostEvent("network_error",t.type),e}))},FetchTransport}(Y),X=function(t){function XHRTransport(){return null!==t&&t.apply(this,arguments)||this}return __extends(XHRTransport,t),XHRTransport.prototype._sendRequest=function(t,e){var n=this;return this._isRateLimited(t.type)?(this.recordLostEvent("ratelimit_backoff",t.type),Promise.reject({event:e,type:t.type,reason:"Transport for "+t.type+" requests locked till "+this._disabledUntil(t.type)+" due to too many requests.",status:429})):this._buffer.add((function(){return new _((function(e,i){var o=new XMLHttpRequest;for(var r in o.onreadystatechange=function(){if(4===o.readyState){var r={"x-sentry-rate-limits":o.getResponseHeader("X-Sentry-Rate-Limits"),"retry-after":o.getResponseHeader("Retry-After")};n._handleResponse({requestType:t.type,response:o,headers:r,resolve:e,reject:i})}},o.open("POST",t.url),n.options.headers)Object.prototype.hasOwnProperty.call(n.options.headers,r)&&o.setRequestHeader(r,n.options.headers[r]);o.send(t.body)}))})).then(void 0,(function(e){throw e instanceof k?n.recordLostEvent("queue_overflow",t.type):n.recordLostEvent("network_error",t.type),e}))},XHRTransport}(Y),Q=function(t){function BrowserBackend(){return null!==t&&t.apply(this,arguments)||this}return __extends(BrowserBackend,t),BrowserBackend.prototype.eventFromException=function(t,e){return function eventFromException(t,e,n){var i=eventFromUnknownInput(e,n&&n.syntheticException||void 0,{attachStacktrace:t.attachStacktrace});return addExceptionMechanism(i),i.level=B.Error,n&&n.event_id&&(i.event_id=n.event_id),resolvedSyncPromise(i)}(this._options,t,e)},BrowserBackend.prototype.eventFromMessage=function(t,e,n){return void 0===e&&(e=B.Info),function eventFromMessage(t,e,n,i){void 0===n&&(n=B.Info);var o=eventFromString(e,i&&i.syntheticException||void 0,{attachStacktrace:t.attachStacktrace});return o.level=n,i&&i.event_id&&(o.event_id=i.event_id),resolvedSyncPromise(o)}(this._options,t,e,n)},BrowserBackend.prototype._setupTransport=function(){if(!this._options.dsn)return t.prototype._setupTransport.call(this);var e=tslib_es6_assign(tslib_es6_assign({},this._options.transportOptions),{dsn:this._options.dsn,tunnel:this._options.tunnel,sendClientReports:this._options.sendClientReports,_metadata:this._options._metadata});return this._options.transport?new this._options.transport(e):supportsFetch()?new J(e):new X(e)},BrowserBackend}($);function callOnHub(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var i=getCurrentHub();if(i&&i[t])return i[t].apply(i,tslib_es6_spread(e));throw new Error("No hub defined or "+t+" was not found on the hub, please open a bug report.")}function captureException(t,e){var n;try{throw new Error("Sentry syntheticException")}catch(t){n=t}return callOnHub("captureException",t,{captureContext:e,originalException:t,syntheticException:n})}function withScope(t){callOnHub("withScope",t)}var Z=(0,y.R)(),tt=0;function shouldIgnoreOnError(){return tt>0}function ignoreNextOnError(){tt+=1,setTimeout((function(){tt-=1}))}function wrap(t,e,n){if(void 0===e&&(e={}),"function"!=typeof t)return t;try{var i=t.__sentry_wrapped__;if(i)return i;if(getOriginalFunction(t))return t}catch(e){return t}var sentryWrapped=function(){var i=Array.prototype.slice.call(arguments);try{n&&"function"==typeof n&&n.apply(this,arguments);var o=i.map((function(t){return wrap(t,e)}));return t.apply(this,o)}catch(t){throw ignoreNextOnError(),withScope((function(n){n.addEventProcessor((function(t){return e.mechanism&&(addExceptionTypeValue(t,void 0,void 0),addExceptionMechanism(t,e.mechanism)),t.extra=tslib_es6_assign(tslib_es6_assign({},t.extra),{arguments:i}),t})),captureException(t)})),t}};try{for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(sentryWrapped[o]=t[o])}catch(t){}markFunctionWrapped(sentryWrapped,t),addNonEnumerableProperty(t,"__sentry_wrapped__",sentryWrapped);try{Object.getOwnPropertyDescriptor(sentryWrapped,"name").configurable&&Object.defineProperty(sentryWrapped,"name",{get:function(){return t.name}})}catch(t){}return sentryWrapped}function injectReportDialog(t){if(void 0===t&&(t={}),Z.document)if(t.eventId)if(t.dsn){var e=Z.document.createElement("script");e.async=!0,e.src=function getReportDialogEndpoint(t,e){var n=makeDsn(t),i=getBaseApiEndpoint(n)+"embed/error-page/",o="dsn="+dsnToString(n);for(var r in e)if("dsn"!==r)if("user"===r){if(!e.user)continue;e.user.name&&(o+="&name="+encodeURIComponent(e.user.name)),e.user.email&&(o+="&email="+encodeURIComponent(e.user.email))}else o+="&"+encodeURIComponent(r)+"="+encodeURIComponent(e[r]);return i+"?"+o}(t.dsn,t),t.onLoad&&(e.onload=t.onLoad);var n=Z.document.head||Z.document.body;n&&n.appendChild(e)}else(0,b.c)()&&A.error("Missing dsn option in showReportDialog call");else(0,b.c)()&&A.error("Missing eventId option in showReportDialog call")}var et,nt=(0,y.R)(),it={},ot={};function instrument(t){if(!ot[t])switch(ot[t]=!0,t){case"console":!function instrumentConsole(){if(!("console"in nt))return;["debug","info","warn","error","log","assert"].forEach((function(t){t in nt.console&&fill(nt.console,t,(function(e){return function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];triggerHandlers("console",{args:n,level:t}),e&&Function.prototype.apply.call(e,nt.console,n)}}))}))}();break;case"dom":!function instrumentDOM(){if(!("document"in nt))return;var t=triggerHandlers.bind(null,"dom"),e=makeDOMEventHandler(t,!0);nt.document.addEventListener("click",e,!1),nt.document.addEventListener("keypress",e,!1),["EventTarget","Node"].forEach((function(e){var n=nt[e]&&nt[e].prototype;n&&n.hasOwnProperty&&n.hasOwnProperty("addEventListener")&&(fill(n,"addEventListener",(function(e){return function(n,i,o){if("click"===n||"keypress"==n)try{var r=this,s=r.__sentry_instrumentation_handlers__=r.__sentry_instrumentation_handlers__||{},a=s[n]=s[n]||{refCount:0};if(!a.handler){var c=makeDOMEventHandler(t);a.handler=c,e.call(this,n,c,o)}a.refCount+=1}catch(t){}return e.call(this,n,i,o)}})),fill(n,"removeEventListener",(function(t){return function(e,n,i){if("click"===e||"keypress"==e)try{var o=this,r=o.__sentry_instrumentation_handlers__||{},s=r[e];s&&(s.refCount-=1,s.refCount<=0&&(t.call(this,e,s.handler,i),s.handler=void 0,delete r[e]),0===Object.keys(r).length&&delete o.__sentry_instrumentation_handlers__)}catch(t){}return t.call(this,e,n,i)}})))}))}();break;case"xhr":!function instrumentXHR(){if(!("XMLHttpRequest"in nt))return;var t=XMLHttpRequest.prototype;fill(t,"open",(function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var i=this,o=e[1],r=i.__sentry_xhr__={method:isString(e[0])?e[0].toUpperCase():e[0],url:e[1]};isString(o)&&"POST"===r.method&&o.match(/sentry_key/)&&(i.__sentry_own_request__=!0);var onreadystatechangeHandler=function(){if(4===i.readyState){try{r.status_code=i.status}catch(t){}triggerHandlers("xhr",{args:e,endTimestamp:Date.now(),startTimestamp:Date.now(),xhr:i})}};return"onreadystatechange"in i&&"function"==typeof i.onreadystatechange?fill(i,"onreadystatechange",(function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return onreadystatechangeHandler(),t.apply(i,e)}})):i.addEventListener("readystatechange",onreadystatechangeHandler),t.apply(i,e)}})),fill(t,"send",(function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return this.__sentry_xhr__&&void 0!==e[0]&&(this.__sentry_xhr__.body=e[0]),triggerHandlers("xhr",{args:e,startTimestamp:Date.now(),xhr:this}),t.apply(this,e)}}))}();break;case"fetch":!function instrumentFetch(){if(!function supportsNativeFetch(){if(!supportsFetch())return!1;var t=(0,y.R)();if(isNativeFetch(t.fetch))return!0;var e=!1,n=t.document;if(n&&"function"==typeof n.createElement)try{var i=n.createElement("iframe");i.hidden=!0,n.head.appendChild(i),i.contentWindow&&i.contentWindow.fetch&&(e=isNativeFetch(i.contentWindow.fetch)),n.head.removeChild(i)}catch(t){(0,b.c)()&&A.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",t)}return e}())return;fill(nt,"fetch",(function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var i={args:e,fetchData:{method:getFetchMethod(e),url:getFetchUrl(e)},startTimestamp:Date.now()};return triggerHandlers("fetch",tslib_es6_assign({},i)),t.apply(nt,e).then((function(t){return triggerHandlers("fetch",tslib_es6_assign(tslib_es6_assign({},i),{endTimestamp:Date.now(),response:t})),t}),(function(t){throw triggerHandlers("fetch",tslib_es6_assign(tslib_es6_assign({},i),{endTimestamp:Date.now(),error:t})),t}))}}))}();break;case"history":!function instrumentHistory(){if(!function supportsHistory(){var t=(0,y.R)(),e=t.chrome,n=e&&e.app&&e.app.runtime,i="history"in t&&!!t.history.pushState&&!!t.history.replaceState;return!n&&i}())return;var t=nt.onpopstate;function historyReplacementFunction(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var i=e.length>2?e[2]:void 0;if(i){var o=et,r=String(i);et=r,triggerHandlers("history",{from:o,to:r})}return t.apply(this,e)}}nt.onpopstate=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var i=nt.location.href,o=et;if(et=i,triggerHandlers("history",{from:o,to:i}),t)try{return t.apply(this,e)}catch(t){}},fill(nt.history,"pushState",historyReplacementFunction),fill(nt.history,"replaceState",historyReplacementFunction)}();break;case"error":!function instrumentError(){at=nt.onerror,nt.onerror=function(t,e,n,i,o){return triggerHandlers("error",{column:i,error:o,line:n,msg:t,url:e}),!!at&&at.apply(this,arguments)}}();break;case"unhandledrejection":!function instrumentUnhandledRejection(){ct=nt.onunhandledrejection,nt.onunhandledrejection=function(t){return triggerHandlers("unhandledrejection",t),!ct||ct.apply(this,arguments)}}();break;default:A.warn("unknown instrumentation type:",t)}}function addInstrumentationHandler(t,e){it[t]=it[t]||[],it[t].push(e),instrument(t)}function triggerHandlers(t,e){var n,i;if(t&&it[t])try{for(var o=__values(it[t]||[]),r=o.next();!r.done;r=o.next()){var s=r.value;try{s(e)}catch(e){(0,b.c)()&&A.error("Error while triggering instrumentation handler.\nType: "+t+"\nName: "+getFunctionName(s)+"\nError: "+e)}}}catch(t){n={error:t}}finally{try{r&&!r.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}}function getFetchMethod(t){return void 0===t&&(t=[]),"Request"in nt&&isInstanceOf(t[0],Request)&&t[0].method?String(t[0].method).toUpperCase():t[1]&&t[1].method?String(t[1].method).toUpperCase():"GET"}function getFetchUrl(t){return void 0===t&&(t=[]),"string"==typeof t[0]?t[0]:"Request"in nt&&isInstanceOf(t[0],Request)?t[0].url:String(t[0])}var rt,st;function makeDOMEventHandler(t,e){return void 0===e&&(e=!1),function(n){if(n&&st!==n&&!function shouldSkipDOMEvent(t){if("keypress"!==t.type)return!1;try{var e=t.target;if(!e||!e.tagName)return!0;if("INPUT"===e.tagName||"TEXTAREA"===e.tagName||e.isContentEditable)return!1}catch(t){}return!0}(n)){var i="keypress"===n.type?"input":n.type;(void 0===rt||function shouldShortcircuitPreviousDebounce(t,e){if(!t)return!0;if(t.type!==e.type)return!0;try{if(t.target!==e.target)return!0}catch(t){}return!1}(st,n))&&(t({event:n,name:i,global:e}),st=n),clearTimeout(rt),rt=nt.setTimeout((function(){rt=void 0}),1e3)}}}var at=null;var ct=null;var lt=["fatal","error","warning","log","info","debug","critical"];function severityFromString(t){return"warn"===t?B.Warning:function isSupportedSeverity(t){return-1!==lt.indexOf(t)}(t)?t:B.Log}var dt=function(){function Breadcrumbs(t){this.name=Breadcrumbs.id,this._options=tslib_es6_assign({console:!0,dom:!0,fetch:!0,history:!0,sentry:!0,xhr:!0},t)}return Breadcrumbs.prototype.addSentryBreadcrumb=function(t){this._options.sentry&&getCurrentHub().addBreadcrumb({category:"sentry."+("transaction"===t.type?"transaction":"event"),event_id:t.event_id,level:t.level,message:getEventDescription(t)},{event:t})},Breadcrumbs.prototype.setupOnce=function(){this._options.console&&addInstrumentationHandler("console",_consoleBreadcrumb),this._options.dom&&addInstrumentationHandler("dom",function _domBreadcrumb(t){function _innerDomBreadcrumb(e){var n,i="object"==typeof t?t.serializeAttribute:void 0;"string"==typeof i&&(i=[i]);try{n=e.event.target?htmlTreeAsString(e.event.target,i):htmlTreeAsString(e.event,i)}catch(t){n="<unknown>"}0!==n.length&&getCurrentHub().addBreadcrumb({category:"ui."+e.name,message:n},{event:e.event,name:e.name,global:e.global})}return _innerDomBreadcrumb}(this._options.dom)),this._options.xhr&&addInstrumentationHandler("xhr",_xhrBreadcrumb),this._options.fetch&&addInstrumentationHandler("fetch",_fetchBreadcrumb),this._options.history&&addInstrumentationHandler("history",_historyBreadcrumb)},Breadcrumbs.id="Breadcrumbs",Breadcrumbs}();function _consoleBreadcrumb(t){var e={category:"console",data:{arguments:t.args,logger:"console"},level:severityFromString(t.level),message:safeJoin(t.args," ")};if("assert"===t.level){if(!1!==t.args[0])return;e.message="Assertion failed: "+(safeJoin(t.args.slice(1)," ")||"console.assert"),e.data.arguments=t.args.slice(1)}getCurrentHub().addBreadcrumb(e,{input:t.args,level:t.level})}function _xhrBreadcrumb(t){if(t.endTimestamp){if(t.xhr.__sentry_own_request__)return;var e=t.xhr.__sentry_xhr__||{},n=e.method,i=e.url,o=e.status_code,r=e.body;getCurrentHub().addBreadcrumb({category:"xhr",data:{method:n,url:i,status_code:o},type:"http"},{xhr:t.xhr,input:r})}else;}function _fetchBreadcrumb(t){t.endTimestamp&&(t.fetchData.url.match(/sentry_key/)&&"POST"===t.fetchData.method||(t.error?getCurrentHub().addBreadcrumb({category:"fetch",data:t.fetchData,level:B.Error,type:"http"},{data:t.error,input:t.args}):getCurrentHub().addBreadcrumb({category:"fetch",data:tslib_es6_assign(tslib_es6_assign({},t.fetchData),{status_code:t.response.status}),type:"http"},{input:t.args,response:t.response})))}function _historyBreadcrumb(t){var e=(0,y.R)(),n=t.from,i=t.to,o=parseUrl(e.location.href),r=parseUrl(n),s=parseUrl(i);r.path||(r=o),o.protocol===s.protocol&&o.host===s.host&&(i=s.relative),o.protocol===r.protocol&&o.host===r.host&&(n=r.relative),getCurrentHub().addBreadcrumb({category:"navigation",data:{from:n,to:i}})}var pt,ut=function(t){function BrowserClient(e){void 0===e&&(e={});return e._metadata=e._metadata||{},e._metadata.sdk=e._metadata.sdk||{name:"sentry.javascript.browser",packages:[{name:"npm:@sentry/browser",version:m}],version:m},t.call(this,Q,e)||this}return __extends(BrowserClient,t),BrowserClient.prototype.showReportDialog=function(t){void 0===t&&(t={}),(0,y.R)().document&&(this._isEnabled()?injectReportDialog(tslib_es6_assign(tslib_es6_assign({},t),{dsn:t.dsn||this.getDsn()})):A.error("Trying to call showReportDialog with Sentry Client disabled"))},BrowserClient.prototype._prepareEvent=function(e,n,i){return e.platform=e.platform||"javascript",t.prototype._prepareEvent.call(this,e,n,i)},BrowserClient.prototype._sendEvent=function(e){var n=this.getIntegration(dt);n&&n.addSentryBreadcrumb(e),t.prototype._sendEvent.call(this,e)},BrowserClient}(j),ht=function(){function FunctionToString(){this.name=FunctionToString.id}return FunctionToString.prototype.setupOnce=function(){pt=Function.prototype.toString,Function.prototype.toString=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=getOriginalFunction(this)||this;return pt.apply(n,t)}},FunctionToString.id="FunctionToString",FunctionToString}(),gt=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/],mt=function(){function InboundFilters(t){void 0===t&&(t={}),this._options=t,this.name=InboundFilters.id}return InboundFilters.prototype.setupOnce=function(){addGlobalEventProcessor((function(t){var e=getCurrentHub();if(!e)return t;var n=e.getIntegration(InboundFilters);if(n){var i=e.getClient(),o=i?i.getOptions():{},r="function"==typeof n._mergeOptions?n._mergeOptions(o):{};return"function"!=typeof n._shouldDropEvent?t:n._shouldDropEvent(t,r)?null:t}return t}))},InboundFilters.prototype._shouldDropEvent=function(t,e){return this._isSentryError(t,e)?((0,b.c)()&&A.warn("Event dropped due to being internal Sentry Error.\nEvent: "+getEventDescription(t)),!0):this._isIgnoredError(t,e)?((0,b.c)()&&A.warn("Event dropped due to being matched by `ignoreErrors` option.\nEvent: "+getEventDescription(t)),!0):this._isDeniedUrl(t,e)?((0,b.c)()&&A.warn("Event dropped due to being matched by `denyUrls` option.\nEvent: "+getEventDescription(t)+".\nUrl: "+this._getEventFilterUrl(t)),!0):!this._isAllowedUrl(t,e)&&((0,b.c)()&&A.warn("Event dropped due to not being matched by `allowUrls` option.\nEvent: "+getEventDescription(t)+".\nUrl: "+this._getEventFilterUrl(t)),!0)},InboundFilters.prototype._isSentryError=function(t,e){if(!e.ignoreInternal)return!1;try{return"SentryError"===t.exception.values[0].type}catch(t){}return!1},InboundFilters.prototype._isIgnoredError=function(t,e){return!(!e.ignoreErrors||!e.ignoreErrors.length)&&this._getPossibleEventMessages(t).some((function(t){return e.ignoreErrors.some((function(e){return isMatchingPattern(t,e)}))}))},InboundFilters.prototype._isDeniedUrl=function(t,e){if(!e.denyUrls||!e.denyUrls.length)return!1;var n=this._getEventFilterUrl(t);return!!n&&e.denyUrls.some((function(t){return isMatchingPattern(n,t)}))},InboundFilters.prototype._isAllowedUrl=function(t,e){if(!e.allowUrls||!e.allowUrls.length)return!0;var n=this._getEventFilterUrl(t);return!n||e.allowUrls.some((function(t){return isMatchingPattern(n,t)}))},InboundFilters.prototype._mergeOptions=function(t){return void 0===t&&(t={}),{allowUrls:tslib_es6_spread(this._options.whitelistUrls||[],this._options.allowUrls||[],t.whitelistUrls||[],t.allowUrls||[]),denyUrls:tslib_es6_spread(this._options.blacklistUrls||[],this._options.denyUrls||[],t.blacklistUrls||[],t.denyUrls||[]),ignoreErrors:tslib_es6_spread(this._options.ignoreErrors||[],t.ignoreErrors||[],gt),ignoreInternal:void 0===this._options.ignoreInternal||this._options.ignoreInternal}},InboundFilters.prototype._getPossibleEventMessages=function(t){if(t.message)return[t.message];if(t.exception)try{var e=t.exception.values&&t.exception.values[0]||{},n=e.type,i=void 0===n?"":n,o=e.value,r=void 0===o?"":o;return[""+r,i+": "+r]}catch(e){return(0,b.c)()&&A.error("Cannot extract message for event "+getEventDescription(t)),[]}return[]},InboundFilters.prototype._getLastValidUrl=function(t){void 0===t&&(t=[]);for(var e=t.length-1;e>=0;e--){var n=t[e];if(n&&"<anonymous>"!==n.filename&&"[native code]"!==n.filename)return n.filename||null}return null},InboundFilters.prototype._getEventFilterUrl=function(t){try{if(t.stacktrace)return this._getLastValidUrl(t.stacktrace.frames);var e;try{e=t.exception.values[0].stacktrace.frames}catch(t){}return e?this._getLastValidUrl(e):null}catch(e){return(0,b.c)()&&A.error("Cannot extract url for event "+getEventDescription(t)),null}},InboundFilters.id="InboundFilters",InboundFilters}(),ft=function(){function GlobalHandlers(t){this.name=GlobalHandlers.id,this._installFunc={onerror:_installGlobalOnErrorHandler,onunhandledrejection:_installGlobalOnUnhandledRejectionHandler},this._options=tslib_es6_assign({onerror:!0,onunhandledrejection:!0},t)}return GlobalHandlers.prototype.setupOnce=function(){Error.stackTraceLimit=50;var t=this._options;for(var e in t){var n=this._installFunc[e];n&&t[e]&&(globalHandlerLog(e),n(),this._installFunc[e]=void 0)}},GlobalHandlers.id="GlobalHandlers",GlobalHandlers}();function _installGlobalOnErrorHandler(){addInstrumentationHandler("error",(function(t){var e=__read(getHubAndAttachStacktrace(),2),n=e[0],i=e[1];if(n.getIntegration(ft)){var o=t.msg,r=t.url,s=t.line,a=t.column,c=t.error;if(!(shouldIgnoreOnError()||c&&c.__sentry_own_request__)){var l=void 0===c&&isString(o)?function _eventFromIncompleteOnError(t,e,n,i){var o=/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/i,r=isErrorEvent(t)?t.message:t,s="Error",a=r.match(o);a&&(s=a[1],r=a[2]);return _enhanceEventWithInitialFrame({exception:{values:[{type:s,value:r}]}},e,n,i)}(o,r,s,a):_enhanceEventWithInitialFrame(eventFromUnknownInput(c||o,void 0,{attachStacktrace:i,isRejection:!1}),r,s,a);l.level=B.Error,addMechanismAndCapture(n,c,l,"onerror")}}}))}function _installGlobalOnUnhandledRejectionHandler(){addInstrumentationHandler("unhandledrejection",(function(t){var e=__read(getHubAndAttachStacktrace(),2),n=e[0],i=e[1];if(n.getIntegration(ft)){var o=t;try{"reason"in t?o=t.reason:"detail"in t&&"reason"in t.detail&&(o=t.detail.reason)}catch(t){}if(shouldIgnoreOnError()||o&&o.__sentry_own_request__)return!0;var r=is_isPrimitive(o)?function _eventFromRejectionWithPrimitive(t){return{exception:{values:[{type:"UnhandledRejection",value:"Non-Error promise rejection captured with value: "+String(t)}]}}}(o):eventFromUnknownInput(o,void 0,{attachStacktrace:i,isRejection:!0});r.level=B.Error,addMechanismAndCapture(n,o,r,"onunhandledrejection")}}))}function _enhanceEventWithInitialFrame(t,e,n,i){var o=t.exception=t.exception||{},r=o.values=o.values||[],s=r[0]=r[0]||{},a=s.stacktrace=s.stacktrace||{},c=a.frames=a.frames||[],l=isNaN(parseInt(i,10))?void 0:i,d=isNaN(parseInt(n,10))?void 0:n,p=isString(e)&&e.length>0?e:function getLocationHref(){var t=(0,y.R)();try{return t.document.location.href}catch(t){return""}}();return 0===c.length&&c.push({colno:l,filename:p,function:"?",in_app:!0,lineno:d}),t}function globalHandlerLog(t){(0,b.c)()&&A.log("Global Handler attached: "+t)}function addMechanismAndCapture(t,e,n,i){addExceptionMechanism(n,{handled:!1,type:i}),t.captureEvent(n,{originalException:e})}function getHubAndAttachStacktrace(){var t=getCurrentHub(),e=t.getClient();return[t,e&&e.getOptions().attachStacktrace]}var vt=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],_t=function(){function TryCatch(t){this.name=TryCatch.id,this._options=tslib_es6_assign({XMLHttpRequest:!0,eventTarget:!0,requestAnimationFrame:!0,setInterval:!0,setTimeout:!0},t)}return TryCatch.prototype.setupOnce=function(){var t=(0,y.R)();this._options.setTimeout&&fill(t,"setTimeout",_wrapTimeFunction),this._options.setInterval&&fill(t,"setInterval",_wrapTimeFunction),this._options.requestAnimationFrame&&fill(t,"requestAnimationFrame",_wrapRAF),this._options.XMLHttpRequest&&"XMLHttpRequest"in t&&fill(XMLHttpRequest.prototype,"send",_wrapXHR);var e=this._options.eventTarget;e&&(Array.isArray(e)?e:vt).forEach(_wrapEventTarget)},TryCatch.id="TryCatch",TryCatch}();function _wrapTimeFunction(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var i=e[0];return e[0]=wrap(i,{mechanism:{data:{function:getFunctionName(t)},handled:!0,type:"instrument"}}),t.apply(this,e)}}function _wrapRAF(t){return function(e){return t.call(this,wrap(e,{mechanism:{data:{function:"requestAnimationFrame",handler:getFunctionName(t)},handled:!0,type:"instrument"}}))}}function _wrapXHR(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var i=this,o=["onload","onerror","onprogress","onreadystatechange"];return o.forEach((function(t){t in i&&"function"==typeof i[t]&&fill(i,t,(function(e){var n={mechanism:{data:{function:t,handler:getFunctionName(e)},handled:!0,type:"instrument"}},i=getOriginalFunction(e);return i&&(n.mechanism.data.handler=getFunctionName(i)),wrap(e,n)}))})),t.apply(this,e)}}function _wrapEventTarget(t){var e=(0,y.R)(),n=e[t]&&e[t].prototype;n&&n.hasOwnProperty&&n.hasOwnProperty("addEventListener")&&(fill(n,"addEventListener",(function(e){return function(n,i,o){try{"function"==typeof i.handleEvent&&(i.handleEvent=wrap(i.handleEvent.bind(i),{mechanism:{data:{function:"handleEvent",handler:getFunctionName(i),target:t},handled:!0,type:"instrument"}}))}catch(t){}return e.call(this,n,wrap(i,{mechanism:{data:{function:"addEventListener",handler:getFunctionName(i),target:t},handled:!0,type:"instrument"}}),o)}})),fill(n,"removeEventListener",(function(t){return function(e,n,i){var o=n;try{var r=o&&o.__sentry_wrapped__;r&&t.call(this,e,r,i)}catch(t){}return t.call(this,e,o,i)}})))}var yt=function(){function LinkedErrors(t){void 0===t&&(t={}),this.name=LinkedErrors.id,this._key=t.key||"cause",this._limit=t.limit||5}return LinkedErrors.prototype.setupOnce=function(){addGlobalEventProcessor((function(t,e){var n=getCurrentHub().getIntegration(LinkedErrors);return n?function _handler(t,e,n,i){if(!(n.exception&&n.exception.values&&i&&isInstanceOf(i.originalException,Error)))return n;var o=_walkErrorTree(e,i.originalException,t);return n.exception.values=tslib_es6_spread(o,n.exception.values),n}(n._key,n._limit,t,e):t}))},LinkedErrors.id="LinkedErrors",LinkedErrors}();function _walkErrorTree(t,e,n,i){if(void 0===i&&(i=[]),!isInstanceOf(e[n],Error)||i.length+1>=t)return i;var o=exceptionFromStacktrace(computeStackTrace(e[n]));return _walkErrorTree(t,e[n],n,tslib_es6_spread([o],i))}var wt=(0,y.R)(),bt=function(){function UserAgent(){this.name=UserAgent.id}return UserAgent.prototype.setupOnce=function(){addGlobalEventProcessor((function(t){if(getCurrentHub().getIntegration(UserAgent)){if(!wt.navigator&&!wt.location&&!wt.document)return t;var e=t.request&&t.request.url||wt.location&&wt.location.href,n=(wt.document||{}).referrer,i=(wt.navigator||{}).userAgent,o=tslib_es6_assign(tslib_es6_assign(tslib_es6_assign({},t.request&&t.request.headers),n&&{Referer:n}),i&&{"User-Agent":i}),r=tslib_es6_assign(tslib_es6_assign({},e&&{url:e}),{headers:o});return tslib_es6_assign(tslib_es6_assign({},t),{request:r})}return t}))},UserAgent.id="UserAgent",UserAgent}(),xt=function(){function Dedupe(){this.name=Dedupe.id}return Dedupe.prototype.setupOnce=function(t,e){t((function(t){var n=e().getIntegration(Dedupe);if(n){try{if(function _shouldDropEvent(t,e){if(!e)return!1;if(function _isSameMessageEvent(t,e){var n=t.message,i=e.message;if(!n&&!i)return!1;if(n&&!i||!n&&i)return!1;if(n!==i)return!1;if(!_isSameFingerprint(t,e))return!1;if(!_isSameStacktrace(t,e))return!1;return!0}(t,e))return!0;if(function _isSameExceptionEvent(t,e){var n=_getExceptionFromEvent(e),i=_getExceptionFromEvent(t);if(!n||!i)return!1;if(n.type!==i.type||n.value!==i.value)return!1;if(!_isSameFingerprint(t,e))return!1;if(!_isSameStacktrace(t,e))return!1;return!0}(t,e))return!0;return!1}(t,n._previousEvent))return A.warn("Event dropped due to being a duplicate of previously captured event."),null}catch(e){return n._previousEvent=t}return n._previousEvent=t}return t}))},Dedupe.id="Dedupe",Dedupe}();function _isSameStacktrace(t,e){var n=_getFramesFromEvent(t),i=_getFramesFromEvent(e);if(!n&&!i)return!0;if(n&&!i||!n&&i)return!1;if(i.length!==n.length)return!1;for(var o=0;o<i.length;o++){var r=i[o],s=n[o];if(r.filename!==s.filename||r.lineno!==s.lineno||r.colno!==s.colno||r.function!==s.function)return!1}return!0}function _isSameFingerprint(t,e){var n=t.fingerprint,i=e.fingerprint;if(!n&&!i)return!0;if(n&&!i||!n&&i)return!1;try{return!(n.join("")!==i.join(""))}catch(t){return!1}}function _getExceptionFromEvent(t){return t.exception&&t.exception.values&&t.exception.values[0]}function _getFramesFromEvent(t){var e=t.exception;if(e)try{return e.values[0].stacktrace.frames}catch(t){return}else if(t.stacktrace)return t.stacktrace.frames}var kt={},St=(0,y.R)();St.Sentry&&St.Sentry.Integrations&&(kt=St.Sentry.Integrations);var Et=tslib_es6_assign(tslib_es6_assign(tslib_es6_assign({},kt),i),o),Pt=function(){function Dedupe(){this.name=Dedupe.id}return Dedupe.prototype.setupOnce=function(t,e){t((function(t){var n=e().getIntegration(Dedupe);if(n){try{if(function dedupe_shouldDropEvent(t,e){if(!e)return!1;if(function dedupe_isSameMessageEvent(t,e){var n=t.message,i=e.message;if(!n&&!i)return!1;if(n&&!i||!n&&i)return!1;if(n!==i)return!1;if(!dedupe_isSameFingerprint(t,e))return!1;if(!dedupe_isSameStacktrace(t,e))return!1;return!0}(t,e))return!0;if(function dedupe_isSameExceptionEvent(t,e){var n=dedupe_getExceptionFromEvent(e),i=dedupe_getExceptionFromEvent(t);if(!n||!i)return!1;if(n.type!==i.type||n.value!==i.value)return!1;if(!dedupe_isSameFingerprint(t,e))return!1;if(!dedupe_isSameStacktrace(t,e))return!1;return!0}(t,e))return!0;return!1}(t,n._previousEvent))return A.warn("Event dropped due to being a duplicate of previously captured event."),null}catch(e){return n._previousEvent=t}return n._previousEvent=t}return t}))},Dedupe.id="Dedupe",Dedupe}();function dedupe_isSameStacktrace(t,e){var n=dedupe_getFramesFromEvent(t),i=dedupe_getFramesFromEvent(e);if(!n&&!i)return!0;if(n&&!i||!n&&i)return!1;if(i.length!==n.length)return!1;for(var o=0;o<i.length;o++){var r=i[o],s=n[o];if(r.filename!==s.filename||r.lineno!==s.lineno||r.colno!==s.colno||r.function!==s.function)return!1}return!0}function dedupe_isSameFingerprint(t,e){var n=t.fingerprint,i=e.fingerprint;if(!n&&!i)return!0;if(n&&!i||!n&&i)return!1;try{return!(n.join("")!==i.join(""))}catch(t){return!1}}function dedupe_getExceptionFromEvent(t){return t.exception&&t.exception.values&&t.exception.values[0]}function dedupe_getFramesFromEvent(t){var e=t.exception;if(e)try{return e.values[0].stacktrace.frames}catch(t){return}else if(t.stacktrace)return t.stacktrace.frames}const Lt={async radio(t){const e={url:location.href,id:t.detail.native_event.target.id,name:t.detail.native_event.target.name,type:t.detail.native_event.target.type,value:t.detail.native_event.srcElement.value,page_id:window.potions.state.pageId,timestamp:Date.now()};return[await window.potions.widgets.navigation_recorder.getSaveFormByName(t.detail.native_event.target.name),e]},async checkbox(t){const e={url:location.href,id:t.detail.native_event.target.id,name:t.detail.native_event.target.name,type:t.detail.native_event.target.type,value:t.detail.native_event.srcElement.checked,page_id:window.potions.state.pageId,timestamp:Date.now()};return[await window.potions.widgets.navigation_recorder.getSaveFormById(t.detail.native_event.target.id),e]},async password(t){const e={url:location.href,type:"password",id:t.detail.native_event.srcElement.id,value:"",page_id:window.potions.state.pageId,timestamp:Date.now()};return[await window.potions.widgets.navigation_recorder.getSaveFormById(t.detail.native_event.srcElement.id),e]},select2:async t=>[await window.potions.widgets.navigation_recorder.getSaveFormById(t.detail.id),{id:t.detail.id,type:"select2",value:t.detail.native_event.id,url:location.href,page_id:window.potions.state.pageId,timestamp:Date.now()}],async default(t){const e={url:location.href,id:t.detail.native_event.target.id,name:t.detail.native_event.target.name,type:t.detail.native_event.target.type,value:t.detail.native_event.srcElement.value,page_id:window.potions.state.pageId,timestamp:Date.now()};return[await window.potions.widgets.navigation_recorder.getSaveFormById(t.detail.native_event.target.id),e]}},Ct=[{name:"visited_urls",options:{autoIncrement:!0,keyPath:"id"},indexes:["session_id"]},{name:"forms",options:{autoIncrement:!0,keyPath:"form_id"},indexes:["id","page_id"]},{name:"user",options:{}},{name:"sessions",options:{autoIncrement:!0,keyPath:"id"},indexes:[]}];class NavigationRecorder extends Widget{constructor(t,e){super(t,e),this._storage.db=new DBWrapper("potions_nav_recorder",1,Ct),this._actions.record=Lt,this._processes.url_change=new Process((t=>{this.savePageview(t.detail?.url)}),"potions_url_change"),this._processes.input_change=new Process((t=>{this.saveForm(t.detail?.native_event?.target?.type,t)}),"potions_input_change"),this._processes.custom_input_change=new Process((t=>{this.saveForm(t.detail?.name,t)}),"potions_input_custom_change")}async savePageview(t){const e=await this.getSessionId(),n=await this._storage.db.add("visited_urls",{url:t,session_id:this._potions.state.sessionId,arrival_timestamp:Date.now(),departure_timestamp:void 0,timestamp:Date.now()});this._potions.state.setPageId(n,this._potions),this._storage.db.update("sessions",{...e,end:Date.now()})}async getSessionId(){const t=(await this._storage.db.getAll("sessions")).pop();if(t&&!NavigationRecorder.isSessionEnded(t))return this._potions.state.setSessionId(t.id),t;{const t={begin:Date.now(),end:Date.now()},e=await this._storage.db.add("sessions",t);return this._potions.state.setSessionId(e),{...t,id:e}}}static isSessionEnded(t){const e=(new Date).getTime(),n=new Date(e-18e5).getTime();return t&&t.end<n}async saveForm(t,e){try{let n,i;this._actions.record[t]?[n,i]=await this._actions.record[t].apply(this,[e]):[n,i]=await this._actions.record.default.apply(this,[e]),i&&this.saveFormInDb(n,i)}catch(t){this._potions.logger.captureError(t,!1)}}async saveFormInDb(t,e){if(t){const n=e;n.form_id=t.value.form_id,await this._storage.db.update("forms",n)}else await this._storage.db.add("forms",e)}async getSavedForms(){return this._storage.db.query("forms",{equal:this._potions.state.pageId},"page_id")}async getSaveFormByName(t){return(await this.getSavedForms()).reverse().find((e=>e.value.name===t))}async getSaveFormById(t){return(await this.getSavedForms()).reverse().find((e=>e.value.id===t))}}const At={relative_time:function relativeTime(t){return Date.now()-parseFloat(t)},get_in_storage:async function get(t,e,n){const i=await(window.potions.widgets[t]?.storage?.db?.get(e[0],e[1]));if(i)return n?i[n]:i},get_all_in_storage:async function getAll(t,e){return await window.potions.widgets[t].storage.db.getAll(e)},rule:function rule(t){return t.apply(this,this.execution_id)},fetch_on_same_url:async function fetchUrl(t){if(!t||t.includes("undefined"))return!1;try{return(await fetch(t)).url===t}catch(t){return window.potions.logger.captureError(t,!1),!1}}};const It={"!":function not(t){return!t},"===":function equal(t,e){return t===e},"!==":function different(t,e){return t!==e},"&&":function and(...t){for(const e of t)if(!e)return!!e;return!0},"||":function or(...t){for(const e of t)if(e)return!!e;return!1},if:function ifelse(...t){return t[0]?t[1]:t[2]},index_of:function indexOf(t,e){return!(!t||!e)&&t.includes(e)},is_undefined:function isUndefined(t){return null==t},is_null:function isNull(t){return null===t},match:function match(t,e){return t?.match(new RegExp(e))}};const Tt={join:function join(...t){return t.join("")},concat:function concat(t,e){return t.concat(e)},length:function array_length(t){return t?t.length:0},map_by_key:function mapByKey(t,e){return t.map((t=>t[e]))},map:function map(t,e){return t?.map(e)},filter:async function filter(t,e){const n=[];if(!(Symbol.iterator in Object(t)))return n;for(const i of t)await e.apply({...this,filter_value:i})&&n.push(i);return n},contains:function contains(t,e){let n=!1;for(const i of e)t&&t.includes(i)&&(n=!0);return n},first:function first(t){return t?.[0]},pop:function pop(t){return t?.pop()},random:function random(t){return t.sort((()=>Math.random()-.5))},includes:function includes(t,e){return t.includes(e)},set:function set(t){return[...new Set(t)]},merge:function merge(t,e){return{...t,...e}},is_in_array_not_strict:function inArrayNotStrict(t,e){window.potions.logger.captureLog(["WARNING : rule is_in_array_not_strict is deprecate"]);let n=!1;for(const i of e)t&&t.includes(i)&&(n=!0);return n},is_in_array_strict:function inArrayStrict(t,e){window.potions.logger.captureLog(["WARNING : rule is_in_array_strict is deprecate"]);let n=!1;if(void 0===e||e===[]||null===e)return!1;for(const i of e)i===t&&(n=!0);return n}};const Rt={all:function data_all(...t){return t},var:async function getVar(t,e){let n={...this,...e};if(void 0===t||""===t||null===t)return n;const i=String(t).split(".");for(const t of i)if(n=await n[t],null==n)return null;return n},build_object:function buildObject(...t){const e={};for(const n of t){const t=Object.entries(n);e[t[0][0]]=t[0][1],1===e[t[0][0]].length&&(e[t[0][0]]=e[t[0][0]][0])}return e},set_temp:function setTemp(t,e){this.window.potions.temp.rules[this.execution_id][t]=e},get_temp:function getTemp(t,e){let n=this.window.potions.temp.rules[this.execution_id][t];return n&&e&&String(e).split(".").forEach((t=>{n=n[t]})),n},then:function then(...t){return t[t.length-1]},execute:async function execute(t,...e){return t(...e)},action:async function action(t,e,...n){return t[e](...n)},prop:function prop(t,e){return t?.[e]},build_date:function buildDate(t){return new Date(t)},typeof:function typeOf(t){return typeof t}};const Ot={selector:function selector(t,e){const n=document.querySelector(t);return n&&e?n[e]||n.getAttribute(e):n},selector_all:function selectorAll(t,e){const n=[...document.querySelectorAll(t)];return e?n.map((t=>t.getAttribute(e))):n},from_node_selector:function fromNodeSelector(t,e,n){const i=e.querySelector(t);return i&&n?i[n]||i.getAttribute(n):i},from_node_selector_all:function fromNodeSelectorAll(t,e,n){const i=[...e.querySelectorAll(t)];return n?i.map((t=>t[n]||t.getAttribute(n))):i},get_style:function getStyle(t,e){try{return getComputedStyle(t)[e]}catch(t){return""}}};const Ft={...Rt,...It,...{">":function sup(t,e){return t>e},"<":function inf(t,e){return t<e},">=":function suppEqual(t,e){return t>=e},"<=":function infEqual(t,e){return t<=e},"+":function add(...t){let e=0;for(const n of t)e+=parseFloat(n);return e},"*":function multiply(...t){let e=1;for(const n of t)e*=parseFloat(n);return e},"/":function devide(t,e){return parseFloat(t)/parseFloat(e)},"%":function modulo(t,e){return parseFloat(t)%parseFloat(e)}},...Tt,...At,...Ot,...{split:function split(t,e,n){const i=t.split(e);return n?i[n]:i},replace:function replace(t,e,n){return t&&"string"==typeof t?t.replace(e,n):t},string_to_number:function stringToNumber(t){return parseStringToNumber(t)},to_string:function string_toString(t){return t.toString()}}};class Rule{constructor(t,e){this._operationKey=t,this._operationArguments=Array.isArray(e)?e:[e]}async apply(t={},e){const n=e??uuidv4(),i={...t,window};return e||(window.potions.temp.rules[n]={}),"then"===this._operationKey?this.applyThen(i,n):"if"===this._operationKey?this.applyIf(i,n):this.applyClassical(i,n)}async applyThen(t,e){const n=[];for(const i of this._operationArguments)Rule.isRule(i)?n.push(await i.apply(t,e)):n.push(i);return this.executeOperation({...t,execution_id:e},n)}async applyClassical(t,e){const n=[];this._operationArguments.forEach((i=>{Rule.isRule(i)?n.push(i.apply(t,e)):n.push(i)}));const i=await Promise.all(n);return this.executeOperation({...t,execution_id:e},i)}async applyIf(t,e){const[n,i,o]=this._operationArguments;if(Rule.isRule(n)){const r=await n.apply(t,e);let s=i,a=o;return Rule.isRule(s)&&(s=r?await i.apply(t,e):void 0),Rule.isRule(a)&&(a=r?void 0:await o.apply(t,e)),this.executeOperation({...t,execution_id:e},[r,s,a])}throw new Error("If condition should be a rule")}executeOperation(t,e){if("function"==typeof Ft[this._operationKey])return Ft[this._operationKey].apply(t,e);const n={};return n[this._operationKey]=e,n}static isRule(t){return!!(t&&t._operationKey&&t._operationArguments&&t.apply)}static parse(t){if("object"!=typeof t)return t;if(Object.keys(t).length>1)return t;const[e]=Object.keys(t);if(!Array.isArray(t[e]))return t;const n=t[e].map((t=>Rule.parse(t)));return new Rule(e,n)}static async fromResource(t){const e={};return Object.entries(await t).forEach((([t,n])=>{e[t]=Rule.parse(n)})),e}}const jt=[{name:"rules",file:"rules.json",type:Rule}];class PageEnricher extends Widget{constructor(t,e){super(t,e,jt),this._potions.widgets.push(new NavigationRecorder(t,"navigation_recorder")),this._processes.enrich_page=new Process((()=>{this.enrichPage()}),["pageId","domLoaded"])}async enrichPage(){try{const t=await this._resources.rules;if(t.enrich_object){const e=await t.enrich_object.apply();this._potions.logger.captureLog(["PAGE ENRICHER - enrich object",e]);const n=await this._potions.widgets.navigation_recorder.storage.db.get("visited_urls",this._potions.state.pageId);e&&(n.enrich=e,await this._potions.widgets.navigation_recorder.storage.db.update("visited_urls",n)),window.dispatchEvent(new CustomEvent("potions_enrich_page",{detail:{page:n}}))}}catch(t){this._potions.logger.captureError(t)}}}const Bt=[{name:"rules",file:"rules.json",type:Rule}];class PotionsElement_PotionsElement extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"open"}),this.potionsDataKeys=[];const t=this.constructor.properties;Object.entries(t).forEach((([t,e])=>{this[`_${t}`]=e})),Object.entries(t).forEach((([t])=>{Object.defineProperty(this,t,{get(){return this[`_${t}`]},set(e){if(this[`_${t}`]!=e){const n=this[`_${t}`];this[`_${t}`]=e,this.propertyChangedCallback(t,n,e)}}})}))}static get properties(){return[]}connectedCallback(){this.render(),this.potionsDataKeys=this.getAttribute("potions-data")?.split(" ")||[],this.potionsDataKeys?.forEach((t=>{window.potions.data[t]?.hosts?.push(this)}))}render(){this.shadow.innerHTML=this.template()}template(){return""}disconnectedCallback(){this.potionsDataKeys.forEach((t=>{const e=window.potions.data[t]?.hosts.indexOf(this);window.potions.data[t]?.hosts.splice(e,1)}))}propertyChangedCallback(t,e,n){const i=new CustomEvent(t,{bubbles:!0,detail:{old:e,new:n}});this.dispatchEvent(i)}static getElementName(){return this.name.split("_")[0].replace(/[A-Z]/g,(t=>`-${t.toLowerCase()}`)).replace(/^-/,"")}static define(){window.customElements.define(this.getElementName(),this)}}class PotionsDivider extends PotionsElement_PotionsElement{template(){return"\n      <style>\n        :host {\n          display: flex;\n          align-items: center;\n          text-align: center;\n          overflow: hidden !important;\n        }\n\n        :host::before,\n        :host::after {\n          content: '';\n          flex: 1;\n          border-bottom: var(--separator-border, 1px solid #000);\n        }\n\n        :host::before {\n          margin-right: 1em;\n        }\n        :host::after {\n          margin-left: 1em;\n        }\n\n        hr {\n          display: block;\n          border-top: var(--separator-border, 1px solid black);\n          width: 100%;\n        }\n\n        :host(.text-down) {\n          display: flex;\n          flex-direction: column;\n        }\n        :host(:not(.text-down)) hr {\n          display: none;\n        }\n\n        :host(.text-down)::before,\n        :host(.text-down)::after {\n          display: none;\n        }\n      </style>\n      <hr>\n      <slot></slot>\n    "}}class PotionsModal extends PotionsElement_PotionsElement{connectedCallback(){super.connectedCallback(),this.addEventListener("click",(t=>{t.stopPropagation()})),this.shadow?.querySelector(".close")?.addEventListener("click",(()=>{let t=this.getRootNode()?.host;for(;!0!==t.hasAttribute("root");)t=t.getRootNode()?.host;t.remove(),window.potions.widgets[this.getAttribute("potion")||""]?.actions?.onClose(this.getAttribute("trigger"))}))}template(){return`\n    <style>\n      :host {\n        display: flex;\n        overflow: auto;\n        position: fixed;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        justify-content: center;\n        max-width: var(--modal-max-width, 1000px);\n        min-width: var(--modal-min-width, ${this.getAttribute("mobile-width")??"600"}px);\n        max-height: var(--modal-max-height, min(600px, 100%));\n        background: var(--second-color, white);\n      }\n\n      @media (max-width: ${this.getAttribute("mobile-width")??"600"}px) {\n        :host {\n          max-width: var(--modal-width-mobile, 100%);\n          min-width: var(--modal-width-mobile, 100%);\n          max-height: 100%;\n        }\n      }\n\n      .close {\n        display: var(--modal-close-display, flex);;\n        z-index: var(--potions-z-index, 2);\n        cursor: pointer;\n        position: var(--modal-close-position, absolute);\n        right: var(--modal-close-right, 0);\n        top: var(--modal-close-top, 0);\n        bottom: var(--modal-close-bottom, unset);\n        left: var(--modal-close-left, unset);\n        padding: var(--modal-close-padding, 10px);\n        width: var(--modal-close-size, 15px);\n        height: var(--modal-close-size, 15px);\n        background-color: var(--modal-close-bg-color, transparent);\n        border-radius: var(--modal-close-border-radius, unset);\n      }\n      .close svg {\n        stroke-width: var(--modal-close-strike-width, 2px);\n        stroke: var(--modal-close-stroke-color, black);\n        width: -webkit-fill-available;\n      }\n      .close svg line {\n        stroke-linecap: var(--modal-stroke-linecap, square);\n      }\n\n      :host(.left) {\n        left: 0;\n        transform: translate(0, -50%);\n      }\n      :host(.right) {\n        transform: translate(0, -50%);\n        right: 0;\n        left: unset;\n      }\n      :host(.top) {\n        top: 0;\n        transform: translate(-50%, 0);\n      }\n      :host(.bottom) {\n        top: unset;\n        transform: translate(-50%, 0);\n        bottom: 0;\n      }\n      :host(.bottom.right), :host(.bottom.left), :host(.top.right), :host(.top.left) {\n        transform: unset;\n      }\n\n      ::slotted(*) {\n        width: var(--modal-slot-width, 100%);\n        overflow: auto;\n      }\n      </style>\n      <div class="close">\n        <svg\n          viewBox="0 0 20 20"\n          xmlns="http://www.w3.org/2000/svg"\n        >\n          <line x1="2" y1="2" x2="18" y2="18"/>\n          <line x1="2" y1="18" x2="18" y2="2"/>\n        </svg>\n      </div>\n\n      <slot></slot>\n    `}}class PotionsOverlay extends PotionsElement_PotionsElement{connectedCallback(){this.addEventListener("click",(()=>{let t=this.getRootNode()?.host;for(;!0!==t.hasAttribute("root");)t=t.getRootNode()?.host;t.remove(),window.potions.widgets[this.getAttribute("potion")||""]?.actions?.onClose(this.getAttribute("trigger"))})),super.connectedCallback()}template(){return"\n      <style>\n        :host {\n          top: 0;\n          left: 0;\n          right: 0;\n          bottom: 0;\n          display: grid;\n          overflow: auto;\n          position: fixed;\n          z-index: var(--potions-z-index, 2);\n          background-color: var(--potions-overlay-bg-color, rgba(0, 0, 0, 0.7));\n        }\n      </style>\n      <slot></slot>\n    "}}function elementAttributes(t,e){return e.map((e=>t.getAttribute(e)?` ${e}="${t.getAttribute(e)}"`:"")).join("")}function PotionsScrollableListMixin(t){return class extends(function PotionsNavigableListMixin(t){return class extends(function PotionsListMixin(t){return class extends t{constructor(){super(...arguments),this.handleSlotChange=()=>{this.updateLength()}}get elements(){const t=this.shadowRoot?.querySelector("slot");if(t)return t.assignedElements({flatten:!0})}static get properties(){return{...super.properties,length:{}}}connectedCallback(){super.connectedCallback(),this.updateLength()}template(){return"<slot></slot>"}currentLength(){return this.elements?.length}updateLength(){this.length=this.currentLength()}}}(t)){constructor(){super(...arguments),this.handleSlotChange=()=>{super.updateLength(),this.updateCurrentPosition()},this.handleTargetPositionChange=()=>{this.navigateTo(this.targetPosition)}}static get properties(){return{...super.properties,currentPosition:0,targetPosition:{}}}get visibleElements(){return parseFloat(this.getAttribute("visible-elements")||"2")}connectedCallback(){super.connectedCallback(),this.currentPosition=0}render(){super.render(),this.addEventListener("targetPosition",this.handleTargetPositionChange)}updateCurrentPosition(){}navigateTo(t){}increasePositionBy(t){this.targetPosition=this.currentPosition+t>=0?this.currentPosition+t:0}}}(t)){constructor(){super(...arguments),this.handleScroll=()=>{this.updateCurrentPosition()}}render(){super.render(),this.addEventListener("scroll",this.handleScroll)}template(){return`\n        <style>\n          :host\n          {\n            height: 100%;\n            width: 100%;\n            padding: 0;\n            display: flex;\n            overflow: auto;\n            scroll-snap-type: x mandatory;\n            scrollbar-width: none;\n            -ms-overflow-style: none;\n          }\n          :host::-webkit-scrollbar {\n            display: none;\n          }\n          ::slotted(*)\n          {\n            flex:1 0 100%;\n            margin: 0;\n            height: inherit;\n            scroll-snap-align: start;\n            box-sizing: border-box;\n            overflow: hidden;\n          }\n          :host([visible-elements="1"]) ::slotted(*) { flex:1 0 100%; max-width: 100% !important;}\n          :host([visible-elements="2"]) ::slotted(*) { flex:1 0 50%; max-width: 50% !important;}\n          :host([visible-elements="3"]) ::slotted(*) { flex:1 0 calc(100% / 3); max-width: calc(100% / 3) !important;}\n          :host([visible-elements="4"]) ::slotted(*) { flex:1 0 25%; max-width: 25% !important;}\n          :host([visible-elements="5"]) ::slotted(*) { flex:1 0 20%; max-width: 20% !important;}\n          :host([visible-elements="6"]) ::slotted(*) { flex:1 0 calc(100% / 6); max-width: calc(100% / 6) !important;}\n          :host([visible-elements="7"]) ::slotted(*) { flex:1 0 calc(100% / 7); max-width: calc(100% / 7) !important;}\n          :host([visible-elements="8"]) ::slotted(*) { flex:1 0 calc(100% / 8); max-width: calc(100% / 8) !important;}\n          :host([visible-elements="9"]) ::slotted(*) { flex:1 0 calc(100% / 9); max-width: calc(100% / 9) !important;}\n          :host([visible-elements="10"]) ::slotted(*) { flex:1 0 calc(100% / 10); max-width: calc(100% / 10) !important;}\n          :host([visible-elements="${this.getAttribute("visible-elements")}"]) ::slotted(*) { \n            flex:1 0 calc(100% / ${this.getAttribute("visible-elements")});\n             max-width: calc(100% / ${this.getAttribute("visible-elements")}) !important;\n          }\n        </style>\n        <slot></slot>\n      `}currentFirstVisible(){let t=0;for(;super.elements&&super.elements[t+1]&&(super.elements[t].getBoundingClientRect().left<this.getBoundingClientRect().left-1||super.elements[t].getBoundingClientRect().top<this.getBoundingClientRect().top-1);)t++;return t}updateCurrentPosition(){this.currentPosition=this.currentFirstVisible()}navigateTo(t){if(this.elements){const e=this.elements[t];if(e){const t={left:e.getBoundingClientRect().left+this.scrollLeft-this.getBoundingClientRect().left,top:e.getBoundingClientRect().top+this.scrollTop-this.getBoundingClientRect().top,behavior:"smooth"};this.scrollTo(t)}}}}}class PotionsScrollableList extends(PotionsScrollableListMixin(PotionsElement_PotionsElement)){}function PotionsListControlsMixin(t){return class extends t{constructor(){super(...arguments),this.handleCurrentPositionChange=()=>{},this.handleLengthChange=()=>{}}connectedCallback(){super.connectedCallback(),this.controlledList?.addEventListener("currentPosition",this.handleCurrentPositionChange),this.controlledList?.addEventListener("length",this.handleLengthChange)}get controlledList(){return this.querySelector(`potions-scrollable-list #${this.getAttribute("listId")}`)||this.querySelector("potions-scrollable-list")||this.shadow.querySelector("potions-scrollable-list")}}}class PotionsSliderControlsArrows extends(PotionsListControlsMixin(PotionsElement_PotionsElement)){constructor(){super(...arguments),this.handleCurrentPositionChange=()=>{if(this.shadow.querySelectorAll(".nav").forEach((t=>t.classList.remove("hidden"))),this.controlledList){const{currentPosition:t,length:e,visibleElements:n}=this.controlledList;0==t&&this.shadow?.querySelector(".previous")?.classList?.add("hidden"),t===e-n&&this.shadow?.querySelector(".next")?.classList?.add("hidden")}},this.handleLengthChange=()=>{if(this.controlledList){const{length:t,visibleElements:e}=this.controlledList;t<=e&&this.shadow?.querySelector(".next")?.classList?.add("hidden")}}}connectedCallback(){super.connectedCallback();const t="slide-window"===this.getAttribute("options");this.shadow?.querySelector(".next")?.addEventListener("click",(()=>{super.controlledList?.increasePositionBy(t?this.controlledList?.visibleElements??1:1)})),this.shadow?.querySelector(".previous")?.addEventListener("click",(()=>{super.controlledList?.increasePositionBy(t?-(this.controlledList?.visibleElements??1):-1)}))}template(){return'\n    <style>\n      :host {\n        display: block;\n      }\n\n      .wrapper {\n        height: 100%;\n        width: 100%;\n        padding: 0;\n        display: block;\n        position: relative;\n      }\n\n      .row {\n        display: flex;\n        align-items: center;\n      }\n\n      .nav {\n        user-select: none;\n        width: var(--slider-arrows-nav-width, 40px);\n        height: var(--slider-arrows-nav-height, 50px);\n        font-size: 40px;\n        display: grid;\n        align-items: center;\n        text-align: center;\n        cursor: pointer;\n        position: var(--slider-arrows-position);\n        z-index: 10;\n        border: var(--slider-arrows-nav-border, unset);\n        border-radius: var(--slider-arrows-nav-border-radius, unset);\n        padding: var(--slider-arrows-nav-padding, unset);\n        margin: var(--slider-arrows-nav-margin, unset);\n        background: var(--slider-arrows-background, none);\n        box-shadow: var(--slider-arrows-box-shadow, none);\n      }\n      .nav.previous {\n        left: var(--slider-arrows-left);\n        top: var(--slider-arrows-top);\n        bottom: var(--slider-arrows-bottom);\n      }\n      .nav.next {\n        right: var(--slider-arrows-right);\n        top: var(--slider-arrows-top);\n        bottom: var(--slider-arrows-bottom);\n      }\n\n      .nav.hidden {\n        opacity: 0;\n        cursor: unset;\n        pointer-events: none;\n      }\n\n      potions-arrow {\n        width: 100%;\n        height: 100%;\n      }\n\n      ::slotted(*) {\n        flex: 1 0;\n      }\n    </style>\n\n    <div class="wrapper">\n      <div class="row">\n        <div class="nav previous hidden">\n          <potions-arrow direction="left"></potions-arrow>\n        </div>\n        <slot></slot>\n        <div class="nav next">\n          <potions-arrow direction="right"></potions-arrow>\n        </div>\n      </div>\n    </div>\n    '}}class PotionsSliderControlsBullets extends(PotionsListControlsMixin(PotionsElement_PotionsElement)){constructor(){super(),this.handleCurrentPositionChange=()=>{this.updateActiveBulletIndex()},this.handleLengthChange=()=>{this.updateNbBullets()},this.updateNbBullets(),this.updateActiveBulletIndex()}static get properties(){return{...super.properties,nbBullets:{},activeBulletIndex:{}}}render(){super.render(),this.addBulletsListeners()}template(){return`\n    <style>\n      :host {\n        display: block;\n      }\n\n      .wrapper {\n        height: 100%;\n        width: 100%;\n        padding: 0;\n        display: block;\n      }\n\n      .column {\n        display: flex;\n        flex-direction: column;\n      }\n\n      .nav {\n        height: 40px;\n      }\n\n      .bullets {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        list-style:none;\n      }\n\n      .bullets li {\n        cursor: pointer;\n        margin: var(--slider-bullets-margin, 0 5px);\n        border-radius: 100%;\n        height: var(--slider-bullets-size, 10px);\n        width: var(--slider-bullets-size, 10px);\n        background: var(--slider-bullets-non-active-color, white);\n        border: var(--slider-bullets-border, 1px solid black);\n      }\n\n      .bullets li.active {\n        background: var(--slider-bullets-active-color, black);\n      }\n\n      ::slotted(*) {\n        flex: 1 0;\n      }\n    </style>\n\n    <div class="wrapper">\n      <div class="column">\n        <slot></slot>\n        <lu class="nav bullets">\n          ${this.bulletsTemplate()}\n        </lu>\n      </div>\n    </div>\n    `}setActiveBullet(){[...this.bullets()].forEach((t=>t.classList.remove("active"))),this.bullets()[this.activeBulletIndex]?.classList.add("active")}updateNbBullets(){let t=0;const e=this.controlledList?.length,n=this.controlledList?.visibleElements;e&&n&&(t=Math.ceil(e/n)),t=1==t?0:t,this.nbBullets!=t&&(this.nbBullets=t,this.render())}updateActiveBulletIndex(){const t=Math.ceil((this.controlledList?.currentPosition??0)/(this.controlledList?.visibleElements??1));this.activeBulletIndex!=t&&(this.activeBulletIndex=t,this.setActiveBullet())}bullets(){return[...this.shadow.querySelectorAll(".bullets li")]}addBulletsListeners(){[...this.bullets()].map((t=>{this.addBulletListeners(t)}))}addBulletListeners(t){t.addEventListener("click",(()=>{this.controlledList&&(this.controlledList.targetPosition=parseInt(t.getAttribute("elementIndex")||"0"))}))}bulletTemplate(t){return`\n      <li elementIndex="${t*(this.controlledList?.visibleElements??1)}" ${t===this.activeBulletIndex?'class="active"':""}>\n      </li>\n    `}bulletsTemplate(){return[...Array(this.nbBullets)].map(((t,e)=>this.bulletTemplate(e))).join("")}}class Arrow extends PotionsElement_PotionsElement{render(){super.render(),this.shadowRoot?.children&&[...this.shadowRoot.children].forEach((t=>t.addEventListener("click",(()=>{}),!0)))}template(){return`\n    ${this.templateStyle()}\n    ${"left"===this.getAttribute("direction")?this.templateArrowLeft():this.templateArrowRight()}`}}const Dt=[PotionsScrollableList,PotionsSliderControlsArrows,PotionsSliderControlsBullets,class PotionsSliderList extends PotionsElement_PotionsElement{template(){const t=this.getAttribute("controls")?.split(" ")??[];let e=`\n      <potions-scrollable-list ${elementAttributes(this,["visible-elements","options"])}>\n        <slot></slot>\n      </potions-scrollable-list>\n    `;return t.includes("arrows")&&(e=`\n        <potions-slider-controls-arrows ${elementAttributes(this,["options"])}>\n          ${e}\n        </potions-slider-controls-arrows>\n      `),t.includes("bullets")&&(e=function wrap_wrap(t,e){return`\n    <${t}>\n      ${e}\n    </${t}>\n  `}("potions-slider-controls-bullets",e)),e}},class PotionsArrow extends Arrow{templateStyle(){return"\n      <style>\n        :host {\n          display: flex;\n          justify-content: center;\n          align-items: center;\n        }\n        \n        svg {\n          width: var(--slider-arrow-width, 10px);\n          height: var(--slider-arrow-height, 20px);\n          fill: none;\n        }\n\n        path {\n          stroke: var(--slider-arrow-stroke, black); \n          stroke-width: var(--slider-arrow-stroke-width, 2);\n          stroke-linecap: var(--slider-arrow-stroke-linescap, round);\n        }\n      </style>\n    "}templateArrowLeft(){return'\n      <svg class="left" viewBox="0 0 15 26" xmlns="http://www.w3.org/2000/svg">\n        <path d="M14 1L2 13L14 25"/>\n      </svg>\n    '}templateArrowRight(){return'\n      <svg class="right" viewBox="0 0 15 26" xmlns="http://www.w3.org/2000/svg">\n        <path d="M1 25L13 13L1 1"/>\n      </svg>\n    '}}];class PotionsSlider extends PotionsElement_PotionsElement{connectedCallback(){this.getAttribute("visible-elements")||this.setAttribute("visible-elements",this.getVisibleElements().toString()),super.connectedCallback()}template(){return`\n      <style>\n        :host {overflow: auto;}\n      </style>\n      <potions-slider-list ${elementAttributes(this,["visible-elements","controls","options"])}>\n        ${this.productsListTemplate()}\n      </potions-slider-list>\n    `}productsListTemplate(){return"<slot></slot>"}getVisibleElements(){let t;t=this.getAttribute("container-width")?parseFloat(this.getAttribute("container-width")||""):.8*window.innerWidth;let e=200;return this.getAttribute("product-width")&&(e=parseInt(this.getAttribute("product-width")||"",10)),Math.trunc(t/e)}}class PotionsText extends PotionsElement_PotionsElement{constructor(){super(...arguments),this.minLines=1,this.maxLines=2}connectedCallback(){this.minLines=parseInt(this.getAttribute("min-lines")??"1",10),this.maxLines=parseInt(this.getAttribute("max-lines")??"2",10),this.minLines>this.maxLines&&(this.minLines=this.maxLines),super.connectedCallback()}templateStyle(){return`\n     <style>\n        :host {\n          overflow: hidden;\n          -webkit-line-clamp: ${this.maxLines};\n          -webkit-box-orient: vertical;\n          text-overflow: ellipsis;\n          display: -webkit-box;\n          text-align: center;\n          min-height: ${parseInt(window.getComputedStyle(this).lineHeight)*this.minLines||0}px; \n          max-height: ${this.maxLines&&parseInt(window.getComputedStyle(this).lineHeight)*this.maxLines||"unset"}px;\n          color: inherit;\n          font-family: inherit;\n        }\n\n        :host(.h1) {\n          font-size: 3.25rem;\n        }\n\n        :host(.h2) {\n          font-size: 3rem;\n        }\n\n        :host(.h3) {\n          font-size: 2.5rem;\n        }\n\n        :host(.h4) {\n          font-size: 2rem;\n        }\n\n        :host(.h5) {\n          font-size: 1.5rem;\n        }\n\n        :host(.h6) {\n          font-size: 1rem;\n        }\n\n        :host(.subtitle){\n          font-size: 1.25rem;\n        }\n\n        :host(.p) {\n          font-size: 0.875rem;\n        }\n\n        :host(.small-p) {\n          font-size: 0.7rem;\n        }\n\n        :host(.bold) {\n          font-weight: bold;\n        }\n\n        :host(.uppercase) {\n          text-transform: uppercase;\n        }\n\n        :host(.left) {\n          text-align: left;\n        }\n\n        :host(.right) {\n          text-align: right;\n        }\n\n        :host(.stroke) {\n          text-decoration-line: line-through;\n        }\n\n        :host(.nowrap) {\n          white-space: nowrap;\n        }\n\n      </style>\n    `}template(){return`\n      ${this.templateStyle()}\n      <slot>\n      </slot>\n    `}}class PotionsStack extends PotionsElement_PotionsElement{render(){super.render(),this&&this.getAttribute("onclick")&&this.addEventListener("click",(()=>{this.getAttribute("onclick")}))}templateStyle(){return"\n      <style>\n        :host{\n          display: grid;\n          grid-auto-flow: row;\n          gap: 10px;\n          width: 100%;\n          background-color: inherit;\n          padding: 5px;\n          box-sizing: border-box;\n        }\n\n        :host(.clickable) {\n           cursor: pointer;\n        }\n\n        :host(.row) {\n          grid-auto-flow: column;\n        }\n\n        :host(.left) {\n          justify-content: flex-start;\n        }\n\n        :host(.right) {\n          justify-content: flex-end;\n        }\n\n        :host(.top) {\n          align-content: flex-start;\n        }\n\n        :host(.bottom) {\n          align-content: flex-end;\n        }\n\n        :host(.center-horizontal) {\n          justify-content: center;\n        }\n        \n        :host(.center-horizontal-items) {\n          justify-items: center;\n        }\n\n        :host(.row-reverse) {\n          flex-direction: row-reverse;\n          display: flex;\n        }\n\n         :host(.column-reverse) {\n          flex-direction: column-reverse;\n          display: flex;\n        }\n\n        :host(.center-vertical) {\n          align-items: center;\n        }\n\n        :host(.center) {\n          align-content: center;\n          justify-items: center;\n        }\n\n        :host(.no-gap) {\n          gap: 0 !important;\n        }\n\n        :host(.no-padding) {\n          padding: 0;\n        }\n      </style>\n    "}template(){return`\n      ${this.templateStyle()}\n      <slot></slot>\n    `}}class PotionsImage extends PotionsElement_PotionsElement{render(){super.render(),this.classList.contains("clickable")&&this.getAttribute("onclick")&&this.addEventListener("click",(()=>{this.getAttribute("onclick")}))}templateStyle(){return"\n     <style>\n        img {\n          object-position: var(--potions-image-object-position, 50% 50%);\n          object-fit: var(--potions-image-object-fit, cover);\n          width: var(--potions-image-width, 100%);\n          height: var(--potions-image-height, 100%);\n          border-radius: var(--potions-image-border-radius, unset);\n          border: var(--potions-image-border, unset);\n        }\n\n        :host(.clickable) img {\n          cursor: pointer;\n        }\n\n        @keyframes fadeIn {\n          0% {\n            opacity: 0;\n          }\n          100% {\n            opacity: 1;\n          }\n        }\n\n        :host(.fadeIn) img {\n           animation: 300ms ease-out 0s 1 fadeIn;\n        }\n\n      </style>\n    "}template(){return`\n      ${this.templateStyle()}\n\n      <img\n        src="${this.getAttribute("src")}"\n        loading="${this.classList.contains("lazy")?"lazy":""}"\n        alt="${this.getAttribute("product-title")??"no image"}"\n      />\n    `}}class PotionsPrice extends PotionsElement_PotionsElement{static get observedAttributes(){return["price"]}attributeChangedCallback(){this.render()}templateStyle(){return"\n      <style>\n        potions-text {\n          text-decoration-color: var(\n            --potions-price-text-decoration-color,\n            inherit\n          );\n        }\n      </style>\n    "}template(){const t=parseStringToNumber(this.getAttribute("price")||"");return t&&"number"==typeof t&&!isNaN(t)?`\n        ${this.templateStyle()}\n        <potions-text class="${this.getAttribute("class")}" min-lines="1">\n          ${window.potions.actions.utils.formatPrice(t)} €\n        </potions-text>\n      `:""}}class PotionsLink extends PotionsElement_PotionsElement{render(){super.render();const t=this.shadowRoot?.querySelector("a");t&&this.getAttribute("onclick")&&t.addEventListener("click",(()=>{this.getAttribute("onclick")}))}templateStyle(){return"\n      <style>\n        .container {\n          text-decoration: none;\n          color: inherit;\n        }\n      </style>\n    "}template(){return`\n      ${this.templateStyle()}\n      <a\n        class="container"\n        href="${this.getAttribute("link")}"\n        target="${this.getAttribute("target")??"_self"}"\n      >\n        <slot> </slot>\n      </a>\n    `}}function SendEventMixin(t){return class extends t{render(){super.render(),this.shadowRoot?.querySelectorAll(".send-event").forEach((t=>{t?.addEventListener("click",(()=>{window.potions.analytics.sendEvent({widget:"flashback",action:"convert",id:"go_to_page",options:{label:this.getAttribute("trigger"),sku:this.product.id,items:[this.product]}}),window.location.href=this.product.link}))}))}}}SendEventMixin(PotionsElement_PotionsElement);const $t=[class PotionsFlashbackItemContainer extends PotionsElement_PotionsElement{constructor(){super(...arguments),this.isAboveChildElement=!1}render(){super.render();const t=this.shadowRoot?.querySelector(".flashback-content"),e=this.shadowRoot?.querySelector(".hover-content");t&&e&&(e.addEventListener("mouseenter",(()=>{this.isAboveChildElement=!0})),e.addEventListener("mouseleave",(()=>{this.isAboveChildElement=!1})),t.addEventListener("mouseover",(t=>{if(!this.classList.value.includes("active")){const n=t.target?.getBoundingClientRect();if(n){let{left:i}=n;this.classList.add("active"),i=i+t.target.offsetWidth/2-e.offsetWidth/2,e.style.left=`${i}px`}}})),t.addEventListener("mouseleave",(()=>{setTimeout((()=>{this.isAboveChildElement||this.classList.remove("active")}),100)})))}templateStyle(){return"\n    <style>\n      :host {\n        position: relative;\n      }\n\n      :host(.fade) .hover-content {\n        -webkit-transition: opacity 0.3s ease-in-out;\n        -moz-transition: opacity 0.3s ease-in-out;\n        -o-transition: opacity 0.3s ease-in-out;\n        transition: opacity 0.3s ease-in-out;\n        opacity: 0;\n      }\n\n      .hover-content {\n        position: fixed; \n        z-index: 9999999; \n        bottom: var(--potions-flashback-item-container-hover-bottom, 80px);\n        visibility: hidden;\n        width: var(--potions-flashback-item-container-hover-width, fit-content);\n      }\n\n      :host(.active) .hover-content,\n      :host(.activated) .hover-content {\n        visibility: visible !important;\n      }\n\n      :host(.fade.active) .hover-content,\n      :host(.fade.activated) .hover-content {\n        opacity: 1 !important;\n      }\n\n      .flashback-content {\n        position: relative;\n        display: flex;\n        justify-content: center;\n      }\n\n      :host(.slide) .hover-content {\n        max-height: 0; /* approximate max height */\n        transition-property: all;\n        transition-duration: 0.6s;\n        transition-timing-function: ease-in-out;\n      }\n\n      :host(.slide.active) .hover-content,\n      :host(.slide.activated) .hover-content {\n        max-height: 500px;\n      }\n      </style>\n      "}template(){return`\n      ${this.templateStyle()}\n      <div class="flashback-content">\n        <div class="hover-content">\n          <slot name="hover">\n          </slot>\n        </div>\n        <slot name="content">\n        </slot>\n      </div>\n    `}}];class PotionsFlashbackProduct extends(SendEventMixin(PotionsElement_PotionsElement)){constructor(){super(...arguments),this.product={}}render(){this.product=window.potions.widgets.flashback.actions.getProduct(parseInt(this.getAttribute("id")||"0",10)),super.render()}templateStyle(){return"\n      <style>\n        .slider-image {\n          --potions-image-height: 70px;\n          --potions-image-width: auto;\n        }\n\n        .card {\n          width: 160px;\n          background-color: white;\n        }\n\n        .card potions-image {\n          --potions-image-height: auto;\n          --potions-image-width: 100%;\n          margin: auto;\n        }\n\n        .card potions-button {\n          background-color: black;\n          color: white;\n          padding: 5px;\n          text-align: center;\n        }\n      </style>\n    "}template(){return`\n      ${this.templateStyle()}\n\n      <potions-flashback-item-container card-width="200" class="fade">\n        <potions-image\n          class="clickable slider-image send-event"\n          slot="content"\n          src="${this.product.img_link}"\n        ></potions-image>\n\n        <potions-stack slot="hover" class="card center-vertical">\n          <potions-image\n            class="clickable send-event"\n            src="${this.product.img_link}"\n          ></potions-image>\n          <potions-stack class="infos center-horizontal">\n            <potions-text class="title bold">\n              ${this.product.name}\n            </potions-text>\n            <potions-text\n              class="price bold h5 ${this.product.price?"":"hidden"}"\n              min-lines="1"\n              max-lines="1"\n            >\n              ${this.product.price}\n            </potions-text>\n            <potions-button class="bold send-event clickable">\n              VOIR LE PRODUIT\n            </potions-button>\n          </potions-stack>\n        </potions-stack>\n      </potions-flashback-item-container>\n    `}}const Mt=[PotionsText,PotionsStack,PotionsSlider,...Dt,PotionsImage,PotionsFlashbackProduct,...$t,PotionsModal];class PotionsFlashback extends PotionsElement_PotionsElement{constructor(){super(...arguments),this.products=[],this.nbVisibleElements=5}connectedCallback(){this.products=window.potions.data.products_seen.pageIds,super.connectedCallback()}templateStyle(){return"\n      <style>\n        potions-modal {\n          justify-content: unset;\n          z-index: 9999;\n          border: none;\n          bottom: 0;\n          left: 0;\n          top: unset;\n          transform: unset;\n          background-color: white;\n          --modal-min-width: 100%;\n          --modal-max-width: 100%;\n          height: 70px;\n          box-shadow: 0px -1px 10px rgba(0, 0, 0, 0.25);\n        }\n\n        .container {\n          display: flex;\n          align-items: center;\n        }\n\n        .title {\n          width: 300px;\n          background-color: black;\n          height: 100%;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n        }\n\n        potions-text {\n          color: white;\n        }\n\n        potions-slider {\n          width: 100%;\n        }\n\n        @media (max-width: 850px) {\n          :host {\n            display: none !important;\n          }\n        }\n      </style>\n    "}template(){return`\n      ${this.templateStyle()}\n      <potions-modal potion="flashback">\n        <div class="container">\n          <div class="title">\n            <potions-text class="h5">\n              Consultés récemment\n            </potions-text>\n          </div>\n\n          <potions-slider\n            visible-elements="${this.nbVisibleElements}"\n            controls="arrows"\n          >\n            ${this.products.map(((t,e)=>`\n                  <potions-flashback-product index="${e}" id="${t}">\n                  </potions-flashback-product>\n                `)).join("")}\n          </potions-slider>\n        </div>\n      </potions-modal>\n    `}}class PotionsData{constructor(){this.hosts=[]}requestUpdate(){this.hosts.forEach((t=>{t?.render()}))}}class ProductsSeen extends PotionsData{constructor(){super(),this._pageIds=[]}get pageIds(){return this._pageIds}set pageIds(t){this._pageIds!==t&&(this._pageIds=t),super.requestUpdate()}}const qt={sentry:!0,analytics:[{type:"matomo"},{type:"ua",ua:"UA-38168347-1"}],multiply:{api:{token:"",site_id:"16"},configs:{add_to_cart:{location:{desktop:!0,mobile:!0},algorithm:{experience_id:"4a7778fe-7a61-4af5-af52-02ee1160876d",experience_id_preview:"72e249ff-c053-4cc0-91e0-5c1909b7196a",parameters:["product_ids"]}},product_page:{location:{desktop:!0,mobile:!0},algorithm:{experience_id:"4d75db7c-9a8e-4adf-9b12-ef918311f778",experience_id_preview:"bb1f1d5d-2889-4393-86ae-9ed3773d6628",parameters:["product_ids"]}}}}}.flashback?.max_products||12,Nt={sentry:!0,analytics:[{type:"matomo"},{type:"ua",ua:"UA-38168347-1"}],multiply:{api:{token:"",site_id:"16"},configs:{add_to_cart:{location:{desktop:!0,mobile:!0},algorithm:{experience_id:"4a7778fe-7a61-4af5-af52-02ee1160876d",experience_id_preview:"72e249ff-c053-4cc0-91e0-5c1909b7196a",parameters:["product_ids"]}},product_page:{location:{desktop:!0,mobile:!0},algorithm:{experience_id:"4d75db7c-9a8e-4adf-9b12-ef918311f778",experience_id_preview:"bb1f1d5d-2889-4393-86ae-9ed3773d6628",parameters:["product_ids"]}}}}}.flashback?.matcher||"id";class Flashback extends Widget{constructor(t,e,n={}){super(t,e,Bt),this.products={},this._potions.widgets.push(new NavigationRecorder(t,"navigation_recorder")),this._potions.widgets.push(new PageEnricher(t,"page_enricher")),this._processes.display=new Process((async()=>{const t=await this._resources.rules,e=await t.is_on_page_flashback.apply();this._potions.logger.captureLog(["FLASHBACK - process page flashback - type",e]),e&&this.displayBannerProcess(e)}),"potions_update_flashback_list_ids"),this._processes.clear_flashback_product=new Process((()=>{this._potions.widgets.navigation_recorder.storage.db.update("user",[],"flashback_page_ids")}),"pageId",{rules:this._resources.rules,rule_name:"clear_flashback_products"}),this._processes.is_product_url=new Process((t=>{const e=t.detail.page;this._potions.actions.utils.isPotionsProductObject(e?.enrich)?this.updateFlashbackListIds(e):window.dispatchEvent(new CustomEvent("potions_update_flashback_list_ids"))}),"potions_enrich_page"),this._actions.getProduct=t=>{if(this.products[t])return{...this.products[t],...this.products[t]?.enrich}},this._actions.onClose=(t="banner")=>{this._potions.widgets.navigation_recorder.storage.db.update("user",{session:this._potions.state.sessionId,action:"close"},"flashback"),this._potions.analytics.sendEvent({widget:"flashback",action:"end",id:"close",options:{label:t}}),document.body.classList.remove("potions-flashback-on-page")},this._actions.redirectToProductPage=async(t,e,n="banner")=>{this._potions.analytics.sendEvent({widget:"flashback",action:"convert",id:"go_to_page",options:{sku:e,label:n}}),window.location.href=t},this._actions.getContainer=t=>document.body,this._actions.isShowFlashback=async t=>{const e=await this.getProductToShow(t),n=await this._resources.rules,i=await n.is_on_page_flashback.apply();return e.length>0&&i},this._elements=[PotionsFlashback,...Mt],this._potions.data.products_seen=new ProductsSeen,super.buildCustom(n)}async getProductToShow(t){const e=[],n=await this._resources.rules,i=await this._potions.widgets.navigation_recorder.storage.db.get("user","flashback_page_ids")||[];for(const o of i.map((t=>t.page_id))){const i=await this._potions.widgets.navigation_recorder.storage.db.get("visited_urls",o);await n.is_product_to_show.apply({url:i,trigger:t})&&(e.push(i),this.products[i.id]=i)}return e}async buildProductsToShow(t){const e=await this.getProductToShow(t),n=e.map((t=>({id:t.id,order:t.enrich?.order}))).sort(((t,e)=>t.order-e.order));return n?n.map((t=>t.id)):e.map((t=>t.id))}async displayBannerProcess(t){const e=await this.buildProductsToShow(t);this._potions.data.products_seen.pageIds=e,e.length>0&&(this._potions.logger.captureLog(["FLASHBACK - products to show",e]),this.displayBanner({trigger:t}))}async displayBanner({trigger:t}){const e=await this._actions.getContainer(t);if(e&&!document.querySelector("potions-flashback")){const n=document.createElement("potions-flashback");n.setAttribute("potions-data","products_seen"),n.setAttribute("root",""),n.setAttribute("trigger",t),e.append(n);const i=this._potions.data.products_seen.pageIds.map((t=>this._potions.widgets.flashback.actions.getProduct(t)));this._potions.analytics.sendEvent({widget:"flashback",action:"show",id:"banner",non_interactive:!0,options:{label:t,sku:i.map((t=>t.id)),items:i}}),this._potions.widgets.navigation_recorder.storage.db.update("user",{session:this._potions.state.sessionId,action:"show"},"flashback"),document.body.classList.add("potions-flashback-on-page")}}async updateFlashbackListIds(t){const e=await this._potions.widgets.navigation_recorder.storage.db.get("user","flashback_page_ids")||[];e.unshift({page_id:t.id,matcher:t.enrich[Nt]});const n=e.filter(((t,e,n)=>n.findIndex((e=>e.matcher===t.matcher))===e));this._potions.widgets.navigation_recorder.storage.db.update("user",n.slice(0,qt),"flashback_page_ids"),this._potions.logger.captureLog(["FLASHBACK - product added",t]),window.dispatchEvent(new CustomEvent("potions_update_flashback_list_ids"))}}function addToCart(t){return new Promise((e=>{const n=document.cookie.split("form_key=").pop()?.split(";").shift();fetch("/amasty_cart/cart/add/",{headers:{accept:"application/json, text/javascript, */*; q=0.01","content-type":"application/x-www-form-urlencoded; charset=UTF-8"},body:`product=${t}&selected_configurable_option=&related_product=&item=${t}&form_key=${n}&qty=1&product_page=true`,method:"POST"}).then((t=>{200===t.status&&t.json().then((t=>{e(t.is_add_to_cart)}))}))}))}const Ht=[PotionsImage,PotionsText,PotionsStack,PotionsLink,PotionsDivider,PotionsPrice];class PotionsProductCard extends PotionsElement_PotionsElement{constructor(){super(...arguments),this.product={},this.isLogged=!1}connectedCallback(){this.isLogged=function isConnected(){return void 0!==window.dataLayer.find((t=>t?.customerLoginState))}(),super.connectedCallback()}render(){super.render();const t=this.shadowRoot.querySelector(".img-container"),e=this.shadowRoot.querySelector(".add-to-cart"),n=this.shadowRoot.querySelector(".redirect-product"),i=this.shadowRoot.querySelector(".form"),o=this.shadowRoot.querySelectorAll(".send-event");t&&e&&n&&i&&o&&(window.innerWidth>760&&(t.addEventListener("mouseover",(()=>{e.classList.add("active-desktop"),n.classList.add("active-desktop"),i.classList.add("active-desktop")})),t.addEventListener("mouseleave",(()=>{e.classList.remove("active-desktop"),n.classList.remove("active-desktop"),i.classList.remove("active-desktop")}))),e.addEventListener("click",(()=>{e.classList.add("hidden"),n.classList.add("hidden")}))),window.innerWidth<760&&(t.addEventListener("click",(()=>{t.classList.value.includes("clicked")||(i.classList.add("active"),e.classList.add("active"),n.classList.add("active"),t.classList.add("clicked"))})),window.document.addEventListener("click",(o=>{if(!o.composedPath().includes(this))return i.classList.remove("active"),e.classList.remove("active"),n.classList.remove("active"),void t.classList.remove("clicked")}))),i.addEventListener("submit",(t=>(t.preventDefault(),t.stopPropagation(),window.potions.widgets[this.potions].actions.validateForm(i,this.isLogged?this.product.price:this.product.stroke_price??this.product.price),!1))),o.forEach((t=>{t.addEventListener("click",(()=>{window.potions.analytics.sendEvent({widget:this.potions,action:"convert",id:"go_to_page",options:{label:this.getAttribute("trigger"),sku:this.product.id}}),window.location.href=this.product.link}))}))}templateStyle(){return'\n          <style>\n            .hidden, input {\n              display: none;\n            }\n    \n            .card-container {\n              max-width: fit-content;\n              width: 14vw;\n              display: flex;\n              flex-direction: column;\n              justify-content: center;\n              align-items: center;\n              text-align: center;\n              padding: 0;\n              margin: 0;\n            }\n    \n            .img-container {\n              position: relative;\n            }\n    \n            .discount {\n              position: absolute;\n              left: calc(100% - 3.5rem);\n              right: unset;\n              bottom: calc(100% - 2.5rem);\n              top: unset;\n              background-color: var(--main-color);\n              color: #FFF;\n              font-size: 10px;\n              padding: 3px;\n            }\n    \n            .form {\n              opacity: 0;\n              position: absolute;\n              top: 0;\n              text-align: center;\n              width: 100%;\n              height: 100%;\n              background: rgb(255, 255, 255, 0.7);\n              z-index: 11;\n              border: 2px solid var(--main-color);\n              display: flex;\n              justify-content: space-evenly;\n              align-items: center;\n              flex-direction: column;\n              padding: 10px;\n              box-sizing: border-box;\n              transition: all 200ms ease-out;\n            }\n    \n            button {\n              margin-left: auto;\n              margin-right: auto;\n              font-size: 13px;\n              cursor: pointer;\n              border: 1px solid var(--main-color);\n              border-radius: 90px;\n              padding: 10px;\n              width: 90%;\n              transition: background-color 200ms ease-out;\n              transition: color 200ms ease-out;\n            }\n    \n            .button-stack {\n              background-color: transparent;\n            }\n    \n            .redirect-product, .add-to-cart:hover {\n              background-color: #FFF;\n              color: var(--main-color);\n            }\n    \n            .add-to-cart, .redirect-product:hover {\n              background-color: var(--main-color) ;\n              color: #FFF ;\n            }\n    \n            .active {\n              visibility: visible !important;        \n            }\n    \n            .active-desktop {\n              opacity: 1;        \n            }\n    \n            .hidden {\n              display: none !important;\n            }\n\n            .product-title {\n              font-weight: var(--product-title-font-weight, 400);\n            }\n    \n            .product-desc {\n              font-family: var(--font-title);\n              font-size: var(--title-font-size);\n              font-weight: 500;\n            }\n    \n            .price {\n              font-family: var(--font-price);\n              font-weight: var(--price-font-weight);\n              gap: 5px;\n              display: flex;\n              justify-content: center;\n              align-items: center;\n            }\n    \n            .stroke {\n              color: #999;\n              font-weight: 400;\n              font-size: 14px;\n            }\n    \n            .only-loader {\n              width: 30px;\n              margin: auto;\n            }\n    \n            .only-loader,\n            .only-success,\n            .only-error {\n              display: none;\n            }\n    \n            .loader .only-loader,\n            .success .only-success,\n            .error .only-error {\n              display: block;\n            }\n    \n            @media (max-width: 1200px) {\n              .card-container {\n                width: 200px;\n              }\n            }\n    \n            @media (max-width: 760px) {\n              .card-container {\n                width: 170px;\n                margin: 5px;\n              }\n    \n              :host([trigger="add-to-cart"]) .card-container{\n                width: 140px;\n              }\n    \n              .form {\n                opacity: 1;\n                visibility: hidden;\n              }\n    \n              button {\n                font-size: 14px;\n                padding: 8px;\n                width: 100%;\n              }\n    \n            }\n          </style>\n            '}template(){return`\n        ${this.templateStyle()}\n          <div class="card-container">\n            <div class="img-container">\n    \n              <potions-image class="clickable" src="${this.product?.img_link}">\n              </potions-image>\n    \n              <potions-text \n                class="discount ${this.product?.discount_rate?"":"hidden"}"\n              >\n                -${this.product?.discount_rate||""}%\n              </potions-text>\n    \n              <form class="form">\n                <input id="id" value="${this.product.item_id}" />\n                <input id="trigger" value="${this.getAttribute("trigger")}" />\n      \n                <potions-stack class="button-stack">  \n                  <button \n                    class="send-event redirect-product" \n                    type="button" \n                  >\n                    Voir le produit\n                  </button>\n\n                  <button \n                    class="add-to-cart ${this.product.has_options?"hidden":""}" \n                    type="submit" \n                  >\n                    Ajouter au panier\n                  </button>\n\n                  <div class="only-success">\n                    <p>\n                      <span class="fa fa-check fa-check--green"></span>\n                      Produit ajouté\n                    </p>\n                  </div>\n                  <div class="only-error">\n                    <p>Produit indisponible</p>\n                  </div>\n                  <div class="only-loader">\n                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect x="44.5" y="4" rx="5.5" ry="11" width="11" height="22" fill="#4b4a4d"><animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.9s" repeatCount="indefinite"/></rect><rect x="44.5" y="4" rx="5.5" ry="11" width="11" height="22" fill="#4b4a4d" transform="rotate(36 50 50)"><animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.8s" repeatCount="indefinite"/></rect><rect x="44.5" y="4" rx="5.5" ry="11" width="11" height="22" fill="#4b4a4d" transform="rotate(72 50 50)"><animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.7s" repeatCount="indefinite"/></rect><rect x="44.5" y="4" rx="5.5" ry="11" width="11" height="22" fill="#4b4a4d" transform="rotate(108 50 50)"><animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.6s" repeatCount="indefinite"/></rect><rect x="44.5" y="4" rx="5.5" ry="11" width="11" height="22" fill="#4b4a4d" transform="rotate(144 50 50)"><animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.5s" repeatCount="indefinite"/></rect><rect x="44.5" y="4" rx="5.5" ry="11" width="11" height="22" fill="#4b4a4d" transform="rotate(180 50 50)"><animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.4s" repeatCount="indefinite"/></rect><rect x="44.5" y="4" rx="5.5" ry="11" width="11" height="22" fill="#4b4a4d" transform="rotate(216 50 50)"><animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.3s" repeatCount="indefinite"/></rect><rect x="44.5" y="4" rx="5.5" ry="11" width="11" height="22" fill="#4b4a4d" transform="rotate(252 50 50)"><animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.2s" repeatCount="indefinite"/></rect><rect x="44.5" y="4" rx="5.5" ry="11" width="11" height="22" fill="#4b4a4d" transform="rotate(288 50 50)"><animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.1s" repeatCount="indefinite"/></rect><rect x="44.5" y="4" rx="5.5" ry="11" width="11" height="22" fill="#4b4a4d" transform="rotate(324 50 50)"><animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="0s" repeatCount="indefinite"/></rect></svg>\n                  </div>\n                </potions-stack>\n              </form>\n            </div>\n          \n            <potions-stack class="send-event product-desc clickable">\n              <potions-text class="product-title" max-lines=3>\n                ${this.product?.title}\n              </potions-text>\n    \n              <potions-stack class="price row">\n                <potions-price price="${this.product.price}"> </potions-price>\n                <potions-price \n                  class="stroke ${this.product.stroke_price?"":"hidden"}" \n                  price="${this.product.stroke_price}"\n                ></potions-price>\n              </potions-stack>\n              <potions-stack class="price row hidden">\n                <potions-price \n                  price="${this.product.stroke_price??this.product.price}"\n                ></potions-price>\n              </potions-stack>\n            </potions-stack>\n          </div>\n    `}}const Ut=Ht;const zt=[PotionsModal,PotionsSlider,class PotionsFlashbackProductCard extends PotionsProductCard{constructor(){super(...arguments),this.potions="flashback"}render(){super.product=window.potions.widgets.flashback.actions.getProduct(parseInt(this.getAttribute("id")||"0")),super.render()}},...Ut];class PotionsFlashback_PotionsFlashback extends PotionsElement_PotionsElement{constructor(){super(...arguments),this.productPageIds=[],this.slider=2}connectedCallback(){this.productPageIds=window.potions.data.products_seen.pageIds,document.querySelector("body.page-products")?window.innerWidth>1200?this.slider=3:this.slider=2:window.innerWidth>1200?this.slider=4:window.innerWidth>760?this.slider=3:this.slider=2,super.connectedCallback()}templateColor(){return"\n      <style>\n        :host {\n          --main-color: #FB779A;\n          --second-color: #FB779A;\n          --font-title: \"DM Sans\", sans-serif;\n          --font-price: 'DM Sans',sans-serif;\n          --title-font-size: 16px;\n          --slider-button-color-non-active: rgba(251, 119, 154, 0.5);\n          --slider-button-color-active: rgba(251, 119, 154, 1);\n        }\n\n      </style>\n    "}templateStyle(){return"\n    <style>\n\n      .title {\n        font-family: var(--font-title);\n        text-align: center;\n        font-size: 32px;\n        color: #000;\n        font-weight: 500;\n        margin-bottom: 10px;\n      }\n\n      potions-slider {\n        margin-bottom: 20px;\n          --slider-bullets-active-color: var(--slider-button-color-active);\n          --slider-bullets-border: none;\n          --slider-bullets-non-active-color: var(\n            --slider-button-color-non-active\n          );\n          --slider-bullets-size: 8px;\n          --slider-arrow-stroke-width: 1px;\n          --slider-arrow-height: 20px;\n          --slider-arrow-width: 25px;\n        }\n\n        potions-flashback-product-card {\n          display: flex;\n          flex-direction: column;\n          justify-content: center;\n          text-align: center;\n          align-items: center;\n          height: fit-content;\n        }\n      \n      @media (max-width: 760px) {\n        .title {\n          font-size: 24px;\n        }\n      }\n    </style>\n    "}template(){return`\n      ${this.templateStyle()}\n      ${this.templateColor()}\n\n      <div class="title">Vous avez consulté</div>\n\n      <potions-slider\n        visible-elements="${this.slider}"\n        controls="${window.innerWidth<760?"bullets":"arrows"}"\n      >\n        ${this.productPageIds?.map((t=>`\n              <potions-flashback-product-card\n                id="${t}"\n                trigger="${this.getAttribute("trigger")}"\n              >\n              </potions-flashback-product-card>\n            `)).join("")}\n      </potions-slider>\n    `}}const Wt={elements:[PotionsFlashback_PotionsFlashback,...zt],actions:{validateForm(t){const e=t.querySelector("#id").value,n=t.querySelector("#trigger").value;t.classList.add("loader");try{addToCart(e).then((i=>{i?(window.potions.analytics.sendEvent({widget:"flashback",action:"convert",id:"add",options:{sku:`${e}`,label:`${n}`}}),window.location.href="/checkout/cart"):(t.classList.remove("loader"),t.classList.add("error"))}))}catch(e){t.classList.remove("loader"),t.classList.add("error"),window.potions.logger.captureError(e,!1)}},getContainer(t){const e=document.createElement("section");if("home_page"===t){if(document.querySelector(".home-content")){document.querySelector(".widget.block.block-static-block")?.insertAdjacentElement("afterend",e),e.classList.add("widget","block","block-static-block"),window.innerWidth>760&&(e.style.marginTop="-90px")}else{document.querySelector(".column.main")?.append(e)}return e}if("product_page"===t)return new Promise((t=>{const n=new MutationObserver((n=>{document.querySelectorAll("#potions-multiply")&&!document.querySelector("potions-flashback")&&(document.querySelector("#potions-multiply")?.insertAdjacentElement("afterend",e),t(e))})),i=document.body;i&&n.observe(i,{childList:!0,subtree:!0,characterDataOldValue:!0})}));if("category_page"===t){return document.querySelector(".column.main")?.append(e),e}},async getImage(){const t=(await window.potions.actions.dom.getNode(".fotorama__stage__frame.fotorama_vertical_ratio"))?.querySelector(".fotorama__img");return t?.src},getItemID:()=>document.querySelector(".price-box.price-final_price")?.getAttribute("data-product-id"),getOptions:()=>!!document.querySelector(".product-options-wrapper"),getPrice(){let t=document.querySelector(".special-price .price-container.price-final_price.tax.weee .price")?.textContent;return t||(t=document.querySelector(".special-price,.price-box .price-container.price-final_price.tax.weee .price")?.textContent),t}}};const Vt={...Wt,elements:[class flashback_PotionsFlashback_PotionsFlashback extends PotionsFlashback_PotionsFlashback{static getElementName(){return"potions-flashback"}templateColor(){return"\n      <style>\n        :host {\n          --main-color: #0029F3;\n          --second-color: #FF53AB;\n          --font-title: 'DM Serif Display',serif;\n          --font-price: 'DM Sans',sans-serif;\n          --price-bold: 500;\n          --title-font-size: 18px;\n          --slider-button-color-non-active: rgba(0, 41, 243, 0.5);\n          --slider-button-color-active: rgba(0, 41, 243, 1);\n        }\n      </style>\n    "}},...zt]};class PotionsCardHoverContainer extends PotionsElement_PotionsElement{render(){super.render(),this.addEventListener("mouseover",(()=>{this.classList.add("active")})),this.addEventListener("mouseleave",(()=>{this.classList.remove("active")}))}templateStyle(){return"\n    <style>\n      .potions-card-hover-container {\n        display: flex;\n        width: var(--potions-card-container-width, 100%);\n        height: 100%;\n        box-sizing: border-box;\n        position: relative;\n        margin: var(--potions-card-hover-container-margin, unset);\n      }\n\n      .sub-container {\n        visibility: hidden;\n        position: absolute;\n        overflow: auto;\n        justify-content: center;\n        display: flex;\n        width: var(--potions-card-hover-container-width, 100%);\n        top: var(--potions-card-hover-container-top, 50%);\n      }\n\n      :host(.center-horizontal) .potions-card-hover-container {\n        justify-content: center;\n      }\n\n      :host(.fade) .sub-container {\n        -webkit-transition: opacity 0.3s ease-in-out;\n        -moz-transition: opacity 0.3s ease-in-out;\n        -o-transition: opacity 0.3s ease-in-out;\n        transition: opacity 0.3s ease-in-out;\n        opacity: 0;\n      }\n\n      :host(.grow) .sub-container {\n        transition: transform 180ms ease-in-out;\n        transform: scale(0);\n        transform-origin: center center;\n      }\n\n      :host(.active) .sub-container {\n        visibility: visible !important;\n      }\n\n      :host(.activated) .sub-container {\n        visibility: visible !important;\n        transform: scale(1) !important;\n        opacity: 1 !important;\n      }\n\n      :host(.fade.active) .sub-container {\n        opacity: 1 !important;\n      }\n\n      :host(.grow.active) .sub-container {\n        transform: scale(1) !important;\n      }\n\n      @keyframes grow {\n        from {\n          transform: scale(0);\n        }\n        to {\n          transform: scale(1);\n        }\n      }\n\n      :host(.collapse) .sub-container {\n        max-height: 0;\n        -webkit-transition: max-height 1s ease-in-out;\n        -moz-transition: max-height 1s ease-in-out;\n        -o-transition: max-height 1s ease-in-out;\n        transition: max-height 1s ease-in-out;\n        overflow: hidden;\n      }\n\n      :host(.collapse.active) .sub-container {\n        max-height: 100% !important;\n      }\n\n      </style>\n      "}template(){return`\n      ${this.templateStyle()}\n      <div class="potions-card-hover-container">\n        <div class="sub-container">\n          <slot name="product-hover"></slot>\n        </div>\n        <slot name="product-infos"></slot>\n      </div>\n    `}}class PotionsMultiplyCta extends(function CTAPopupMixin(t){return class extends t{render(){super.render(),this.shadowRoot?.querySelectorAll(".see-cart").forEach((t=>t.addEventListener("click",(()=>{window.potions.analytics.sendEvent({widget:"multiply",action:"interact",id:"go_to_cart",options:{label:this.getAttribute("trigger")}})})))),this.shadowRoot?.querySelectorAll(".continue-shopping").forEach((t=>t.addEventListener("click",(()=>{document?.querySelector(`potions-multiply[trigger="${this.getAttribute("trigger")}"]`)?.remove(),window.potions.analytics.sendEvent({widget:"multiply",action:"interact",id:"continue_shopping",options:{label:this.getAttribute("trigger")}}),window.potions.widgets.multiply.actions.onClose(this.getAttribute("trigger"),!1)}))))}templateCta(){return`\n        <potions-stack class="cta">\n          <a class="see-cart" href="${this.cartUrl}">\n            Voir mon panier\n          </a>\n          <potions-button class="continue-shopping">\n            Continuer mes achats\n          </potions-button>\n        </potions-stack>\n      `}}}(PotionsElement_PotionsElement)){connectedCallback(){null===this.getAttribute("cart-path")||""===this.getAttribute("cart-path")?window.potions.logger.captureError("Empty cart url",!1):this.cartUrl=`${window.location.origin}/${this.getAttribute("cart-path")}`.trim(),super.connectedCallback()}templateStyle(){return"\n      <style>\n\n        potions-stack {\n          gap: 18px;\n          height: fit-content;\n          margin: auto;\n        }\n\n        potions-button, a {\n          transition: all 150ms ease-in-out;\n          width: var(--potions-multiply-cta-width, 220px);\n          height: var(--potions-multiply-cta-height, fit-content);\n          font-family: var(--multiply-cta-font-family, inherit);\n          font-weight:  var(--multiply-cta-font-weight, 500);\n          font-size: var(--potions-multiply-cta-font-size, 85%);\n        }\n\n        .see-cart {\n          text-decoration: none;\n          border-radius: 5px;\n          display: flex;\n          justify-content: center;\n          align-items: center;\n          color: var(--potions-multiply-cta-see-cart-color, white);\n          background-color: var(--potions-multiply-cta-see-cart-background-color, black);\n          border: 1px solid var(--potions-multiply-cta-see-cart-border-color, black);\n          padding: 10px 0;\n        }\n\n        .see-cart:hover {\n          color: var(--potions-multiply-cta-see-cart-hover-color, black);\n          background-color: var(--potions-multiply-cta-see-cart-hover-background-color, white);\n        }\n\n        .continue-shopping {\n          color: var(--potions-multiply-cta-continue-shopping-color, black);\n          background-color: var(--potions-multiply-cta-continue-shopping-background-color, white);\n          border: 1px solid var(--potions-multiply-cta-continue-shopping-border-color, black);\n        }\n\n        .continue-shopping:hover {\n          color: var(--potions-multiply-cta-continue-shopping-hover-color, white);\n          background-color: var(--potions-multiply-cta-continue-shopping-hover-background-color, black);\n        }\n\n        :host(.row) potions-stack {\n          display: flex;\n        }\n\n        :host(.row-reverse) potions-stack {\n          display: flex;\n          flex-direction: row-reverse;\n        }\n\n        :host(.column) potions-stack {\n          display: flex;\n        }\n\n        :host(.column-reverse) potions-stack {\n          display: flex;\n          flex-direction: column-reverse;\n        }\n\n        :host(.center) potions-stack {\n          display: flex;\n          justify-content: center;\n        }\n\n        :host(.no-radius) a,\n        :host(.no-radius) potions-button {\n          border-radius: 0 !important;\n        }\n      </style>\n    "}template(){return`\n      ${this.templateStyle()}\n      ${this.templateCta()}\n    `}}const Gt=[PotionsStack,PotionsImage,PotionsText,PotionsPrice,PotionsCardHoverContainer];class PotionsMultiplyProductCard extends(function SendEventMixin_SendEventMixin(t){return class extends t{render(){super.render(),this.shadowRoot?.querySelectorAll(".send-event").forEach((t=>{t?.addEventListener("click",(()=>{window.potions.analytics.sendEvent({widget:"multiply",action:"convert",id:"go_to_page",options:{label:this.getAttribute("trigger"),sku:this.getAttribute("product-id"),items:[this.product]}}),window.location.href=this.product.link}))}))}}}(PotionsElement_PotionsElement)){constructor(){super(...arguments),this.product={}}render(){this.product=window.potions.widgets.multiply.actions.getRecommendedProduct(this.getAttribute("product-id")),super.render()}templateStyle(){return"\n      <style>\n        .slider-item-container {\n          justify-content: center;\n          display: grid;\n        }\n\n        potions-card-hover-container {\n          max-width: 250px !important;\n        }\n\n        .see-product{\n          background-color: black;\n        }\n\n        a {\n          text-decoration: none;\n          border-radius: 5px;\n          display: flex;\n          justify-content: center;\n          align-items: center;\n          font-size: 85%;\n          color: white;\n          padding: 8px 12px;\n        }\n      </style>\n    "}template(){return`\n      ${this.templateStyle()}\n      <div class="slider-item-container">\n        <potions-card-hover-container class="fade">\n          <potions-stack slot="product-hover" class="hover-container">\n            <slot name="product-card-hover">\n              <a\n                class="see-product send-event"\n                href="${this.product.link}"\n              >\n                VOIR LE PRODUIT\n              </a>\n            </slot>\n          </potions-stack>\n\n          <potions-stack slot="product-infos" class="send-event">\n            <potions-image\n              src="${this.product?.img_link}"\n              class="clickable send-event"\n            ></potions-image>\n            <potions-text class="left product-title">\n              ${this.product?.title}\n            </potions-text>\n            <potions-stack class="row price-container">\n              <potions-price price="${this.product?.price}" class="left">\n              </potions-price>\n              <potions-price price="${this.product?.stroke_price}" class="left">\n              </potions-price>\n            </potions-stack>\n          </potions-stack>\n        </potions-card-hover-container>\n      </div>\n    `}}const Kt=[PotionsMultiplyProductCard,...Gt,PotionsSlider,...Dt];class PotionsMultiplyIntegrated extends PotionsElement_PotionsElement{constructor(){super(...arguments),this.isMobile="mobile"===window.potions.state.device,this.recommendations=[]}render(){this.recommendations=window.potions.data[this.getAttribute("trigger")||""]?.recommendations,super.render()}template(){return`\n      <potions-slider\n        visible-elements="${this.isMobile?"2":"3"}"\n        controls="${this.isMobile?"bullets":"arrows"}"\n      >\n        ${this.recommendations?.map((t=>`\n              <potions-multiply-product-card\n                product-id="${t}"\n                trigger="${this.getAttribute("trigger")}"\n              ></potions-multiply-product-card>\n            `)).join("")}\n      </potions-slider>\n    `}}const Yt=[PotionsStack,PotionsMultiplyCta,class PotionsMultiplyTitle extends PotionsElement_PotionsElement{templateStyle(){return"\n    <style>\n        :host {\n          display: flex;\n          align-items: center;\n          flex-direction: row;\n        }\n\n        :host(.check) svg {\n          display: block;\n        }\n\n        :host(:not(.check)) svg {\n          display: none;\n        }\n\n        svg {\n          margin-right: 5px;\n          width: var(--multiply-title-svg-size, 24px);\n          height: var(--multiply-title-svg-size, 24px);\n        }\n        svg path {\n          stroke: var(--multiply-title-color, black);\n          stroke-width: 2; \n          stroke-linecap: round; \n          stroke-linejoin: round;\n        }\n        ::slotted(span), span {\n          color: var(--multiply-title-color, black);\n          font-family: var(--multiply-title-font-family, inherit);\n          font-size: var(--multiply-title-font-size, 16px);\n          font-weight: var(--multiply-title-font-weight, 500);\n        }\n        :host(.uppercase) span {\n          text-transform: uppercase;\n        }\n      </style>\n    "}template(){return`\n      ${this.templateStyle()}\n      <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <path d="M23 10.9943V12.0063C22.9986 14.3784 22.2305 16.6864 20.8103 18.5863C19.39 20.4862 17.3936 21.876 15.1189 22.5486C12.8442 23.2211 10.413 23.1404 8.18792 22.3183C5.96285 21.4963 4.06312 19.977 2.77206 17.9871C1.48099 15.9971 0.86777 13.6432 1.02384 11.2762C1.17992 8.90931 2.09693 6.65625 3.63811 4.85308C5.17929 3.0499 7.26206 1.79322 9.57581 1.27046C11.8895 0.747697 14.3103 0.986867 16.477 1.9523"/>\n        <path d="M23 3.2063L12 14.2173L8.70001 10.9173"/>\n      </svg>\n      <slot name="title">\n        <span>Ce produit a bien été ajouté à votre panier</span>\n      </slot>\n    `}},PotionsOverlay,PotionsModal,PotionsMultiplyIntegrated,PotionsCardHoverContainer,...Kt];const Jt=[PotionsStack,PotionsOverlay,PotionsModal,PotionsCardHoverContainer,PotionsText,class PotionsMultiplySliderCartContainer extends PotionsElement_PotionsElement{constructor(){super(...arguments),this.isMobile="mobile"===window.potions.state.device}templateStyle(){return"\n      <style>\n        potions-modal {\n          z-index: 999999999;\n          --modal-max-width: min(400px, 100%);\n          --modal-min-width: min(400px, 100%);\n          --modal-close-padding: 30px;\n          --modal-max-height: 100%;\n          height: 100%;\n          right: -300px;\n          -webkit-animation: slide 0.5s forwards;\n          animation: slide 0.5s forwards;\n        }\n\n        @-webkit-keyframes slide {\n          100% { right: 0; }\n        }\n\n        @keyframes slide {\n          100% { right: 0; }\n        }\n      </style>\n    "}template(){return`\n      ${this.templateStyle()}\n      <potions-modal potion="multiply" class="${this.isMobile?"":"right"}">\n        <slot></slot>\n      </potions-modal>\n    `}},...Dt,PotionsSlider,PotionsMultiplyProductCard,...Gt];const Xt=[PotionsMultiplyIntegrated,class PotionsMultiplyPopUp extends PotionsElement_PotionsElement{constructor(){super(...arguments),this.isMobile="mobile"===window.potions.state.device}templateStyle(){return"\n      <style>\n        potions-overlay {\n          --potions-z-index: 9999;\n        }\n\n        potions-modal {\n          --modal-max-width: 800px;\n          --modal-close-padding: 30px;\n          --modal-max-height: min(700px, 100%);\n        }\n\n        potions-multiply-title {\n          padding: 5px;\n        }\n\n        .content {\n          padding: 15px 12px;\n          gap: 15px;\n        }\n\n        @media(max-width: 700px){\n          .content {\n            padding: 10px 8px;\n            gap: 5px;\n          }\n\n          potions-multiply-title {\n            max-width: 80%;\n          }\n        }\n      </style>\n    "}template(){return`\n      ${this.templateStyle()}\n      <potions-overlay potion="multiply">\n        <potions-modal \n          mobile-width="700" \n          potion="multiply" \n          class="${this.isMobile?"bottom":""}"\n        >\n          <potions-stack class="content">\n            <potions-multiply-title class="check"></potions-multiply-title>\n\n            <potions-divider mobile-size="800" class="text-down">\n              <potions-text class="subtitle divider-title">\n                Complétez votre look\n              </potions-text>\n            </potions-divider>\n\n\n            <potions-multiply-integrated\n              trigger="${this.getAttribute("trigger")}"\n              product-id="${this.getAttribute("product-id")}"\n            ></potions-multiply-integrated>\n\n            <potions-multiply-cta cart-path="fr/panier?action=show"></potions-multiply-cta>\n          </potions-stack>\n\n        </potions-modal>\n      </potions-overlay>\n    `}},class PotionsMultiplySliderCart extends PotionsElement_PotionsElement{constructor(){super(...arguments),this.isMobile="mobile"===window.potions.state.device,this.recommendations=[]}connectedCallback(){this.recommendations=window.potions.data[this.getAttribute("trigger")||""]?.recommendations,super.connectedCallback()}templateStyle(){return"\n      <style>\n        potions-slider-cart-container {\n          padding: 10px;\n        }\n\n        potions-stack {\n          height: fit-content;\n          margin: auto;\n        }\n\n      </style>\n    "}template(){return`\n      ${this.templateStyle()}\n      <potions-multiply-slider-cart-container>\n        <potions-stack>\n          <potions-text>Vous aimerez aussi</potions-text>\n          <potions-slider\n            visible-elements="2"\n            controls="${this.isMobile?"bullets":"arrows"}"\n          >\n            ${this.recommendations?.map(((t,e)=>`\n                  <potions-multiply-product-card \n                    product-id="${t}" \n                    index="${e}" \n                    trigger="${this.getAttribute("trigger")}"\n                  ></potions-multiply-product-card>\n                `)).join("")}\n          </potions-slider>\n        </potions-stack>\n      </potions-multiply-slider-cart-container>\n    `}},...new Set([...Kt,...Yt,...Jt])];class PotionsMultiply extends PotionsElement_PotionsElement{template(){return function typeOfMultiply(t,e){return t.includes("add_to_cart")?`\n      <potions-multiply-pop-up product-id="${e}" trigger="${t}"></potions-multiply-pop-up>\n    `:t.includes("slider_cart")?`\n      <potions-multiply-slider-cart product-id="${e}" trigger="${t}"></potions-multiply-slider-cart>\n    `:`\n    <potions-multiply-integrated product-id="${e}" trigger="${t}"></potions-multiply-integrated>\n  `}(this.getAttribute("trigger")||"",this.getAttribute("product-id")||"")}}class Cart extends PotionsData{constructor(){super(),this._value=0,this._cartProductIds=[]}get value(){return this._value}set value(t){this._value!==t&&(this._value=t),super.requestUpdate()}get cart_product_ids(){return this._cartProductIds}set cart_product_ids(t){this._cartProductIds!==t&&(this._cartProductIds=t),super.requestUpdate()}}const Qt=[{name:"rules",file:"rules.json",type:Rule}];class Recommendations extends PotionsData{constructor(){super(),this._recommendations=[]}get recommendations(){return this._recommendations}set recommendations(t){this._recommendations!==t&&(this._recommendations=t),super.requestUpdate()}}const Zt={redirectToProductPage:(t,e,n)=>{window.potions.analytics.sendEvent({widget:"multiply",action:"convert",id:"go_to_page",options:{label:e,sku:n}}),window.location.href=t},removeNativeBanner:()=>{document.body.classList.remove("hide-potions-banner"),document.body.classList.add("hide-native-banner")},showNativeBanner:()=>{document.body.classList.remove("hide-native-banner"),document.body.classList.add("hide-potions-banner")},getContainer:()=>document.body,updatePageHtml:()=>{},formatPrice:t=>window.potions.actions.utils.formatPrice(t),getProductsIds:async(t,e)=>window.potions.widgets.multiply.getProductIds(t,e),getCartInfo:()=>({value:0,cart_product_ids:[]}),getSpecificParameters:()=>({viewed_product_ids:[]}),onClose:(t="add_to_cart",e=!0)=>{e&&window.potions.analytics.sendEvent({widget:"multiply",action:"end",id:"close",options:{label:t}}),Zt.showNativeBanner()},getRecommendedProduct:t=>window.potions.widgets.multiply.getRecommendedProduct(t),getLanguage:()=>"FR",getStyleHideNativeBanner:()=>document.createElement("style"),async getRecommendedProducts(t,e){let n=await window.potions.widgets.multiply.queryRecommendations(t,window.potions.widgets.multiply.config[e].algorithm);return n=window.potions.widgets.multiply.filterReco(n),window.potions.logger.captureLog([`MULTIPLY - mode api - trigger : ${e}`,window.potions.widgets.multiply.config[e].algorithm.collection_id?`collection_id : ${window.potions.widgets.multiply.config[e].algorithm.collection_id}`:`experience_id : ${window.potions.widgets.multiply.config[e].algorithm.experience_id}`,n]),window.potions.widgets.multiply.buildCatalog(n),n.map((t=>t.id))||[]}},te={api:{token:"",site_id:"16"},configs:{add_to_cart:{location:{desktop:!0,mobile:!0},algorithm:{experience_id:"4a7778fe-7a61-4af5-af52-02ee1160876d",experience_id_preview:"72e249ff-c053-4cc0-91e0-5c1909b7196a",parameters:["product_ids"]}},product_page:{location:{desktop:!0,mobile:!0},algorithm:{experience_id:"4d75db7c-9a8e-4adf-9b12-ef918311f778",experience_id_preview:"bb1f1d5d-2889-4393-86ae-9ed3773d6628",parameters:["product_ids"]}}}};const ee={api:{token:"",site_id:"16"},configs:{add_to_cart:{location:{desktop:!0,mobile:!0},algorithm:{experience_id:"4a7778fe-7a61-4af5-af52-02ee1160876d",experience_id_preview:"72e249ff-c053-4cc0-91e0-5c1909b7196a",parameters:["product_ids"]}},product_page:{location:{desktop:!0,mobile:!0},algorithm:{experience_id:"4d75db7c-9a8e-4adf-9b12-ef918311f778",experience_id_preview:"bb1f1d5d-2889-4393-86ae-9ed3773d6628",parameters:["product_ids"]}}}};const ne={api:{token:"",site_id:"16"},configs:{add_to_cart:{location:{desktop:!0,mobile:!0},algorithm:{experience_id:"4a7778fe-7a61-4af5-af52-02ee1160876d",experience_id_preview:"72e249ff-c053-4cc0-91e0-5c1909b7196a",parameters:["product_ids"]}},product_page:{location:{desktop:!0,mobile:!0},algorithm:{experience_id:"4d75db7c-9a8e-4adf-9b12-ef918311f778",experience_id_preview:"bb1f1d5d-2889-4393-86ae-9ed3773d6628",parameters:["product_ids"]}}}};class Multiply extends Widget{constructor(t,e,n={},i=Qt){super(t,e,i,n),this.productIds={},this.config={...ne.configs||{}},this._catalog={},this._processes.add_product_to_cart=new Process((t=>this.showMultiply({event:t,trigger:"add_to_cart"})),"potions_multiply_add_to_cart"),this._processes.add_product_to_slider_cart=new Process((t=>this.showMultiply({event:t,trigger:"slider_cart"})),"potions_multiply_slider_cart"),this._processes.page_multiply=new Process((async t=>{const e=await this._resources.rules,n=await e.is_on_page_multiply.apply();this._potions.logger.captureLog(["MULTIPLY - process page multiply - type",n?.join(" | ")]),n?.forEach((e=>{this.config[e]&&this.config[e].location[this._potions.state.device]&&this.showMultiply({event:t,trigger:e})}))}),"domLoaded"),this._processes.add_style=new Process((()=>{const t=this._actions.getStyleHideNativeBanner();document.head.append(t),this._actions.showNativeBanner()}),"domLoaded"),this._actions=Zt,this._elements=[PotionsMultiply,...Xt],this._potions.data.cart=new Cart,Object.keys(this.config).forEach((t=>{this._potions.data[t]=new Recommendations})),super.buildCustom(n)}async getProductIds(t,e){const n=await this._resources.rules,i=n[this.config[e].algorithm.rule]??n[`get_product_ids_${e}`]??n.get_product_ids,o=await i.apply({event:t,window});return o?Array.isArray(o)?{product_ids:o}:{product_id:o,product_ids:[o]}:{product_ids:[]}}getRecommendedProduct(t){try{return this._catalog[t]||{}}catch(t){return this._potions.logger.captureError(t,!1),{}}}async queryRecommendations(t,e){return new Promise((n=>{let i;const o=this.buildParameters(e.parameters,t);i=e.collection_id?async function buildAPIRequest(t){return fetch(`https://client.experiences.get-potions.com/v1/${te.api.site_id}/collection`,{headers:{authorization:te.api.token,"content-type":"application/json"},body:JSON.stringify(t),method:"POST"})}({collection_id:e.collection_id,parameters:o}):async function buildAPIRequestWithExpId(t,e){return fetch(`https://client.experiences.get-potions.com/v1/${ee.api.site_id}/experience/${t}`,{headers:{authorization:ee.api.token,"content-type":"application/json"},body:JSON.stringify(e),method:"POST"})}(e.experience_id,o);let r=[];i.then((t=>t.json())).then((t=>{r=(t?.products||[]).filter((t=>null!==t)),n(r)})).catch((t=>{this._potions.logger.captureError(t),n([])})),setTimeout((()=>{r.length||this._potions.logger.captureLog(["MULTIPLY - timeout back request"]),n([])}),2e3)}))}filterReco(t){return t.filter((t=>!t.link.includes("https://")||t.link.includes(window.location.host)))}buildCatalog(t){const e=t.reduce(((t,e)=>({...t,[e.id]:e})),{});this._catalog={...this._catalog,...e}}buildParameters(t,e){const n=t.reduce(((t,n)=>(t[n]=e[n]??[],t)),{});return this._potions.logger.captureLog(["MULTIPLY - parameters send to API",n]),n}async showMultiply({event:t,trigger:e}){this.productIds[e]=await this.actions.getProductsIds(t?.detail?.native_event,e),this._potions.logger.captureLog([`MULTIPLY - products ids for trigger ${e}`,this.productIds[e],this.productIds[e].product_ids]);const n=await this.actions.getCartInfo(t?.detail?.native_event,e);if(Object.entries(n).forEach((([t,e])=>{this._potions.data.cart[t]=e||0})),Object.values(this.productIds[e]).length>0){const t=await this._actions.getSpecificParameters(),i=await this._actions.getRecommendedProducts({...this.productIds[e],...n,...t},e);if(i.length>0){if(this._potions.data[e].recommendations=i,!document.querySelector(`potions-multiply[trigger='${e}']`)){const t=document.createElement("potions-multiply");t.setAttribute("trigger",e),t.setAttribute("root",""),t.setAttribute("potions-data",e);const n=await this.actions.getContainer(e);n?(this.actions.updatePageHtml(e),n.append(t),this._potions.analytics.sendEvent({widget:"multiply",action:"show",id:"banner",options:{label:e,sku:this.productIds[e].product_ids,items:i.map((t=>this._catalog[t]))},non_interactive:!0})):this._potions.logger.captureLog(["MULTIPLY - ERROR no container found"])}}else this._actions.showNativeBanner()}else this._actions.showNativeBanner()}}const ie=Ht;class PotionsMultiplyProductCard_PotionsMultiplyProductCard extends PotionsProductCard{constructor(){super(...arguments),this.potions="multiply"}render(){super.product=window.potions.widgets.multiply.actions.getRecommendedProduct(this.getAttribute("product-id")),super.render()}}const oe=[PotionsDivider,PotionsText,PotionsStack,PotionsSlider,...Dt,PotionsPrice,PotionsImage,PotionsLink,PotionsMultiplyProductCard_PotionsMultiplyProductCard,PotionsSliderControlsBullets];const re=[PotionsMultiplyProductCard_PotionsMultiplyProductCard,...ie];const se=[...Dt,PotionsSlider,PotionsOverlay,PotionsModal,PotionsText,PotionsImage,class PotionsMultiplyFreeDelivery extends PotionsElement_PotionsElement{constructor(){super(...arguments),this.remainingValue=0,this.cartValue=0,this.deliveryPrice=0}render(){this.cartValue=parseFloat(window.potions.data.cart.value||this.getAttribute("cart-value")||"0"),this.deliveryPrice=parseFloat(window.potions.data.cart.delivery_price||this.getAttribute("free-delivery-at-cart-value")||"0"),this.remainingValue=this.deliveryPrice-this.cartValue,super.render()}template(){return`\n    <style>\n      :host {\n        display: flex;\n        flex-direction: column;\n        align-items: var(--delivery-align-item, center);\n        max-width: var(--progress-max-width, 100%);\n        font-family: var(--delivery-font, inherit);\n      }\n      :host(.no-euro) .euro {\n        display: none;\n      }\n      .container {\n        display: var(--free-delivery-text-display, flex);\n        align-items: center;\n        margin-bottom: var(--free-delivery-title-margin-bottom, unset);\n      }\n\n      .container div {\n        line-height: var(--free-delivery-line-height, 30px);\n      }\n\n      progress {\n        margin-top: var(--progress-margin-top, unset);\n        -webkit-appearance: none;\n        height: 7px;\n        width: var(--progress-width-value, 100%);\n        border: var(--progress-border-value, unset);\n        border-radius: 10px\n      }\n\n      progress::-webkit-progress-value {\n        background: var(--progress-value-bg-color, black);\n      }\n\n      progress::-moz-progress-bar {\n        background: var(--progress-value-bg-color, #c4c4c4);\n        border-radius: 10px;\n      }\n\n      progress::-webkit-progress-value {\n        background: var(--progress-value-bg-color, black);\n        border-radius: 10px;\n      }\n\n      progress::-webkit-progress-bar {\n        border-radius: 10px;\n        background: var(--progress-bar-bg-color, #c4c4c4);\n      }\n\n      .not-free-delivery .only-free-devilery,\n      .free-delivery .only-not-free-devilery {\n        display: none;\n      }\n      .not-free-delivery .only-not-free-devilery,\n      .free-delivery .only-free-devilery  {\n        display: inline;\n        text-align:  var(--free-delivery-text-align, center);\n      }\n\n      .not-free-delivery-remaining-value {\n        font-weight: var(--not-free-delivery-font-weight, inherit);\n        font-size: var(--not-free-delivery-font-size, inherit);\n        color: var(--not-free-delivery-color, inherit);\n      }\n      .price {\n        font-weight: var(--not-free-delivery-price-font-weight, inherit);\n        font-size: var(--not-free-delivery-price-font-size, inherit);\n        color: var(--not-free-delivery-price-color, inherit);\n      }\n\n      .row {\n        display: flex;\n        align-items: center;\n        width: 100%;\n        white-space: nowrap;\n        justify-content: space-around;\n      }\n\n      .row > span{\n        display: none;\n        margin: 0 10px;\n      }\n\n      :host(.show-range-price) .row >span {\n        display: block;\n      }\n\n      .row.free-delivery {\n        display: var(--progress-bar-free-delivery-display, flex);\n      }\n \n      .row.not-free-delivery {\n        display: var(--progress-bar-not-free-delivery-display, flex);\n      }\n\n      .under {\n        font-weight: var(--under-progress-bar-font-weight, normal);\n        font-size: var(--under-progress-bar-font-size, 14px);\n        line-height: var(--under-progress-bar-line-height, 1);\n      }\n    </style>\n\n    <div class="container ${this.remainingValue<=0?"free-delivery":"not-free-delivery"}">\n      <slot name="img"></slot>\n\n      <div class="only-free-devilery">\n        <slot name="free-delivery">La livraison est gratuite !</slot>\n      </div>\n      <div class="only-not-free-devilery">\n        <slot name="not-free-delivery-before">Plus que </slot>\n        <span class="not-free-delivery-remaining-value"><span class="price">${window.potions.actions.utils.formatPrice(this.remainingValue)}<span class="euro"> €</span></span>\n        </span><slot name="not-free-delivery-after"> pour bénéficier de la livraison offerte</slot>\n      </div>\n    </div>\n\n    <div class="row ${this.remainingValue<=0?"free-delivery":"not-free-delivery"}">\n      <span >0 €</span>\n      <progress \n        max="${this.deliveryPrice}" \n        value="${this.cartValue}"\n      ></progress>\n      <span>\n        ${window.potions.actions.utils.formatPrice(this.deliveryPrice)} €\n      </span>\n    </div>\n\n    <div class="under">\n      <slot name="under-progress-bar"></slot>\n    </div>\n      `}},class PotionsMultiplyResumeCart_PotionsMultiplyResumeCart extends PotionsElement_PotionsElement{constructor(){super(...arguments),this.cart=window.potions.widgets.multiply.productIds.add_to_cart,this.isMobile=window.innerWidth<760}render(){super.render()}templateStyle(){return"\n      <style>\n\n        .upper-left {\n          justify-content: flex-start;\n        }\n\n        potions-image {\n          width: 150px;\n        }\n\n        .title {\n          font-size: 16px;\n          font-weight: 500;\n          text-align: left;\n          line-height: 17px;\n        }\n\n        .title-price {\n          display: flex;\n          flex-direction: column;\n          justify-content: center;\n          gap: 20px\n        }\n\n        .price {\n          font-size: 16px;\n          font-weight: 500;\n          width: fit-content;\n          padding: 0;\n        }\n\n        .stroke {\n          color: #aaaaaa;\n        }\n\n        .hidden {\n          display: none;\n        }\n\n        @media (max-width: 760px) {\n          .price {\n            margin: auto;\n          }\n\n          .upper-left {\n            justify-content: center;\n            padding: 0;\n          }\n\n          .title-price {\n            gap: 10px;\n          }\n        }\n \n      </style>\n        "}template(){return`\n      ${this.templateStyle()}\n\t\t\t<potions-stack class="upper-left row">\n        \n          <potions-image class="clickable ${this.isMobile?"hidden":""}" src="${this.cart.img}">\n          </potions-image>\n\n          <potions-stack class="title-price">\n            <potions-text class="title" max-lines="3">\n              ${this.cart.title}\n            </potions-text>\n\n            <potions-stack class="price row">\n              <potions-price price="${this.cart.price}">\n              </potions-price>\n\n              <potions-price class="stroke" price="${this.cart.crossed_price}">\n              </potions-price>\n            </potions-stack>\n\n          </potions-stack>\n\t\t\t</potions-stack>\n      \n    `}},...re];const ae=[class PotionsMultiplyIntegrated_PotionsMultiplyIntegrated extends PotionsElement_PotionsElement{constructor(){super(...arguments),this.recommendations=[],this.isMobile=window.innerWidth<760,this.nbSlide=4}connectedCallback(){window.innerWidth<760?this.nbSlide=2:window.innerWidth<1200&&(this.nbSlide=3),super.connectedCallback()}render(){this.recommendations=window.potions.data[this.getAttribute("trigger")||""].recommendations,this.classList.add(`bucket_${window.potions.widgets.ab_experiment.config.multiply.bucket}`),super.render()}templateStyle(){return"\n      <style>\n        potions-stack {\n          display: flex;\n          flex-direction: column;\n        }\n\n        .title {\n          font-weight: var(--title-font-weight);\n          font-family: var(--font-title);\n          font-size: 32px;\n          text-align: center;\n        }\n\n        potions-multiply-product-card {\n          display: flex;\n          flex-direction: column;\n          justify-content: center;\n          align-items: center;\n          height: fit-content;\n        }\n\n        potions-slider {\n          --slider-bullets-active-color: var(--slider-button-color-active);\n          --slider-bullets-border: none;\n          --slider-bullets-non-active-color: var(\n            --slider-button-color-non-active\n          );\n          --slider-bullets-size: 8px;\n          --slider-arrow-stroke-width: 1px;\n          --slider-arrow-height: 20px;\n          --slider-arrow-width: 25px;\n        }\n\n        @media (max-width: 760px) {\n          .title {\n            font-size: 24px;\n            padding-left\n          }\n        }\n\n        /* A/B TEST */\n\n        :host(.bucket_B) {\n          background-color: #f8f8f8;\n          --title-font-weight: 600;\n          --product-title-font-weight: 700;\n        }\n\n        :host(.bucket_B) potions-stack {\n          margin-bottom: 15px;\n        }\n      </style>\n    "}template(){return`\n      ${this.templateStyle()}\n      <potions-stack>\n        <potions-text class="title" max-lines="2">\n          Vous aimerez aussi\n        </potions-text>\n        <div class="slider only-desktop">\n          <potions-slider\n            visible-elements="${this.nbSlide}"\n            controls="${this.isMobile?"bullets":"arrows"}"\n          >\n            ${this.recommendations?.map((t=>`\n                  <potions-multiply-product-card\n                    product-id="${t}"\n                    trigger="${this.getAttribute("trigger")}"\n                    potions="multiply"\n                  >\n                  </potions-multiply-product-card>\n                `)).join("")}\n          </potions-slider>\n        </div>\n      </potions-stack>\n    `}},class PotionsMultiplyPopUp_PotionsMultiplyPopUp extends PotionsElement_PotionsElement{constructor(){super(...arguments),this.recommendations=[],this.isMobile=window.innerWidth<760,this.cartInfo={}}render(){this.recommendations=window.potions.data[this.getAttribute("trigger")||""].recommendations,this.cartInfo=window.potions.widgets.multiply.cartInfo,super.render()}templateStyle(){return'\n      <style>\n        potions-modal {\n          --modal-close-size: 25px;\n          --modal-close-padding: 20px;\n          --modal-close-stroke-color: #979797;\n          --modal-close-strike-width: 1px;\n          --modal-max-width: 800px;\n          --modal-min-width: 800px;\n          box-shadow: 0px 5px 10px #777777;\n          border-radius: 5px;\n          max-height: 95%;\n          padding: 10px;\n          font-family: "DM Sans", sans-serif;\n          background-color: white;\n        }\n\n        potions-multiply-product-card {\n          display: flex;\n          flex-direction: column;\n          height: fit-content;\n          justify-content: center;\n          align-items: center;\n        }\n\n        potions-overlay {\n          --potions-overlay-bg-color: rgba(229, 229, 229, 0.5);\n          z-index: 99999999;\n        }\n\n        .pop-title {\n          text-align: left;\n          color: #fb779a;\n          font-family: "DM Sans", sans-serif;\n          font-size: 20px;\n          font-weight: 500;\n          padding: 10px 20px;\n        }\n\n        .upper {\n          display: flex;\n          justify-content: space-between;\n          width: auto;\n        }\n\n        .upper-right {\n          width: 110%;\n          margin: auto;\n        }\n\n        .upper-left {\n          width: 90%;\n        }\n\n        potions-multiply-free-delivery {\n          --not-free-delivery-font-size: 15px;\n          --not-free-delivery-font-weight: 800;\n          --progress-value-bg-color: var(--main-color);\n        }\n\n        potions-multiply-free-delivery span {\n          font-size: 12px;\n          font-weight: 600;\n        }\n\n        .button-container {\n          justify-content: center;\n        }\n\n        button,\n        .button {\n          font-family: "DM Sans", "sans serif";\n          text-align: center;\n          margin-left: auto;\n          margin-right: auto;\n          font-size: 16px;\n          cursor: pointer;\n          border: 2px solid var(--main-color);\n          border-radius: 90px;\n          padding: 10px 30px;\n          width: 100%;\n          transition: background-color 200ms ease-out;\n          transition: color 200ms ease-out;\n        }\n\n        .button {\n          text-decoration: none;\n          padding: 10px 0;\n        }\n\n        .add-to-cart,\n        .redirect-product:hover {\n          background-color: var(--main-color);\n          color: #fff;\n        }\n\n        .redirect-product,\n        .add-to-cart:hover {\n          background-color: #fff;\n          color: var(--main-color);\n        }\n\n        .text-divider {\n          padding: 0 20px;\n          text-transform: none;\n          font-family: "DM Sans", sans-serif;\n          font-size: 24px;\n        }\n\n        potions-slider {\n          --slider-bullets-active-color: var(--slider-button-color-active);\n          --slider-bullets-border: none;\n          --slider-bullets-non-active-color: var(\n            --slider-button-color-non-active\n          );\n          --slider-bullets-size: 8px;\n          --slider-arrow-stroke: #979797;\n          --slider-arrow-stroke-width: 1px;\n          --slider-arrow-height: 40px;\n          --slider-arrow-width: 40px;\n        }\n\n        .slider {\n          overflow: auto;\n        }\n\n        @media (max-width: 760px) {\n          .container {\n            gap: 0;\n            display: flex;\n            flex-direction: column;\n          }\n\n          .pop-title {\n            text-align: center;\n            font-size: 14px;\n          }\n\n          .upper {\n            flex-wrap: wrap;\n            gap: 0;\n          }\n\n          .button-container {\n            justify-content: center;\n            flex-direction: row;\n            display: flex;\n            align-items: center;\n          }\n\n          .button,\n          button {\n            width: fit-content !important;\n            padding: 10px 20px;\n            font-size: 13px;\n          }\n\n          .title {\n            font-size: 15px;\n          }\n\n          .upper-left {\n            width: 100%;\n          }\n\n          potions-stack.upper potions-stack {\n            padding: 0;\n          }\n        }\n      </style>\n    '}template(){return`\n      ${this.templateStyle()}\n      <potions-overlay potion="multiply">\n        <potions-modal\n          mobile-width="800"\n          potion="multiply"\n          class="${this.isMobile?"bottom":""}"\n        >\n          <potions-stack class="container">\n            <potions-text class="pop-title">\n              Ce produit a bien été ajouté à votre panier\n            </potions-text>\n\n            <potions-stack class="row upper">\n              <potions-stack class="row upper-left">\n                <potions-multiply-resume-cart> </potions-multiply-resume-cart>\n              </potions-stack>\n\n              <potions-stack class="upper-right button-stack">\n                <potions-stack class="button-container">\n                  <button\n                    class="redirect-product "\n                    type="button"\n                    onclick="window.potions.widgets.multiply?.actions?.onClose();"\n                  >\n                    Poursuivre mes achats\n                  </button>\n\n                  <a\n                    class="button add-to-cart"\n                    onclick="window.potions.analytics.sendEvent({widget:'multiply',action:'interact',id:'go_to_cart',options:{ label: '${this.getAttribute("trigger")}'}}); window.location.href='/checkout/cart'"\n                  >\n                    Voir mon panier\n                  </a>\n                </potions-stack>\n\n                <potions-multiply-free-delivery\n                  potions-data="cart"\n                  cart-value="${this.cartInfo?.value}"\n                  free-delivery-at-cart-value="${this.getAttribute("max-price")}"\n                >\n                  <span slot="free-delivery">La livraison est offerte !</span>\n                  <span slot="not-free-delivery-before">Plus que </span>\n                  <span slot="not-free-delivery-after">\n                    pour profiter de la livraison gratuite !</span\n                  >\n                </potions-multiply-free-delivery>\n              </potions-stack>\n            </potions-stack>\n\n            <potions-divider mobile-size="800">\n              <potions-text class="title text-divider">\n                Complétez votre look\n              </potions-text>\n            </potions-divider>\n\n            <div class="slider only-desktop">\n              <potions-slider\n                visible-elements="${this.isMobile?"2":"3"}"\n                controls="${this.isMobile?"bullets":"arrows"}"\n              >\n                ${this.recommendations?.map((t=>`\n                      <potions-multiply-product-card\n                        product-id="${t}"\n                        trigger="${this.getAttribute("trigger")}"\n                        potions="multiply"\n                      >\n                      </potions-multiply-product-card>\n                    `)).join("")}\n              </potions-slider>\n            </div>\n          </potions-stack>\n        </potions-modal>\n      </potions-overlay>\n    `}},...oe,...se];class PotionsMultiply_PotionsMultiply extends PotionsElement_PotionsElement{constructor(){super(...arguments),this.deliveryMaxValue="29"}templateColor(){return"\n      <style>\n        potions-multiply-pop-up,\n        potions-multiply-integrated {\n          --main-color: #FB779A;\n          --second-color: #FB779A;\n          --font-title: 'DM Sans',sans-serif;\n          --price-bold: 500;\n          --title-font-size: 16px;\n          --slider-button-color-non-active: rgba(251, 119, 154, 0.5);\n          --slider-button-color-active: rgba(251, 119, 154, 1);\n        }\n      </style>\n    "}template(){return`\n      ${this.templateColor()}\n      ${"add_to_cart"===this.getAttribute("trigger")?`<potions-multiply-pop-up max-price="${this.deliveryMaxValue}" trigger="add_to_cart" product-id="${this.getAttribute("product-id")}"></potions-multiply-pop-up>`:`<potions-multiply-integrated trigger="${this.getAttribute("trigger")}" product-id="${this.getAttribute("product-id")}"></potions-multiply-integrated>`}\n\n    `}}const ce={elements:[PotionsMultiply_PotionsMultiply,...ae],listeners:{add_to_cart_request:new class RequestListener extends Listener{launch(t){try{this.overrideXmlHttpRequest(t),this.overrideFetch(t)}catch(t){window.potions.logger.captureError(t)}}disconnect(){window.XMLHttpRequest.prototype.open=this.open}overrideXmlHttpRequest(t){const{open:e,send:n}=window.XMLHttpRequest.prototype,i=this._options;window.XMLHttpRequest.prototype.open=function openReplacement(...n){return setTimeout((()=>{const[e,o]=n;"POST"!==e&&(i.beforeResponse&&i.beforeResponse({type:"XMLHttpRequest",method:e,url:o,response:this.response||""},t),this.addEventListener("readystatechange",(function(n){4===n.currentTarget?.readyState&&i.executor({type:"XMLHttpRequest",method:e,url:o,response:this.response},t)}),!1))})),[this._method,this._url]=n,e.apply(this,n)},window.XMLHttpRequest.prototype.send=function sendReplacement(...e){if("POST"===this._method){const[n]=e;i.beforeResponse&&i.beforeResponse({type:"XMLHttpRequest",method:this._method,url:this._url,body:n,response:this.response||""},t),this.addEventListener("readystatechange",(function(e){4===e.currentTarget.readyState&&i.executor({type:"XMLHttpRequest",method:this._method,url:this._url,body:n,response:this.response},t)}),!1)}return n.apply(this,e)},this.open=e}overrideFetch(t){try{const e=this._options,n=window.fetch;window.fetch=function fetch(...i){const[o,r]=i;e.beforeResponse&&e.beforeResponse({type:"fetch",method:r?.method??"GET",body:r?.body,url:o},t);const s=n?.apply(this,i);return(async()=>{try{e.executor({type:"fetch",url:o,method:r?.method??"GET",body:r?.body,response:await(await s).clone().text()},t)}catch(n){window.potions.logger.captureError(n,!1),e.executor({type:"fetch",url:o,method:r?.method??"GET",body:r?.body,response:JSON.stringify(await s)},t)}})(),s}}catch(t){window.potions.logger.captureError(t,!1)}}}({async beforeResponse(t){t.url.includes("/cart/add/")&&window.potions.widgets.multiply.actions.removeNativeBanner()},executor:async t=>{if(t.url.includes("/cart/add/")&&"fetch"!==t.type)try{0!==JSON.parse(t.response)?.is_add_to_cart?self.dispatchEvent(new CustomEvent("potions_multiply_add_to_cart",{detail:{native_event:t}})):window.potions.widgets.multiply.actions.showNativeBanner()}catch(t){}}})},actions:{validateForm(t,e){const n=t.querySelector("#id").value,i=t.querySelector("#trigger")?.value;t.classList.add("loader");try{addToCart(n).then((o=>{o?(window.potions.analytics.sendEvent({widget:"multiply",action:"convert",id:"add",options:{label:i,sku:n}}),"add_to_cart"===i?(window.potions.data.cart.value=window.potions.data.cart.value+parseFloat(e),t.classList.remove("loader"),t.classList.add("success")):"product_page"===i&&(window.location.href="/checkout/cart")):(t.classList.remove("loader"),t.classList.add("error"))}))}catch(e){t.classList.remove("loader"),t.classList.add("error")}},getCartInfo(t){if(!t)return{};const e=JSON.parse(t.response),n=document.createElement("div");n.innerHTML=e.message;let i=0;const o=document.querySelector("#minicart-content-wrapper .block-content .price-wrapper .price");o&&(i=parseInt(o?.innerHTML.replace("&nbsp;€","")||"0",10));return{value:i+parseFloat(n.querySelector(".price > span.price")?.innerHTML?.replace("&nbsp;€","")?.replace(",",".")||"0")}},getContainer(t){const e=document.createElement("div.potions-multiply");return e.setAttribute("id","potions-multiply"),"product_page"===t?window.innerWidth<760?(document.querySelector(".column.main").insertAdjacentElement("afterend",e),e):(document.querySelector(".product.info.detailed")?.after(e),e):"add_to_cart"===t?document.body:void 0},getProductsIds(t,e){switch(e){case"add_to_cart":if(t){const e=JSON.parse(t.response),n=document.createElement("div");n.innerHTML=e.message;const i={product_ids:[e.product_sku],title:n.querySelector(".added-item")?.innerHTML,img:n.querySelector(".product-image-photo")?.getAttribute("src"),price:window.potions.actions.utils.parseStringToNumber(n.querySelector(".price > span.price")?.innerHTML),crossed_price:window.potions.actions.utils.parseStringToNumber(n.querySelector(".mdq-old-price > span.price")?.innerHTML)};return{...i,has_promo:void 0!==i.crossed_price}}break;case"product_page":return{product_ids:[document.querySelector(".col.data[data-th='SKU']")?.innerHTML]}}return{}},getStyleHideNativeBanner(){const t=document.createElement("style");return t.innerHTML='\n      .hide-native-banner #confirmBox,\n      .hide-native-banner #confirmOverlay,\n      .hide-potions-banner potions-multiply[trigger="add_to_cart"] {\n        display: none !important;\n      }      ',t},onClose(t,e=!0){document.querySelector("#confirmOverlay #confirmBox .cross")?.click(),e&&window.potions.analytics.sendEvent({widget:"multiply",action:"end",id:"close",options:{label:"add_to_cart"}}),window.potions.widgets.multiply.actions.showNativeBanner()}}};const le={...ce,elements:[class multiply_PotionsMultiply_PotionsMultiply extends PotionsMultiply_PotionsMultiply{constructor(){super(...arguments),this.deliveryMaxValue="59"}static getElementName(){return"potions-multiply"}templateColor(){return"\n      <style>\n        potions-multiply-pop-up,\n        potions-multiply-integrated {\n          --main-color: #0029F3;\n          --second-color: #FF53AB;\n          --font-title: 'DM Serif Display',serif;\n          --font-price: 'DM Sans',sans-serif;\n          --price-bold: 500;\n          --title-font-size: 18px;\n          --slider-button-color-non-active: rgba(0, 41, 243, 0.5);\n          --slider-button-color-active: rgba(0, 41, 243, 1);\n        }\n        \n        .bucket_B {\n          --title-font-weight: 100;\n          --price-font-weight: 700;\n          --product-title-font-weight: 400;\n          background-color: #f5f6fa;\n        }\n        \n      </style>\n    "}},...ae]},de=[{name:"config",file:"config.json",type:Json}],pe=function(){let t;return{getInstance:async function(e){return t=await t,t&&t.id==e.id||(t=window.potions.widgets.ab_experiment.setABTestData(e)),t}}}();class AbExperiment extends Widget{constructor(t,e){super(t,e,de),this.config={},this._storage.db=new DBWrapper("potions_ab_test",1,[{name:"ab_test",options:{keyPath:"id"},indexes:[]}]),this._potions.initializers.ab_test=new Initializer((()=>this.overrideABTestMethods()))}async overrideABTestMethods(){const t=await this._resources.config;Array.isArray(t)&&t.forEach((async t=>{if(void 0===t.device||"all"===t.device||t.device===this._potions.state.device){const e=this._potions.widgets[t.widget];if(e){const n=e[t.tested_method];e[t.tested_method]=async function(i){if(t.rule){if(!await Rule.parse(t.rule).apply({window,args:i}))return void n.apply(this,[i])}const o=await this._potions.widgets.ab_experiment.getABTestData(t);if(o.bucket)switch(this._potions.widgets.ab_experiment.config[t.widget]=o,this._potions.widgets.ab_experiment.sendAnalytics(t,"execute",o),t.type){case"design":n.apply(this,[i]);break;case"functional":n.apply(this,[{...i,...t.setting[o.bucket].args}]);break;case"classical":{const r=t.setting[o.bucket]?.action;r&&e?.actions?.[r]?.apply(this,[i]),"A"!==o.bucket&&n.apply(this,[{...i,...t.setting[o.bucket].args}]);break}}}}}}))}sendAnalytics(t,e,n,i=!1){this._potions.analytics.sendEvent({widget:"ab_experiment",action:e,id:t.id,options:{label:n.bucket},customDimension:i,non_interactive:!0})}async getABTestData(t){try{let e=await this._storage.db.get("ab_test",t.id);return e||(e=await pe.getInstance(t)),e}catch(t){return this._potions.logger.captureError(t),{}}}async setABTestData(t){const e=await this.getBucket(t),n={id:t.id,bucket:e.group,type:e.type,timestamp:Date.now()};return await this._storage.db.add("ab_test",n),this.sendAnalytics(t,"setBucket",n,!0),n}getBucket(t){return new Promise((e=>{const n=Object.fromEntries(Object.entries(t.setting).map((([t,e])=>[t,e.repartition])));fetch("https://abtest.get-potions.com",{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify({domain:"lollipops",id:t.id,repartition:n,device:this._potions.state.device})}).then((t=>t.json())).then((t=>e({group:t,type:"server"}))).catch((t=>this._potions.logger.captureError(t,!1))),setTimeout((()=>{const t=Math.random();let i=0;Object.entries(n).forEach((([n,o])=>{t<i+o&&e({group:n,type:"random"}),i=o+i}))}),1e3)}))}}const ue=[{name:"rules",file:"rules.json",type:Rule},{name:"scenarios",file:"scenarios.json",type:Json}];const he=[PotionsOverlay,PotionsModal,PotionsText,PotionsStack,class PotionsSwitchCta extends PotionsElement_PotionsElement{render(){super.render(),this.shadowRoot?.querySelector("button")?.addEventListener("click",(()=>{this.classList.contains("activated")||(this.classList.add("activated"),window.potions.widgets.switch.actions.activateSwitch(this.getAttribute("scenario"),this.getAttribute("code")))}))}templateStyle(){return"\n      <style>\n        button {\n          color: var(--switch-cta-color, white);\n          background-color: var(--switch-cta-bg-color, black);\n          border: var(--switch-cta-border, none);\n          width: var(--switch-cta-width, 100%);\n          height: var(--switch-cta-height, auto);\n          border-radius: var(--switch-cta-border-radius, 0);\n          font-size: var(--switch-cta-font-size, inherit);\n          font-weight: var(--switch-cta-font-weight, inherit);\n          font-family: var(--switch-cta-font, inherit);\n          padding: 5px 0;\n          box-sizing: border-box;\n          text-decoration: none;\n          align-items: center;\n          flex-direction: row;\n          align-self: center;\n          justify-content: center;\n          text-align: center;\n          white-space: nowrap;\n          cursor: pointer;\n        }\n        button:hover {\n          color: var(--switch-cta-hover-color, black);\n          background-color: var(--switch-cta-hover-bg-color, white);\n          border: var(--switch-cta-hover-border, unset);\n        }\n\n        :host(.activated) button,\n        :host(.activated) button:hover {\n          background-color: var(--switch-cta-activated-bg-color, white);\n          border: var(--switch-cta-activated-border, 1px solid black);\n          color: var(--switch-cta-activated-color, black);\n          cursor: unset;\n        }\n\n        .message {\n          color: var(--switch-cta-message-color, black);\n          font-size: var(--switch-cta-message-font-size, inherit);\n          text-align: var(--switch-cta-message-text-align, unset);\n        }\n\n        .only-activated,\n        :host(.activated) .only-not-activated {\n          display: none;\n        }\n\n        :host(.activated) .only-activated {\n          display: block;\n        }\n      </style>\n    "}template(){return`\n      ${this.templateStyle()}\n      <button>\n        <div class="only-not-activated">\n          <slot name="button" >Activer mon coupon</slot>\n        </div>\n\n        <div class="only-activated">\n          <slot name="button-activated" class= "only-activated">\n            ${this.getAttribute("code")}\n          </slot>\n        </div>\n      </button>\n\n      <div class="message only-not-activated">\n        <slot  name="fill-activated">Valable pendant 24h</slot>\n      </div>\n\n      <div class="message only-activated">\n        <slot name="fill-not-activated">Code activé avec succès !</slot>\n      </div>\n    `}}];class PotionsSwitch extends PotionsElement_PotionsElement{constructor(){super(...arguments),this.scenario={}}connectedCallback(){this.scenario={name:this.getAttribute("scenario"),...window.potions.widgets.switch.scenario},super.connectedCallback()}templateStyle(){return"\n      <style>\n      </style>\n    "}template(){return`\n      ${this.templateStyle()}\n      <potions-overlay>\n        <potions-modal>\n          <potions-stack class="center">\n            <potions-text class="h2">\n              ${this.scenario.texts.title}\n            </potions-text>\n            <potions-text class="info">\n              your scenario : ${this.scenario.name}\n            </potions-text>\n            <potions-switch-cta\n              scenario="${this.scenario.name}"\n              code="${this.scenario.code}"\n            >\n            </potions-switch-cta>\n          </potions-stack>\n        </potions-modal>\n      </potions-overlay>\n    `}}async function haveToShowScenarioAgain(t,e){const n=await window.potions.widgets.navigation_recorder.storage.db.get("user",`switch_${t}`);return Date.now()-(n?.timestamp??0)>e}const ge=new Process((()=>{"desktop"===window.potions.state.device&&window.potions.widgets.switch.isShowSwitch("desktop","domLoaded")}),["domLoaded","pageId"]),me=new Process((()=>{"mobile"===window.potions.state.device&&window.potions.widgets.switch.isShowSwitch("mobile","domLoaded")}),["domLoaded","pageId"]);new Process((async t=>{window.potions.widgets.navigation_recorder.storage.db.update("user",{session_id:window.potions.state.sessionId,timestamp:Date.now(),...t.detail},"product_added_in_cart");const e=await window.potions.widgets.navigation_recorder.storage.db.get("sessions",window.potions.state.sessionId);window.potions.widgets.navigation_recorder.storage.db.update("sessions",{...e,product_added_to_cart:!0})}),"potions_product_added_in_cart");class Switch extends Widget{constructor(t,e,n={}){super(t,e,ue,n),this.scenario={},this._potions.widgets.push(new NavigationRecorder(t,"navigation_recorder")),this._listeners.switch_timer=new EventListener({event_name:"timer",executor:()=>{"mobile"===this._potions.state.device?this.isShowSwitch("mobile","timer"):this._listeners.switch_timer.disconnect()}}),this._processes.display_desktop=new Process((()=>{"desktop"===this._potions.state.device&&this.isShowSwitch("desktop","potions_leaving_page")}),"potions_leaving_page"),this._processes.coupxon_fill=new Process((async()=>{this.isfillCouponNeeded()}),["domLoaded","pageId"]),this._processes.deleteCoupon=new Process((async()=>{const t=await this._resources.rules,e=await t.delete_coupon.apply();e&&e.length&&e.forEach((t=>{this._potions.widgets.navigation_recorder.storage.db.delete("user",`switch_${t}`)}))}),"domLoaded"),this._processes.transaction_in_session=new Process((async()=>{const t=await window.potions.widgets.navigation_recorder.storage.db.get("sessions",window.potions.state.sessionId);window.potions.widgets.navigation_recorder.storage.db.update("sessions",{...t,transaction:!0})}),["domLoaded","pageId"],{rules:this._resources.rules,rule_name:"is_transaction_page"}),this._actions.clickCoupon=(t,e)=>{this._potions.widgets.navigation_recorder.storage.db.update("user",{action:"click",value:e,scenario:t,timestamp:Date.now(),session_id:this._potions.state.sessionId},`switch_${t}`)},this._actions.removeCoupon=async t=>{const e=await this._potions.widgets.navigation_recorder.storage.db.get("user",`switch_${t}`);this._potions.widgets.navigation_recorder.storage.db.update("user",{...e,action:"remove"},`switch_${t}`)},this._actions.onClose=t=>{window.potions.analytics.sendEvent({widget:"switch",action:"end",id:"close",options:{label:t}})},this._actions.fillCoupon=()=>{},this._actions.activateSwitch=(t,e)=>{window.potions.analytics.sendEvent({widget:"switch",action:"convert",id:"activation",options:{label:t}}),window.potions.widgets.switch.actions.clickCoupon(t,e)},this._actions.haveToShowScenarioAgain=haveToShowScenarioAgain,this._actions.fillScenario=async t=>{const e=await this._resources.scenarios;return this.scenario=e[t],{name:t,...this.scenario}},this._actions.getContainer=()=>document.body,this._elements=[PotionsSwitch,...he],super.buildCustom(n)}async isShowSwitch(t,e=""){const n=await this._resources.rules,i=await this._resources.scenarios;for(const o of Object.keys(i)){const r=n[`show_coupon_${o}_${t}`]??n[`show_coupon_${o}`];if(await(r?.apply({window,trigger:e}))){this.scenario=i[o],this.showSwitch({scenario:o}),this._potions.logger.captureLog(["SWITCH - validate scenario",i[o]]);break}}}async showSwitch({scenario:t}){this._listeners.switch_timer.disconnect();const e=await this._potions.widgets.navigation_recorder.storage.db.get("user",`switch_${t}`);this._potions.widgets.navigation_recorder.storage.db.update("user",{action:"show",timestamp:Date.now(),scenario:t,session_id:window.potions.state.sessionId,nb_display_in_session:e?.session_id===window.potions.state.sessionId?(e?.nb_display_in_session??0)+1:1},`switch_${t}`),this.displayCoupon({scenario:t})}async displayCoupon({scenario:t}){if(!document.querySelector("potions-switch")){const e=document.createElement("potions-switch");e.setAttribute("root",""),e.setAttribute("scenario",t);const n=await this.actions.getContainer(t);n&&(n.append(e),this._potions.analytics.sendEvent({widget:this._name,action:"show",id:"banner",options:{label:t},non_interactive:!0}))}}async isfillCouponNeeded(){const t=(await this._potions.widgets.navigation_recorder.storage.db.getAll("user")).filter((t=>t.scenario&&"click"===t.action&&t.value)).sort(((t,e)=>t.timestamp-e.timestamp)).pop();if(t){const e=await this._resources.rules;await e.fill_coupon_in_cart.apply({window,coupon:t})&&(this._actions.fillCoupon(t),this._potions.logger.captureLog(["SWITCH - fill coupon for",t]))}}}const fe=[class PotionsSwitchBanner extends PotionsElement_PotionsElement{constructor(){super(...arguments),this.codeApi=null}async getCodePromo(){const t=await window.potions.widgets.navigation_recorder.storage.db.get("user","code_promo");return t?t.codePromo:await window.potions.widgets.switch.actions.getIsCodePromoAvailable()?window.potions.widgets.switch.actions.getCodePromoFromApi():void 0}async isExist(){window.potions.widgets.switch.actions.haveScenarioShownInSession("bandeau")?null==await window.potions.widgets.switch.actions.stateTime()&&window.potions.widgets.switch.actions.setTime(Date.parse(Date())):window.potions.widgets.switch.actions.setTime(Date.parse(Date()))}async connectedCallback(){super.connectedCallback();const t=await window.potions.widgets.navigation_recorder.storage.db.get("user","switch_bandeau");function initializeClock(t,e,n){const i=n.querySelector(".hours"),o=n.querySelector(".minutes"),r=n.querySelector(".seconds");function updateClock(){const t=function getTimeRemaining(t){const e=Date.parse(t)-Date.parse(Date()),n=Math.floor(e/1e3%60),i=Math.floor(e/1e3/60%60),o=Math.floor(e/36e5%24);return{total:e,days:Math.floor(e/864e5),hours:o,minutes:i,seconds:n}}(e);i.innerHTML=("0"+t.hours).slice(-2),o.innerHTML=("0"+t.minutes).slice(-2),r.innerHTML=("0"+t.seconds).slice(-2),t.total<=0&&clearInterval(s)}updateClock();const s=setInterval(updateClock,1e3)}t&&window.potions.state.sessionId!=t.session_id&&await window.potions.widgets.navigation_recorder.storage.db.delete("user","switch_time_registered"),this.shadowRoot.querySelector(".discover").addEventListener("click",(()=>{this.getCodePromo().then((t=>{this.codeApi=t,this.shadowRoot.querySelector(".code").textContent=t,this.classList.add("activated"),window.potions.analytics.sendEvent({widget:"switch",action:"convert",id:"activation",options:{label:"bandeau"}}),this.isExist(),async function date(t){await window.potions.widgets.switch.actions.stateTime(),initializeClock(0,new Date(await window.potions.widgets.switch.actions.stateTime()+864e5),t)}(this.shadowRoot?.querySelector(".clock"))}))})),this.shadowRoot.querySelector(".code").addEventListener("click",(()=>{this.classList.add("copied"),navigator.clipboard.writeText(this.codeApi)}))}templateStyle(){return'\n      <style>\n        :host {\n          margin-top: 15px;\n          height: 60px;\n          width: 100%;\n          background-color: #ffdce2;\n          flex-direction: row;\n          justify-content: center;\n          display: flex;\n        }\n\n        .texts,\n        .cont {\n          width: 100%;\n          align-self: center;\n        }\n\n        .texts {\n          text-align: left;\n          padding-left: 15px;\n        }\n\n        .cont {\n          display: flex;\n          padding-right: 11px;\n          justify-content: flex-end;\n        }\n\n        .clock, .switch-product-text2 {\n          display: flex;\n        }\n\n        .btn {\n          display: flex;\n          justify-content: center;\n          align-items: center;\n          width: 100px;\n          height: 28px;\n          background: #0029f3;\n          border: 2px solid #0029f3;\n          border-radius: 14px;\n          -webkit-text-fill-color: #ffffff;\n          color: #ffffff;\n          font-family: "Lato";\n          font-style: normal;\n          font-weight: 700;\n          font-size: 14px;\n          line-height: 20px;\n          margin-right: 10px;\n        }\n\n        .btn:hover {\n          background-color: #ffffff;\n          -webkit-text-fill-color: #0029f3;\n          color: #0029f3;\n          cursor: pointer;\n        }\n\n        :host(:not(.activated)) .only-activated,\n        :host(:not(.copied)) .only-copied,\n        :host(.activated) .only-not-activated,\n        :host(.copied) .only-not-copied {\n          display: none;\n        }\n       </style>\n    '}template(){return`\n        ${this.templateStyle()}\n        <div class="texts">\n          <div class="switch-product-text only-not-activated">\n            ${window.potions.widgets.switch.scenario.subtitle}\n          </div>\n          <div class="switch-product-text2 only-activated">\n            ${window.potions.widgets.switch.scenario.subtitle2}\n            <b>\n            <div class="clock">\n              <span class="hours"></span>\n              <div class="smalltext">h</div>\n              <span class="minutes"></span>\n              <div class="smalltext">m</div>\n              <span class="seconds"></span>\n              <div class="smalltext">s</div>\n            </div>\n          </div>\n          </b>\n          <div class="switch-product-text3 only-activated">\n            ${window.potions.widgets.switch.scenario.subtitle3}\n          </div>\n        </div>\n        <div class="cont">\n          <div class="btn discover only-not-activated">\n            ${window.potions.widgets.switch.scenario.codetitle}\n          </div>\n          <div class="btn code only-activated only-not-copied"></div>\n          <div class="btn copied only-copied">✔︎ Code copié</div>\n        </div>\n      `}},class PotionsSwitchNewsletter extends PotionsElement_PotionsElement{async connectedCallback(){super.connectedCallback(),this.shadowRoot?.querySelector("button")?.addEventListener("click",(()=>{""!=this.shadowRoot?.querySelector("#email").value&&(this.shadowRoot?.querySelector(".button").classList.add("hide"),this.shadowRoot?.querySelector(".inputs").classList.add("hide"),this.shadowRoot?.querySelector(".code").classList.remove("hide"),this.shadowRoot?.querySelector(".code").classList.add("flex"),this.shadowRoot.querySelector(".title").innerHTML=window.potions.widgets.switch.scenario.title2)})),this.shadowRoot.querySelector(".code").addEventListener("click",(()=>{this.shadowRoot?.querySelector(".code").classList.add("center"),this.shadowRoot?.querySelector(".code").classList.remove("space"),this.shadowRoot.querySelector(".code").innerHTML="✔︎ Code copié",navigator.clipboard.writeText(window.potions.widgets.switch.scenario.code)}))}templateStyle(){return'\n      <style>\n        potions-overlay {\n          --potions-z-index: 3000;\n        }\n        .main-container {\n          display: flex;\n          justify-content: center;\n          overflow: hidden;\n          width: 910px;\n          height: 450px;\n          --potions-image-width: 400px;\n        }\n\n        .second-container {\n          background-color: #d9d9d9;\n          overflow: hidden;\n        }\n\n        .content {\n          display: grid;\n          gap: 20px;\n          flex-direction: column;\n          justify-content: center;\n          align-self: center;\n          padding: 50px 30px;\n          max-width: 500px;\n        }\n\n        .button {\n          padding-top: 16px;\n        }\n\n        form {\n          width: 100%;\n          display: flex;\n          flex-direction: column;\n        }\n\n        .inputs {\n          width: 100%;\n          text-align: center;\n          display: flex;\n          flex-direction: column;\n        }\n\n        input {\n          height: 55px;\n          width: 370px;\n          left: 0px;\n          top: 71px;\n          padding-left: 16px;\n          border-width: 2px;\n          border-style: inset;\n          border-color: rgb(133, 133, 133);\n        }\n\n        .button {\n          display: flex;\n          justify-content: center;\n        }\n\n        button {\n          height: 55px;\n          width: 370px;\n          left: 0px;\n          top: 71px;\n          border-radius: 40px;\n          background: #0029f3;\n          border-color: #0029f3;\n          border-width: 0px;\n          font-family: "DM Sans";\n          font-style: normal;\n          font-size: 14px;\n          -webkit-text-fill-color: #ffffff;\n          color: #ffffff;\n          margin: auto;\n          border: 1px solid #0029f3;\n          transition: 0.5s;\n        }\n\n        .title {\n          font-family: "DM Serif Display";\n          font-style: normal;\n          font-weight: 400;\n          font-size: 32px;\n          line-height: 40px;\n          text-align: center;\n        }\n\n        .subtitle {\n          font-family: "DM Sans";\n          font-style: normal;\n          font-weight: 400;\n          font-size: 14px;\n          line-height: 20px;\n          text-align: center;\n          padding-bottom: 20px;\n        }\n\n        ::placeholder {\n          font-family: "Lato";\n          font-style: normal;\n          font-weight: 400;\n          font-size: 16px;\n          line-height: 23px;\n          -webkit-text-fill-color: #aeaeae;\n          color: #aeaeae;\n        }\n\n        .hide {\n          display: none;\n        }\n\n        .image {\n          width: 100%;\n          height: 100%;\n        }\n\n        .code {\n          height: 55px;\n          width: 370px;\n          left: auto;\n          top: auto;\n          border-radius: 40px;\n          background: #ffffff;\n          border-color: #0029f3;\n          border: 1px solid #0029f3;\n          font-family: "Lato";\n          font-style: normal;\n          font-size: 18px;\n          -webkit-text-fill-color: #0029f3;\n          color: #0029f3;\n          margin: auto;\n          align-items: center;\n          transition: 0.5s;\n          padding-left: 15px;\n        }\n\n        .space {\n          justify-content: space-between;\n        }\n\n        .center {\n          justify-content: center;\n        }\n\n        p.code-text {\n          -webkit-text-fill-color: #0029f3;\n          color: #0029f3;\n          text-align: center;\n        }\n\n        .actif {\n          display: block;\n        }\n\n        .flex {\n          display: flex;\n        }\n\n        .code:hover {\n          cursor: pointer;\n        }\n\n        button:hover {\n          color: #0029f3;\n          -webkit-text-fill-color: #0029f3;\n          background-color: #ffffff;\n          cursor: pointer;\n        }\n\n        svg {\n          padding-right: 15px;\n        }\n\n        @media (max-width: 850px) {\n          potions-modal {\n            text-align: center;\n            width: 90%;\n          }\n\n          .title {\n            align-self: center;\n          }\n\n          div.second-container {\n            width: 0px;\n            display: none;\n          }\n\n          .main-container {\n            display: flex;\n            justify-content: center;\n          }\n\n          .inputs {\n            justify-content: center;\n            flex-direction: row;\n          }\n\n          .button {\n            width: auto;\n            height: auto;\n            flex-direction: column;\n          }\n        }\n      </style>\n    '}template(){return`\n      ${this.templateStyle()}\n      <potions-overlay \n        potion="switch" \n        trigger="${this.getAttribute("scenario")}"\n      >\n        <potions-modal \n          potion="switch" \n          trigger="${this.getAttribute("scenario")}"\n        >\n          <div class="second-container">\n            <img\n              src="https://client.get-potions.com/resources/lollipops/switch/image_newsletter_lollipops_new.png"\n              alt=""\n              class="image"\n            />\n          </div>\n          <div class="main-container">\n            <div class="content">\n              <div class="title">\n                ${window.potions.widgets.switch.scenario.title}</div>\n                <div class="subtitle">\n                  ${window.potions.widgets.switch.scenario.subtitle}\n                </div>\n                <form\n                  onsubmit="event.preventDefault(); window.potions.widgets.switch.actions.sendEmail(this); return false"\n                >\n                  ${window.potions.widgets.switch.actions.setNewsletterState(!1)}\n                <div class="inputs">\n                  <input id="email" type="email" placeholder="Adresse e-mail*"/>\n                </div>\n                <div class="button">\n                  <button type="submit">\n                    Je m'inscris\n                  </button>\n                </div>\n                <div class="hide code space">\n                  Code promo : ${window.potions.widgets.switch.scenario.code}\n                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                  <path d="M20 9H11C9.89543 9 9 9.89543 9 11V20C9 21.1046 9.89543 22 11 22H20C21.1046 22 22 21.1046 22 20V11C22 9.89543 21.1046 9 20 9Z" stroke="#0029F3" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n                  <path d="M5 15H4C3.46957 15 2.96086 14.7893 2.58579 14.4142C2.21071 14.0391 2 13.5304 2 13V4C2 3.46957 2.21071 2.96086 2.58579 2.58579C2.96086 2.21071 3.46957 2 4 2H13C13.5304 2 14.0391 2.21071 14.4142 2.58579C14.7893 2.96086 15 3.46957 15 4V5" stroke="#0029F3" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n                  </svg>\n                </div>\n              </form>\n            </div>\n          </div>\n        </potions-modal>\n      </potions-overlay>\n    `}}];const ve={elements:[class PotionsSwitch_PotionsSwitch extends PotionsElement_PotionsElement{template(){return"newsletter"===this.getAttribute("scenario")?`\n        <potions-switch-newsletter\n          scenario="${this.getAttribute("scenario")}"\n        ></potions-switch-newsletter>\n      `:`\n      <potions-switch-banner\n        scenario="${this.getAttribute("scenario")}"\n      ></potions-switch-banner>\n    `}},...fe],processes:{startProcessDomLoadedDesktop:ge,startProcessDomLoadedMobile:me},actions:{async saveCodePromo(t){await window.potions.widgets.navigation_recorder.storage.db.update("user",{session:window.potions.state.sessionId,timestamp:(new Date).getTime(),codePromo:t},"code_promo")},getCodePromoFromApi:async()=>new Promise((t=>{fetch("https://api.switch.get-potions.com/16").then((t=>t.json())).then((async e=>{await ve.actions.saveCodePromo(e),t(e)})).catch((t=>window.potions.logger.captureError(t,!1)))})),getIsCodePromoAvailable:async()=>new Promise((t=>{fetch("https://api.switch.get-potions.com/available/16").then((t=>t.json())).then((e=>t(e))).catch((()=>t(!1)))})),async isCodePromoAvailable(){let t=await window.potions.widgets.navigation_recorder.storage.db.get("user","isCodePromoAvailable");return t&&t.session===window.potions.state.sessionId?(window.potions.logger.captureLog(["no api call"]),!1):(window.potions.logger.captureLog(["api call"]),t=await ve.actions.getIsCodePromoAvailable(),t||await window.potions.widgets.navigation_recorder.storage.db.update("user",{session:window.potions.state.sessionId,timestamp:(new Date).getTime(),isAvailable:!1},"isCodePromoAvailable"),t)},getContainer(){if("bandeau"==window.potions.widgets.switch.scenario.name){const t=document.createElement("div");return t?(t.setAttribute("id","potions-switch"),document.querySelector(".product-options-bottom")&&document.querySelector(".product-options-bottom").insertAdjacentElement("beforebegin",t),document.querySelector(".product-simple-actions")&&document.querySelector(".product-simple-actions").insertAdjacentElement("beforebegin",t),t):document.body}return document.body},stateNewsletter:async()=>await window.potions.widgets.navigation_recorder.storage.db.get("user","switch_mail_registered"),setNewsletterState:t=>(window.potions.widgets.navigation_recorder.storage.db.update("user",t,"switch_mail_registered"),""),stateCode:async()=>await window.potions.widgets.navigation_recorder.storage.db.get("user","switch_code_registered"),setTime:t=>(window.potions.widgets.navigation_recorder.storage.db.update("user",t,"switch_time_registered"),""),stateTime:async()=>await window.potions.widgets.navigation_recorder.storage.db.get("user","switch_time_registered"),setCodeState:t=>(window.potions.widgets.navigation_recorder.storage.db.update("user",t,"switch_code_registered"),""),timeNow:()=>Date.parse(Date()),haveToShowScenarioAgain,haveScenarioShownInSession:async function haveScenarioShownInSession(t){return(await window.potions.widgets.navigation_recorder.storage.db.get("user",`switch_${t}`))?.session_id===window.potions.state.sessionId},fillCoupon(t){},async sendEmail(t){const e=t.querySelector("#email").value;""!=e?fetch("https://www.lollipops.fr/newsletter/subscriber/new/",{headers:{accept:"application/json, text/javascript, */*; q=0.01","accept-language":"fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7","content-type":"application/x-www-form-urlencoded; charset=UTF-8","cache-control":"no-cache",pragma:"no-cache","sec-ch-ua":'"Google Chrome";v="107", "Chromium";v="107", "Not=A?Brand";v="24"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"macOS"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","x-requested-with":"XMLHttpRequest"},referrer:window.location.href,referrerPolicy:"strict-origin-when-cross-origin",body:`email=${e}`,method:"POST",mode:"cors",credentials:"include"}).then((t=>t.json())).then((e=>{if(!e.nw_error)return t.classList.add("success"),window.potions.analytics.sendEvent({widget:"switch",action:"convert",id:"activation",options:{label:"newsletter"}}),"Merci de votre inscription."==e.msg||"Cette adresse e-mail est déjà abonnée."==e.msg?(window.potions.widgets.switch.actions.setNewsletterState(!0),!0):(window.potions.widgets.switch.actions.setNewsletterState(!1),!1)})):t.classList.add("error")}}};if(function isAsyncAvailable(){try{new Function("async () => {}")()}catch(t){return!1}return!0}()){if(sessionStorage.getItem("ptspreview")||location.search.includes("ptspreview")){let t=null;if(sessionStorage.getItem("ptspreview")?t=sessionStorage.getItem("ptspreview"):(t=location.search,sessionStorage.setItem("ptspreview",location.search)),!document.currentScript?.getAttribute("ptspreview")&&t){const e=Object.fromEntries(t.replace("?","").split("&").map((t=>t.split("=")))),n=document.createElement("script");throw n.setAttribute("ptspreview","true"),n.setAttribute("src",`https://preprod.client.get-potions.com/${e.ptspreview}/potions.js?${Date.now()}`),document.head.append(n),new Error("Loading preview version...")}}if(!window.potions){window.potions=new Potions({env:"production"},{BrowserClient:ut,Hub:R,getCurrentHub,Integrations:Et,Dedupe:Pt});try{window.potions.widgets.push(new Flashback(window.potions,"flashback",Vt)),window.potions.widgets.push(new Multiply(window.potions,"multiply",le)),window.potions.widgets.push(new AbExperiment(window.potions,"ab_experiment")),window.potions.widgets.push(new Switch(window.potions,"switch",ve)),window.potions.launch().then((()=>{window.potions.logger.captureLog(["CORE - launch potions done"])}))}catch(t){window.potions.logger.captureError(t)}}}})()})();